(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{6195:e=>{"use strict";e.exports=require("node:buffer")},5777:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ComponentMod:()=>k,default:()=>A});var a={};r.r(a),r.d(a,{POST:()=>_,runtime:()=>y});var i={};r.r(i),r.d(i,{headerHooks:()=>T,originalPathname:()=>E,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>O,staticGenerationAsyncStorage:()=>P,staticGenerationBailout:()=>S});var n=r(8426);r(9996);var s=r(4487),o=r(5459),l=r(723),u=r(6486),c=r(6311),d=r(4461),h=r(8927),p=r(7254),f=r(2194),m=r(2234),g=r(8498);let y="edge",v=e=>"user"===e.role?new h.xk(e.content):"assistant"===e.role?new h.gY(e.content):new h.J(e.content,e.role),b=`You are a stereotypical robot named Robbie and must answer all questions like a stereotypical robot. Use lots of interjections like "BEEP" and "BOOP".

If you don't know how to answer a question, use the available tools to look up relevant information. You should particularly do this for questions about LangChain.`;async function _(e){try{let t=await e.json(),r=(t.messages??[]).filter(e=>"user"===e.role||"assistant"===e.role),a=t.show_intermediate_steps,i=r.slice(0,-1),n=r[r.length-1].content,s=new c.z({modelName:"gpt-4"}),h=(0,u.eI)(process.env.SUPABASE_URL,process.env.SUPABASE_PRIVATE_KEY),y=new d.g(new p.V,{client:h,tableName:"documents",queryName:"match_documents"}),_=new m.V(i.map(v)),w=new f.NN({llm:s,memoryKey:"chat_history",outputKey:"output",chatHistory:_}),x=y.asRetriever(),P=(0,f.D$)(x,{name:"search_latest_knowledge",description:"Searches and returns up-to-date general information."}),O=await (0,g.j0)([P],s,{agentType:"openai-functions",memory:w,returnIntermediateSteps:!0,verbose:!0,agentArgs:{prefix:b}}),T=await O.call({input:n});if(a)return o.Z.json({output:T.output,intermediate_steps:T.intermediateSteps},{status:200});{let e=new TextEncoder,t=new ReadableStream({async start(t){for(let r of T.output)t.enqueue(e.encode(r)),await new Promise(e=>setTimeout(e,20));t.close()}});return new l.wn(t)}}catch(e){return o.Z.json({error:e.message},{status:500})}}let w=new s.Z({definition:{kind:"APP_ROUTE",page:"/api/chat/retrieval_agents/route",pathname:"/api/chat/retrieval_agents",filename:"route",bundlePath:"app/api/chat/retrieval_agents/route"},resolvedPagePath:"/Users/merlimar/Projects/AUTOGPT/BBB/Stim/ui/app/api/chat/retrieval_agents/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:P,serverHooks:O,headerHooks:T,staticGenerationBailout:S}=w,E="/api/chat/retrieval_agents/route",k=i,A=n.a.wrap(w)},2287:(e,t,r)=>{"use strict";var a=function(){if("undefined"!=typeof self)return self;if(void 0!==r.g)return r.g;throw Error("unable to locate global object")}();e.exports=t=a.fetch,a.fetch&&(t.default=a.fetch.bind(a)),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},6486:(e,t,r)=>{"use strict";r.d(t,{eI:()=>tc});let a=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.t.bind(r,2287,23)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)};class i extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class n extends i{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class s extends i{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class o extends i{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}class l{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=a(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r,a,i,l,u;return a=this,i=void 0,l=void 0,u=function*(){try{let a;let{headers:i,method:l,body:u}=t,c={};u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!=typeof Blob&&u instanceof Blob||u instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",a=u):"string"==typeof u?(c["Content-Type"]="text/plain",a=u):"undefined"!=typeof FormData&&u instanceof FormData?a=u:(c["Content-Type"]="application/json",a=JSON.stringify(u)));let d=yield this.fetch(`${this.url}/${e}`,{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:a}).catch(e=>{throw new n(e)}),h=d.headers.get("x-relay-error");if(h&&"true"===h)throw new s(d);if(!d.ok)throw new o(d);let p=(null!==(r=d.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return{data:"application/json"===p?yield d.json():"application/octet-stream"===p?yield d.blob():"multipart/form-data"===p?yield d.formData():yield d.text(),error:null}}catch(e){return{data:null,error:e}}},new(l||(l=Promise))(function(e,t){function r(e){try{s(u.next(e))}catch(e){t(e)}}function n(e){try{s(u.throw(e))}catch(e){t(e)}}function s(t){var a;t.done?e(t.value):((a=t.value)instanceof l?a:new l(function(e){e(a)})).then(r,n)}s((u=u.apply(a,i||[])).next())})}}var u,c,d,h,p,f,m,g,y,v,b=r(2287),_=r.n(b);class w{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=_():this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=this.fetch,a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,a;let i=null,n=null,s=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){let t=await e.text();""===t||(n="text/csv"===this.headers.Accept?t:this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}let a=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),u=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");a&&u&&u.length>1&&(s=parseInt(u[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(i={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,s=null,o=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{let t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(n=[],i=null,o=200,l="OK")}catch(r){404===e.status&&""===t?(o=204,l="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(a=null==i?void 0:i.details)||void 0===a?void 0:a.includes("Results contain 0 rows"))&&(i=null,o=200,l="OK"),i&&this.shouldThrowOnError)throw i}let u={error:i,data:n,count:s,status:o,statusText:l};return u});return this.shouldThrowOnError||(a=a.catch(e=>{var t,r,a;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(a=null==e?void 0:e.code)&&void 0!==a?a:""}`},data:null,count:null,status:0,statusText:""}})),a.then(e,t)}}class x extends w{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:a}={}){let i=a?`${a}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){let r=void 0===t?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){let a=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:a=!1,wal:i=!1,format:n="text"}={}){let s=[e?"analyze":null,t?"verbose":null,r?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),o=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${o}"; options=${s};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class P extends x{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let r=t.map(e=>"string"==typeof e&&RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:a}={}){let i="";"plain"===a?i="pl":"phrase"===a?i="ph":"websearch"===a&&(i="w");let n=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){let r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class O{constructor(e,{headers:t={},schema:r,fetch:a}){this.url=e,this.headers=t,this.schema=r,this.fetch=a}select(e,{head:t=!1,count:r}={}){let a=!1,i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",i),r&&(this.headers.Prefer=`count=${r}`),new P({method:t?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){let a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new P({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){let n=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),a&&n.push(`count=${a}`),i||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new P({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new P({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new P({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}let T={"X-Client-Info":"postgrest-js/1.8.4"};class S{constructor(e,{headers:t={},schema:r,fetch:a}={}){this.url=e,this.headers=Object.assign(Object.assign({},T),t),this.schemaName=r,this.fetch=a}from(e){let t=new URL(`${this.url}/${e}`);return new O(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new S(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:a}={}){let i,n;let s=new URL(`${this.url}/rpc/${e}`);r?(i="HEAD",Object.entries(t).forEach(([e,t])=>{s.searchParams.append(e,`${t}`)})):(i="POST",n=t);let o=Object.assign({},this.headers);return a&&(o.Prefer=`count=${a}`),new P({method:i,url:s,headers:o,schema:this.schemaName,body:n,fetch:this.fetch,allowEmpty:!1})}}var E=r(8104);let k={"X-Client-Info":"realtime-js/2.8.0"};!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(u||(u={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(c||(c={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(d||(d={})),(h||(h={})).websocket="websocket",function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(p||(p={}));class A{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class I{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):"string"==typeof e?t(JSON.parse(e)):t({})}_binaryDecode(e){let t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){let a=t.getUint8(1),i=t.getUint8(2),n=this.HEADER_LENGTH+2,s=r.decode(e.slice(n,n+a));n+=a;let o=r.decode(e.slice(n,n+i));n+=i;let l=JSON.parse(r.decode(e.slice(n,e.byteLength)));return{ref:null,topic:s,event:o,payload:l}}}class C{constructor(e,t,r={},a=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0;let e=this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()});"rate limited"===e&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(f||(f={}));class j{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=j.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=j.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=j.syncDiff(this.state,e,t,r),a())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,a){let i=this.cloneDeep(e),n=this.transformState(t),s={},o={};return this.map(i,(e,t)=>{n[e]||(o[e]=t)}),this.map(n,(e,t)=>{let r=i[e];if(r){let a=t.map(e=>e.presence_ref),i=r.map(e=>e.presence_ref),n=t.filter(e=>0>i.indexOf(e.presence_ref)),l=r.filter(e=>0>a.indexOf(e.presence_ref));n.length>0&&(s[e]=n),l.length>0&&(o[e]=l)}else s[e]=t}),this.syncDiff(i,{joins:s,leaves:o},r,a)}static syncDiff(e,t,r,a){let{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(t,a)=>{var i;let n=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(a),n.length>0){let r=e[t].map(e=>e.presence_ref),a=n.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...a)}r(t,n,a)}),this.map(n,(t,r)=>{let i=e[t];if(!i)return;let n=r.map(e=>e.presence_ref);i=i.filter(e=>0>n.indexOf(e.presence_ref)),e[t]=i,a(t,i,r),0===i.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let a=e[r];return"metas"in a?t[r]=a.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(m||(m={}));let N=(e,t,r={})=>{var a;let i=null!==(a=r.skipTypes)&&void 0!==a?a:[];return Object.keys(t).reduce((r,a)=>(r[a]=R(a,e,t,i),r),{})},R=(e,t,r,a)=>{let i=t.find(t=>t.name===e),n=null==i?void 0:i.type,s=r[e];return n&&!a.includes(n)?L(n,s):M(s)},L=(e,t)=>{if("_"===e.charAt(0)){let r=e.slice(1,e.length);return U(t,r)}switch(e){case m.bool:return D(t);case m.float4:case m.float8:case m.int2:case m.int4:case m.int8:case m.numeric:case m.oid:return $(t);case m.json:case m.jsonb:return Z(t);case m.timestamp:return B(t);case m.abstime:case m.date:case m.daterange:case m.int4range:case m.int8range:case m.money:case m.reltime:case m.text:case m.time:case m.timestamptz:case m.timetz:case m.tsrange:case m.tstzrange:default:return M(t)}},M=e=>e,D=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},$=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Z=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log(`JSON parse error: ${e}`)}return e},U=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,a=e[r],i=e[0];if("{"===i&&"}"===a){let a;let i=e.slice(1,r);try{a=JSON.parse("["+i+"]")}catch(e){a=i?i.split(","):[]}return a.map(e=>L(t,e))}return e},B=e=>"string"==typeof e?e.replace(" ","T"):e;!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(g||(g={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes"}(y||(y={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(v||(v={}));class V{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=c.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new C(this,d.join,this.params,this.timeout),this.rejoinTimer=new A(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=c.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=c.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=c.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=c.errored,this.rejoinTimer.scheduleTimeout())}),this._on(d.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new j(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,a;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:n}}=this.params;this._onError(t=>e&&e("CHANNEL_ERROR",t)),this._onClose(()=>e&&e("CLOSED"));let s={},o={broadcast:i,presence:n,postgres_changes:null!==(a=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==a?a:[]};this.socket.accessToken&&(s.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:o},s)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:t})=>{var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0===t){e&&e("SUBSCRIBED");return}{let a=this.bindings.postgres_changes,i=null!==(r=null==a?void 0:a.length)&&void 0!==r?r:0,n=[];for(let r=0;r<i;r++){let i=a[r],{filter:{event:s,schema:o,table:l,filter:u}}=i,c=t&&t[r];if(c&&c.event===s&&c.schema===o&&c.table===l&&c.filter===u)n.push(Object.assign(Object.assign({},i),{id:c.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=n,e&&e("SUBSCRIBED");return}}).receive("error",t=>{e&&e("CHANNEL_ERROR",Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,a;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var a,i,n;let s=this._push(e.type,e,t.timeout||this.timeout);s.rateLimited&&r("rate limited"),"broadcast"!==e.type||(null===(n=null===(i=null===(a=this.params)||void 0===a?void 0:a.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.ack)||r("ok"),s.receive("ok",()=>r("ok")),s.receive("timeout",()=>r("timed out"))});{let{event:i,payload:n}=e,s={method:"POST",headers:{apikey:null!==(r=this.socket.accessToken)&&void 0!==r?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,s,null!==(a=t.timeout)&&void 0!==a?a:this.timeout);if(e.ok)return"ok";return"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=c.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(d.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let a=new C(this,d.leave,{},e);a.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),a.send(),this._canPush()||a.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return(e=(e=e.replace(/^ws/i,"http")).replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,"")).replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){let a=new AbortController,i=setTimeout(()=>a.abort(),r),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(i),n}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new C(this,e,t,r);return this._canPush()?a.send():(a.startTimeout(),this.pushBuffer.push(a)),a}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var a,i;let n=e.toLocaleLowerCase(),{close:s,error:o,leave:l,join:u}=d;if(r&&[s,o,l,u].indexOf(n)>=0&&r!==this._joinRef())return;let c=this._onMessage(n,t,r);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(a=this.bindings.postgres_changes)||void 0===a||a.filter(e=>{var t,r,a;return(null===(t=e.filter)||void 0===t?void 0:t.event)==="*"||(null===(a=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===a?void 0:a.toLocaleLowerCase())===n}).map(e=>e.callback(c,r)):null===(i=this.bindings[n])||void 0===i||i.filter(e=>{var r,a,i,s,o,l;if(!["broadcast","presence","postgres_changes"].includes(n))return e.type.toLocaleLowerCase()===n;if("id"in e){let n=e.id,s=null===(r=e.filter)||void 0===r?void 0:r.event;return n&&(null===(a=t.ids)||void 0===a?void 0:a.includes(n))&&("*"===s||(null==s?void 0:s.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{let r=null===(o=null===(s=null==e?void 0:e.filter)||void 0===s?void 0:s.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof c&&"ids"in c){let e=c.data,{schema:t,table:r,commit_timestamp:a,type:i,errors:n}=e;c=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:a,eventType:i,new:{},old:{},errors:n}),this._getPayloadRecords(e))}e.callback(c,r)})}_isClosed(){return this.state===c.closed}_isJoined(){return this.state===c.joined}_isJoining(){return this.state===c.joining}_isLeaving(){return this.state===c.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let a=e.toLocaleLowerCase(),i={type:a,filter:t,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(e=>{var a;return!((null===(a=e.type)||void 0===a?void 0:a.toLocaleLowerCase())===r&&V.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(d.close,{},e)}_onError(e){this._on(d.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=c.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=N(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=N(e.columns,e.old_record)),t}}let K=()=>{};class z{constructor(e,t){var a,i;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=k,this.params={},this.timeout=1e4,this.transport=E.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=K,this.conn=null,this.sendBuffer=[],this.serializer=new I,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.t.bind(r,2287,23)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${h.websocket}`,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.transport)&&(this.transport=t.transport),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let n=null===(a=null==t?void 0:t.params)||void 0===a?void 0:a.eventsPerSecond;n&&(this.eventsPerSecondLimitMs=Math.floor(1e3/n));let s=null===(i=null==t?void 0:t.params)||void 0===i?void 0:i.apikey;s&&(this.accessToken=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new A(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){!this.conn&&(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case u.connecting:return p.Connecting;case u.open:return p.Open;case u.closing:return p.Closing;default:return p.Closed}}isConnected(){return this.connectionState()===p.Open}channel(e,t={config:{}}){let r=new V(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){let{topic:t,event:r,payload:a,ref:i}=e,n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};if(this.log("push",`${t} ${r} (${i})`,a),this.isConnected()){if(["broadcast","presence","postgres_changes"].includes(r)){let e=this._throttle(n)();if(e)return"rate limited"}else n()}else this.sendBuffer.push(n)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(d.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:r,payload:a,ref:i}=e;(i&&i===this.pendingHeartbeatRef||r===(null==a?void 0:a.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${a.status||""} ${t} ${r} ${i&&"("+i+")"||""}`,a),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,a,i)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(d.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return`${e}${r}${a}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>!!this.inThrottle||(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class F extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function q(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class H extends F{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class G extends F{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let J=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.t.bind(r,2287,23)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},W=()=>(function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((a=a.apply(e,t||[])).next())})})(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(r.t.bind(r,2287,23))).Response:Response});var Y=function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((a=a.apply(e,t||[])).next())})};let Q=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),X=(e,t)=>Y(void 0,void 0,void 0,function*(){let r=yield W();e instanceof r?e.json().then(r=>{t(new H(Q(r),e.status||500))}).catch(e=>{t(new G(Q(e),e))}):t(new G(Q(e),e))}),ee=(e,t,r,a)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),r))};function et(e,t,r,a,i,n){return Y(this,void 0,void 0,function*(){return new Promise((s,o)=>{e(r,ee(t,a,i,n)).then(e=>{if(!e.ok)throw e;return(null==a?void 0:a.noResolveJson)?e:e.json()}).then(e=>s(e)).catch(e=>X(e,o))})})}function er(e,t,r,a){return Y(this,void 0,void 0,function*(){return et(e,"GET",t,r,a)})}function ea(e,t,r,a,i){return Y(this,void 0,void 0,function*(){return et(e,"POST",t,a,i,r)})}function ei(e,t,r,a,i){return Y(this,void 0,void 0,function*(){return et(e,"DELETE",t,a,i,r)})}var en=function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((a=a.apply(e,t||[])).next())})};let es={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class el{constructor(e,t={},r,a){this.url=e,this.headers=t,this.bucketId=r,this.fetch=J(a)}uploadOrUpdate(e,t,r,a){return en(this,void 0,void 0,function*(){try{let i;let n=Object.assign(Object.assign({},eo),a),s=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?((i=new FormData).append("cacheControl",n.cacheControl),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r).append("cacheControl",n.cacheControl):(i=r,s["cache-control"]=`max-age=${n.cacheControl}`,s["content-type"]=n.contentType);let o=this._removeEmptyFolders(t),l=this._getFinalPath(o),u=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:s},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));if(u.ok)return{data:{path:o},error:null};{let e=yield u.json();return{data:null,error:e}}}catch(e){if(q(e))return{data:null,error:e};throw e}})}upload(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,a){return en(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),n=this._getFinalPath(i),s=new URL(this.url+`/object/upload/sign/${n}`);s.searchParams.set("token",t);try{let e;let t=Object.assign({upsert:eo.upsert},a),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);let o=yield this.fetch(s.toString(),{method:"PUT",body:e,headers:n});if(o.ok)return{data:{path:i},error:null};{let e=yield o.json();return{data:null,error:e}}}catch(e){if(q(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e){return en(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e),r=yield ea(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),a=new URL(this.url+r.url),i=a.searchParams.get("token");if(!i)throw new F("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:i},error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}update(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return en(this,void 0,void 0,function*(){try{let r=yield ea(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});return{data:r,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}copy(e,t){return en(this,void 0,void 0,function*(){try{let r=yield ea(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});return{data:{path:r.Key},error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,r){return en(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),i=yield ea(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"",s=encodeURI(`${this.url}${i.signedURL}${n}`);return{data:i={signedUrl:s},error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,r){return en(this,void 0,void 0,function*(){try{let a=yield ea(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:a.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}download(e,t){return en(this,void 0,void 0,function*(){let r=void 0!==(null==t?void 0:t.transform),a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=a?`?${a}`:"";try{let t=this._getFinalPath(e),a=yield er(this.fetch,`${this.url}/${r?"render/image/authenticated":"object"}/${t}${i}`,{headers:this.headers,noResolveJson:!0}),n=yield a.blob();return{data:n,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}getPublicUrl(e,t){let r=this._getFinalPath(e),a=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&a.push(i);let n=void 0!==(null==t?void 0:t.transform),s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==s&&a.push(s);let o=a.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n?"render/image":"object"}/public/${r}${o}`)}}}remove(e){return en(this,void 0,void 0,function*(){try{let t=yield ei(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers});return{data:t,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}list(e,t,r){return en(this,void 0,void 0,function*(){try{let a=Object.assign(Object.assign(Object.assign({},es),t),{prefix:e||""}),i=yield ea(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r);return{data:i,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let eu={"X-Client-Info":"storage-js/2.5.4"};var ec=function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((a=a.apply(e,t||[])).next())})};class ed{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},eu),t),this.fetch=J(r)}listBuckets(){return ec(this,void 0,void 0,function*(){try{let e=yield er(this.fetch,`${this.url}/bucket`,{headers:this.headers});return{data:e,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}getBucket(e){return ec(this,void 0,void 0,function*(){try{let t=yield er(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers});return{data:t,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}createBucket(e,t={public:!1}){return ec(this,void 0,void 0,function*(){try{let r=yield ea(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return ec(this,void 0,void 0,function*(){try{let r=yield function(e,t,r,a,i){return Y(this,void 0,void 0,function*(){return et(e,"PUT",t,a,void 0,r)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}emptyBucket(e){return ec(this,void 0,void 0,function*(){try{let t=yield ea(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers});return{data:t,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}deleteBucket(e){return ec(this,void 0,void 0,function*(){try{let t=yield ei(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers});return{data:t,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}}class eh extends ed{constructor(e,t={},r){super(e,t,r)}from(e){return new el(this.url,this.headers,e,this.fetch)}}let ep="";ep="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let ef={"X-Client-Info":`supabase-js-${ep}/2.38.0`},em=e=>{let t;return t=e||("undefined"==typeof fetch?_():fetch),(...e)=>t(...e)},eg=()=>"undefined"==typeof Headers?b.Headers:Headers,ey=(e,t,r)=>{let a=em(r),i=eg();return(r,n)=>(function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((a=a.apply(e,t||[])).next())})})(void 0,void 0,void 0,function*(){var s;let o=null!==(s=yield t())&&void 0!==s?s:e,l=new i(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),a(r,Object.assign(Object.assign({},n),{headers:l}))})},ev=()=>"undefined"!=typeof document,eb={tested:!1,writable:!1},e_=()=>{if(!ev())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(eb.tested)return eb.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),eb.tested=!0,eb.writable=!0}catch(e){eb.tested=!0,eb.writable=!1}return eb.writable};function ew(e){let t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{let e=new URLSearchParams(r.hash.substring(1));e.forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}let ex=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.t.bind(r,2287,23)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},eP=e=>"object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json,eO=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},eT=async(e,t)=>{let r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},eS=async(e,t)=>{await e.removeItem(t)};class eE{constructor(){this.promise=new eE.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function ek(e){let t=e.split(".");if(3!==t.length)throw Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw Error("JWT is not valid: payload is not in base64url format");let r=t[1];return JSON.parse(function(e){let t,r,a,i,n,s,o;let l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;for(e=e.replace("-","+").replace("_","/");c<e.length;)i=l.indexOf(e.charAt(c++)),n=l.indexOf(e.charAt(c++)),s=l.indexOf(e.charAt(c++)),o=l.indexOf(e.charAt(c++)),t=i<<2|n>>4,r=(15&n)<<4|s>>2,a=(3&s)<<6|o,u+=String.fromCharCode(t),64!=s&&0!=r&&(u+=String.fromCharCode(r)),64!=o&&0!=a&&(u+=String.fromCharCode(a));return u}(r))}async function eA(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function eI(e){return("0"+e.toString(16)).substr(-2)}function eC(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,r="";for(let a=0;a<56;a++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,eI).join("")}async function ej(e){let t=new TextEncoder,r=t.encode(e),a=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(a);return Array.from(i).map(e=>String.fromCharCode(e)).join("")}async function eN(e){let t="undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder;if(!t)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;let r=await ej(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}eE.promiseConstructor=Promise;class eR extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function eL(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class eM extends eR{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class eD extends eR{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class e$ extends eR{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class eZ extends e${constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class eU extends e${constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class eB extends e${constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class eV extends e${constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class eK extends e${constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ez extends e${constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function eF(e){return eL(e)&&"AuthRetryableFetchError"===e.name}var eq=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)0>t.indexOf(a[i])&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};let eH=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),eG=[502,503,504];async function eJ(e){let t;if(!eP(e))throw new ez(eH(e),0);if(eG.includes(e.status))throw new ez(eH(e),e.status);try{t=await e.json()}catch(e){throw new eD(eH(e),e)}throw new eM(eH(t),e.status||500)}let eW=(e,t,r,a)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),r))};async function eY(e,t,r,a){var i;let n=Object.assign({},null==a?void 0:a.headers);(null==a?void 0:a.jwt)&&(n.Authorization=`Bearer ${a.jwt}`);let s=null!==(i=null==a?void 0:a.query)&&void 0!==i?i:{};(null==a?void 0:a.redirectTo)&&(s.redirect_to=a.redirectTo);let o=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await eQ(e,t,r+o,{headers:n,noResolveJson:null==a?void 0:a.noResolveJson},{},null==a?void 0:a.body);return(null==a?void 0:a.xform)?null==a?void 0:a.xform(l):{data:Object.assign({},l),error:null}}async function eQ(e,t,r,a,i,n){let s;let o=eW(t,a,i,n);try{s=await e(r,o)}catch(e){throw console.error(e),new ez(eH(e),0)}if(s.ok||await eJ(s),null==a?void 0:a.noResolveJson)return s;try{return await s.json()}catch(e){await eJ(e)}}function eX(e){var t;let r=null;e.access_token&&e.refresh_token&&e.expires_in&&(r=Object.assign({},e),e.expires_at||(r.expires_at=function(e){let t=Math.round(Date.now()/1e3);return t+e}(e.expires_in)));let a=null!==(t=e.user)&&void 0!==t?t:e;return{data:{session:r,user:a},error:null}}function e0(e){var t;let r=null!==(t=e.user)&&void 0!==t?t:e;return{data:{user:r},error:null}}function e1(e){return{data:e,error:null}}function e2(e){let{action_link:t,email_otp:r,hashed_token:a,redirect_to:i,verification_type:n}=e,s=eq(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o=Object.assign({},s);return{data:{properties:{action_link:t,email_otp:r,hashed_token:a,redirect_to:i,verification_type:n},user:o},error:null}}function e3(e){return e}var e4=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)0>t.indexOf(a[i])&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};class e5{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=ex(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await eY(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(eL(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await eY(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:e0})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,r=e4(e,["options"]),a=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(a.new_email=null==r?void 0:r.newEmail,delete a.newEmail),await eY(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:e2,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(eL(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await eY(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:e0})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,a,i,n,s,o;try{let l={nextPage:null,lastPage:0,total:0},u=await eY(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(a=null==e?void 0:e.perPage)||void 0===a?void 0:a.toString())&&void 0!==i?i:""},xform:e3});if(u.error)throw u.error;let c=await u.json(),d=null!==(n=u.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(o=null===(s=u.headers.get("link"))||void 0===s?void 0:s.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(eL(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await eY(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:e0})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await eY(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:e0})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await eY(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:e0})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{let{data:t,error:r}=await eY(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(eL(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{let t=await eY(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers});return{data:t,error:null}}catch(e){if(eL(e))return{data:null,error:e};throw e}}}let e6="2.55.0",e9={"X-Client-Info":`gotrue-js/${e6}`},e8={getItem:e=>e_()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{e_()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{e_()&&globalThis.localStorage.removeItem(e)}};function e7(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}globalThis&&e_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class te extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();let tt={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:e9,flowType:"implicit",debug:!1};async function tr(e,t,r){return await r()}class ta{constructor(e){var t;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ta.nextInstanceID,ta.nextInstanceID+=1,this.instanceID>0&&ev()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let r=Object.assign(Object.assign({},tt),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new e5({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=ex(r.fetch),this.lock=r.lock||tr,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:e_()?this.storage=e8:(this.memoryStorage={},this.storage=e7(this.memoryStorage)):(this.memoryStorage={},this.storage=e7(this.memoryStorage)),ev()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(t=this.broadcastChannel)||void 0===t||t.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${e6}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{let e=!!ev()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){let{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};let{session:a,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",a,"redirect type",i),await this._saveSession(a),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(eL(e))return{error:e};return{error:new eD("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,r,a;try{let i;if(await this._removeSession(),"email"in e){let{email:r,password:a,options:n}=e,s=null,o=null;if("pkce"===this.flowType){let e=eC();await eO(this.storage,`${this.storageKey}-code-verifier`,e),s=await eN(e),o=e===s?"plain":"s256"}i=await eY(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:r,password:a,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:s,code_challenge_method:o},xform:eX})}else if("phone"in e){let{phone:t,password:n,options:s}=e;i=await eY(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},channel:null!==(a=null==s?void 0:s.channel)&&void 0!==a?a:"sms",gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:eX})}else throw new eB("You must provide either an email or phone number and a password");let{data:n,error:s}=i;if(s||!n)return{data:{user:null,session:null},error:s};let o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if(await this._removeSession(),"email"in e){let{email:r,password:a,options:i}=e;t=await eY(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:a,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:eX})}else if("phone"in e){let{phone:r,password:a,options:i}=e;t=await eY(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:a,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:eX})}else throw new eB("You must provide either an email or phone number and a password");let{data:r,error:a}=t;if(a)return{data:{user:null,session:null},error:a};if(!r||!r.session||!r.user)return{data:{user:null,session:null},error:new eU};return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:a}}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,r,a,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let t=await eT(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:a}=await eY(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:eX});return(await eS(this.storage,`${this.storageKey}-code-verifier`),a)?{data:{user:null,session:null},error:a}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:a}):{data:{user:null,session:null},error:new eU}}async signInWithIdToken(e){await this._removeSession();try{let{options:t,provider:r,token:a,access_token:i,nonce:n}=e,s=await eY(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:eX}),{data:o,error:l}=s;if(l)return{data:{user:null,session:null},error:l};if(!o||!o.session||!o.user)return{data:{user:null,session:null},error:new eU};return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,r,a,i,n;try{if(await this._removeSession(),"email"in e){let{email:a,options:i}=e,n=null,s=null;if("pkce"===this.flowType){let e=eC();await eO(this.storage,`${this.storageKey}-code-verifier`,e),n=await eN(e),s=e===n?"plain":"s256"}let{error:o}=await eY(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:s},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){let{phone:t,options:r}=e,{data:s,error:o}=await eY(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(a=null==r?void 0:r.data)&&void 0!==a?a:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(n=null==r?void 0:r.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==s?void 0:s.message_id},error:o}}throw new eB("You must provide either an email or phone number.")}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,r;try{let a,i;"email_change"!==e.type&&"phone_change"!==e.type&&await this._removeSession(),"options"in e&&(a=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(r=e.options)||void 0===r?void 0:r.captchaToken);let{data:n,error:s}=await eY(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:eX});if(s)throw s;if(!n)throw Error("An error occurred on token verification.");let o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,r,a;try{return await this._removeSession(),await eY(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(a=null==e?void 0:e.options)||void 0===a?void 0:a.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:e1})}catch(e){if(eL(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new eZ;let{error:a}=await eY(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{"email_change"!=e.type&&"phone_change"!=e.type&&await this._removeSession();let t=`${this.url}/resend`;if("email"in e){let{email:r,type:a,options:i}=e,{error:n}=await eY(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){let{phone:r,type:a,options:i}=e,{data:n,error:s}=await eY(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:s}}throw new eB("You must provide either an email or phone number and a type")}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let e=null,t=await eT(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let r=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return{data:{session:e},error:null};let{session:a,error:i}=await this._callRefreshToken(e.refresh_token);if(i)return{data:{session:null},error:i};return{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await eY(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:e0});return await this._useSession(async e=>{var t,r;let{data:a,error:i}=e;if(i)throw i;return await eY(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(t=a.session)||void 0===t?void 0:t.access_token)&&void 0!==r?r:void 0,xform:e0})})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{let{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new eZ;let n=a.session,s=null,o=null;if("pkce"===this.flowType&&null!=e.email){let e=eC();await eO(this.storage,`${this.storageKey}-code-verifier`,e),s=await eN(e),o=e===s?"plain":"s256"}let{data:l,error:u}=await eY(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:s,code_challenge_method:o}),jwt:n.access_token,xform:e0});if(u)throw u;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(e){if(eL(e))return{data:{user:null},error:e};throw e}}_decodeJWT(e){return ek(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new eZ;let t=Date.now()/1e3,r=t,a=!0,i=null,n=ek(e.access_token);if(n.exp&&(a=(r=n.exp)<=t),a){let{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};i=t}else{let{data:a,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(eL(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){let{data:a,error:i}=t;if(i)throw i;e=null!==(r=a.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new eZ;let{session:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(eL(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e){try{if(!ev())throw new eV("No browser detected.");if("implicit"!==this.flowType||this._isImplicitGrantFlow()){if("pkce"==this.flowType&&!e)throw new eK("Not a valid PKCE flow url.")}else throw new eV("Not a valid implicit grant flow url.");let t=ew(window.location.href);if(e){if(!t.code)throw new eK("No code detected.");let{data:e,error:r}=await this._exchangeCodeForSession(t.code);if(r)throw r;let a=new URL(window.location.href);return a.searchParams.delete("code"),window.history.replaceState(window.history.state,"",a.toString()),{data:{session:e.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new eV(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});let{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:n,expires_in:s,expires_at:o,token_type:l}=t;if(!i||!s||!n||!l)throw new eV("No session defined in URL");let u=Math.round(Date.now()/1e3),c=parseInt(s),d=u+c;o&&(d=parseInt(o));let h=d-u;1e3*h<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${c}s`);let p=d-c;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,d,u);let{data:f,error:m}=await this._getUser(i);if(m)throw m;let g={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:c,expires_at:d,refresh_token:n,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:t.type},error:null}}catch(e){if(eL(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantFlow(){let e=ew(window.location.href);return!!(ev()&&(e.access_token||e.error_description))}async _isPKCEFlow(){let e=ew(window.location.href),t=await eT(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;let{data:a,error:i}=t;if(i)return{error:i};let n=null===(r=a.session)||void 0===r?void 0:r.access_token;if(n){let{error:t}=await this.admin.signOut(n,e);if(t&&!(eL(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status)))return{error:t}}return"others"!==e&&(await this._removeSession(),await eS(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,a;try{let{data:{session:a},error:i}=t;if(i)throw i;await (null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(t){await (null===(a=this.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,a=null;if("pkce"===this.flowType){let e=eC();await eO(this.storage,`${this.storageKey}-code-verifier`,e),r=await eN(e),a=e===r?"plain":"s256"}try{return await eY(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(eL(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{let r=Date.now();return await function(e,t){let r=new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{let a=await e(i);if(!t(i,null,a)){r(a);return}}catch(e){if(!t(i,e)){a(e);return}}})()});return r}(async r=>(await eA(200*r),this._debug(t,"refreshing attempt",r),await eY(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:eX})),(e,t,a)=>a&&a.error&&eF(a.error)&&Date.now()+(e+1)*200-r<3e4)}catch(e){if(this._debug(t,"error",e),eL(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let r=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ev()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;let t="#_recoverAndRefresh()";this._debug(t,"begin");try{let r=await eT(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),null!==r&&await this._removeSession();return}let a=Math.round(Date.now()/1e3),i=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<a+10;if(this._debug(t,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&r.refresh_token){let{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),eF(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(e){this._debug(t,"error",e),console.error(e);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new eZ;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new eE;let{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new eZ;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let a={session:t.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(e){if(this._debug(a,"error",e),eL(e)){let r={session:null,error:e};return null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t,r=!0){let a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});let a=[],i=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){a.push(e)}});if(await Promise.all(i),a.length>0){for(let e=0;e<a.length;e+=1)console.error(a[e]);throw a[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),eO(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await eS(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ev()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let a=Math.floor((1e3*r.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),a<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof te)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ev()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if("visible"!==document.visibilityState){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){let r=[`provider=${encodeURIComponent(e)}`];if((null==t?void 0:t.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),(null==t?void 0:t.scopes)&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===this.flowType){let e=eC();await eO(this.storage,`${this.storageKey}-code-verifier`,e);let t=await eN(e),a=e===t?"plain":"s256";this._debug("PKCE","code verifier",`${e.substring(0,5)}...`,"code challenge",t,"method",a);let i=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(i.toString())}if(null==t?void 0:t.queryParams){let e=new URLSearchParams(t.queryParams);r.push(e.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;let{data:a,error:i}=t;return i?{data:null,error:i}:await eY(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==a?void 0:a.session)||void 0===r?void 0:r.access_token})})}catch(e){if(eL(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,a;let{data:i,error:n}=t;if(n)return{data:null,error:n};let{data:s,error:o}=await eY(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:((null===(a=null==s?void 0:s.totp)||void 0===a?void 0:a.qr_code)&&(s.totp.qr_code=`data:image/svg+xml;utf-8,${s.totp.qr_code}`),{data:s,error:null})})}catch(e){if(eL(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:a,error:i}=t;if(i)return{data:null,error:i};let{data:n,error:s}=await eY(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==a?void 0:a.session)||void 0===r?void 0:r.access_token});return s?{data:null,error:s}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:s})})}catch(e){if(eL(e))return{data:null,error:e};throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:a,error:i}=t;return i?{data:null,error:i}:await eY(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:null===(r=null==a?void 0:a.session)||void 0===r?void 0:r.access_token})})}catch(e){if(eL(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(e){let{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let r=(null==e?void 0:e.factors)||[],a=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;let{data:{session:a},error:i}=e;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let n=this._decodeJWT(a.access_token),s=null;n.aal&&(s=n.aal);let o=s,l=null!==(r=null===(t=a.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[];l.length>0&&(o="aal2");let u=n.amr||[];return{data:{currentLevel:s,nextLevel:o,currentAuthenticationMethods:u},error:null}}))}}ta.nextInstanceID=0;class ti extends ta{constructor(e){super(e)}}let tn={headers:ef},ts={schema:"public"},to={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tl={};class tu{constructor(e,t,r){var a,i,n,s,o,l,u,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw Error("supabaseUrl is required.");if(!t)throw Error("supabaseKey is required.");let d=e.replace(/\/$/,"");this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;let h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,p={db:ts,realtime:tl,auth:Object.assign(Object.assign({},to),{storageKey:h}),global:tn},f=function(e,t){let{db:r,auth:a,realtime:i,global:n}=e,{db:s,auth:o,realtime:l,global:u}=t;return{db:Object.assign(Object.assign({},s),r),auth:Object.assign(Object.assign({},o),a),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},u),n)}}(null!=r?r:{},p);this.storageKey=null!==(i=null===(a=f.auth)||void 0===a?void 0:a.storageKey)&&void 0!==i?i:"",this.headers=null!==(s=null===(n=f.global)||void 0===n?void 0:n.headers)&&void 0!==s?s:{},this.auth=this._initSupabaseAuthClient(null!==(o=f.auth)&&void 0!==o?o:{},this.headers,null===(l=f.global)||void 0===l?void 0:l.fetch),this.fetch=ey(t,this._getAccessToken.bind(this),null===(u=f.global)||void 0===u?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new S(`${d}/rest/v1`,{headers:this.headers,schema:null===(c=f.db)||void 0===c?void 0:c.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new l(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new eh(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,r,a,i,n;return r=this,a=void 0,i=void 0,n=function*(){let{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null},new(i||(i=Promise))(function(e,t){function s(e){try{l(n.next(e))}catch(e){t(e)}}function o(e){try{l(n.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):((r=t.value)instanceof i?r:new i(function(e){e(r)})).then(s,o)}l((n=n.apply(r,a||[])).next())})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,storageKey:i,flowType:n,debug:s},o,l){let u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ti({url:this.authUrl,headers:Object.assign(Object.assign({},u),o),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,flowType:n,debug:s,fetch:l})}_initRealtimeClient(e){return new z(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r):"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}}let tc=(e,t,r)=>new tu(e,t,r)},551:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),r=t[0],a=t[1];return(r+a)*3/4-a},t.toByteArray=function(e){var t,r,n=l(e),s=n[0],o=n[1],u=new i((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,a=e.length,i=a%3,n=[],s=0,o=a-i;s<o;s+=16383)n.push(function(e,t,a){for(var i,n=[],s=t;s<a;s+=3)n.push(r[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return n.join("")}(e,s,s+16383>o?o:s+16383));return 1===i?n.push(r[(t=e[a-1])>>2]+r[t<<4&63]+"=="):2===i&&n.push(r[(t=(e[a-2]<<8)+e[a-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),n.join("")};for(var r=[],a=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=n.length;s<o;++s)r[s]=n[s],a[n.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var a=r===t?0:4-r%4;return[r,a]}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},4108:e=>{"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,n=/[_.\- ]+/,s=RegExp("^"+n.source),o=RegExp(n.source+i.source,"gu"),l=RegExp("\\d+"+i.source,"gu"),u=(e,a,i)=>{let n=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];n&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,n=!0):(n=a(u)===u&&i(u)!==u,o=s,s=i(u)===u&&a(u)!==u)}return e},c=(e,t)=>(a.lastIndex=0,e.replace(a,e=>t(e))),d=(e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,r)=>t(r)).replace(l,e=>t(e))),h=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);if(1===e.length)return t.pascalCase?a(e):r(e);let i=e!==r(e);return i&&(e=u(e,r,a)),e=e.replace(s,""),e=t.preserveConsecutiveUppercase?c(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),d(e,a)};e.exports=h,e.exports.default=h},4490:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},4178:e=>{"use strict";var t=function(){if("object"==typeof self&&self)return self;throw Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{if(!__global__)return t();return __global__}finally{delete Object.prototype.__global__}}()},1342:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function a(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,a,n,s){if("function"!=typeof a)throw TypeError("The listener must be a function");var o=new i(a,n||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,a,i=[];if(0===this._eventsCount)return i;for(a in e=this._events)t.call(e,a)&&i.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var i=0,n=a.length,s=Array(n);i<n;i++)s[i]=a[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},o.prototype.emit=function(e,t,a,i,n,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,a),!0;case 4:return c.fn.call(c.context,t,a,i),!0;case 5:return c.fn.call(c.context,t,a,i,n),!0;case 6:return c.fn.call(c.context,t,a,i,n,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,a);break;case 4:c[u].fn.call(c[u].context,t,a,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,a,i){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||i&&!o.once||a&&o.context!==a||s(this,n);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||a&&o[l].context!==a)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:s(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},635:(e,t)=>{var r=/~/,a=/~[01]/g;function i(e){switch(e){case"~1":return"/";case"~0":return"~"}throw Error("Invalid tilde escape: "+e)}},204:(e,t,r)=>{"use strict";e=r.nmd(e);let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,i=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,i]of Object.entries(a))t[r]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},a[r]=t[r],e.set(i[0],i[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=i(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},3928:e=>{"use strict";var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,n={};function s(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`].filter(Boolean);return`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}; ${r.join("; ")}`}function o(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[a,i]=[r.slice(0,e),r.slice(e+1)];try{t.set(a,decodeURIComponent(null!=i?i:"true"))}catch{}}return t}((e,r)=>{for(var a in r)t(e,a,{get:r[a],enumerable:!0})})(n,{RequestCookies:()=>u,ResponseCookies:()=>c}),e.exports=((e,n,s,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let s of a(n))i.call(e,s)||void 0===s||t(e,s,{get:()=>n[s],enumerable:!(o=r(n,s))||o.enumerable});return e})(t({},"__esModule",{value:!0}),n);var l=["strict","lax","none"],u=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t){let e=o(t);for(let[t,r]of e)this._parsed.set(t,{name:t,value:r})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===a).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,a=this._parsed;return a.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(a).map(([e,t])=>s(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>s(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},c=class{constructor(e){var t,r,a;this._parsed=new Map,this._headers=e;let i=null!=(a=null!=(r=null==(t=e.getAll)?void 0:t.call(e,"set-cookie"))?r:e.get("set-cookie"))?a:[],n=Array.isArray(i)?i:function(e){if(!e)return[];var t,r,a,i,n,s=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,n=!1;l();)if(","===(r=e.charAt(o))){for(a=o,o+=1,l(),i=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(n=!0,o=i,s.push(e.substring(t,a)),t=o):o=a+1}else o+=1;(!n||o>=e.length)&&s.push(e.substring(t,e.length))}return s}(i);for(let e of n){let t=function(e){var t;if(!e)return;let[[r,a],...i]=o(e),{domain:n,expires:s,httponly:u,maxage:c,path:d,samesite:h,secure:p}=Object.fromEntries(i.map(([e,t])=>[e.toLowerCase(),t])),f={name:r,value:decodeURIComponent(a),domain:n,...s&&{expires:new Date(s)},...u&&{httpOnly:!0},..."string"==typeof c&&{maxAge:Number(c)},path:d,...h&&{sameSite:(t=(t=h).toLowerCase(),l.includes(t)?t:void 0)},...p&&{secure:!0}};return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}(f)}(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===a)}set(...e){let[t,r,a]=1===e.length?[e[0].name,e[0].value,e[0]]:e,i=this._parsed;return i.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...a})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=s(r);t.append("set-cookie",e)}}(i,this._headers),this}delete(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this.set({name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(s).join("; ")}}},5049:(e,t,r)=>{"use strict";(()=>{var t={339:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=void 0;let a=r(44),i=r(38),n=r(741),s="context",o=new a.NoopContextManager;class l{constructor(){}static getInstance(){return this._instance||(this._instance=new l),this._instance}setGlobalContextManager(e){return(0,i.registerGlobal)(s,e,n.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,r,...a){return this._getContextManager().with(e,t,r,...a)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,i.getGlobal)(s)||o}disable(){this._getContextManager().disable(),(0,i.unregisterGlobal)(s,n.DiagAPI.instance())}}t.ContextAPI=l},741:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagAPI=void 0;let a=r(144),i=r(871),n=r(133),s=r(38);class o{constructor(){function e(e){return function(...t){let r=(0,s.getGlobal)("diag");if(r)return r[e](...t)}}let t=this;t.setLogger=(e,r={logLevel:n.DiagLogLevel.INFO})=>{var a,o,l;if(e===t){let e=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(a=e.stack)&&void 0!==a?a:e.message),!1}"number"==typeof r&&(r={logLevel:r});let u=(0,s.getGlobal)("diag"),c=(0,i.createLogLevelDiagLogger)(null!==(o=r.logLevel)&&void 0!==o?o:n.DiagLogLevel.INFO,e);if(u&&!r.suppressOverrideMessage){let e=null!==(l=Error().stack)&&void 0!==l?l:"<failed to generate stacktrace>";u.warn(`Current logger will be overwritten from ${e}`),c.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,s.registerGlobal)("diag",c,t,!0)},t.disable=()=>{(0,s.unregisterGlobal)("diag",t)},t.createComponentLogger=e=>new a.DiagComponentLogger(e),t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}static instance(){return this._instance||(this._instance=new o),this._instance}}t.DiagAPI=o},128:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsAPI=void 0;let a=r(333),i=r(38),n=r(741),s="metrics";class o{constructor(){}static getInstance(){return this._instance||(this._instance=new o),this._instance}setGlobalMeterProvider(e){return(0,i.registerGlobal)(s,e,n.DiagAPI.instance())}getMeterProvider(){return(0,i.getGlobal)(s)||a.NOOP_METER_PROVIDER}getMeter(e,t,r){return this.getMeterProvider().getMeter(e,t,r)}disable(){(0,i.unregisterGlobal)(s,n.DiagAPI.instance())}}t.MetricsAPI=o},930:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropagationAPI=void 0;let a=r(38),i=r(600),n=r(625),s=r(377),o=r(701),l=r(741),u="propagation",c=new i.NoopTextMapPropagator;class d{constructor(){this.createBaggage=o.createBaggage,this.getBaggage=s.getBaggage,this.getActiveBaggage=s.getActiveBaggage,this.setBaggage=s.setBaggage,this.deleteBaggage=s.deleteBaggage}static getInstance(){return this._instance||(this._instance=new d),this._instance}setGlobalPropagator(e){return(0,a.registerGlobal)(u,e,l.DiagAPI.instance())}inject(e,t,r=n.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,r)}extract(e,t,r=n.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,r)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,a.unregisterGlobal)(u,l.DiagAPI.instance())}_getGlobalPropagator(){return(0,a.getGlobal)(u)||c}}t.PropagationAPI=d},967:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceAPI=void 0;let a=r(38),i=r(414),n=r(994),s=r(542),o=r(741),l="trace";class u{constructor(){this._proxyTracerProvider=new i.ProxyTracerProvider,this.wrapSpanContext=n.wrapSpanContext,this.isSpanContextValid=n.isSpanContextValid,this.deleteSpan=s.deleteSpan,this.getSpan=s.getSpan,this.getActiveSpan=s.getActiveSpan,this.getSpanContext=s.getSpanContext,this.setSpan=s.setSpan,this.setSpanContext=s.setSpanContext}static getInstance(){return this._instance||(this._instance=new u),this._instance}setGlobalTracerProvider(e){let t=(0,a.registerGlobal)(l,this._proxyTracerProvider,o.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t}getTracerProvider(){return(0,a.getGlobal)(l)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,a.unregisterGlobal)(l,o.DiagAPI.instance()),this._proxyTracerProvider=new i.ProxyTracerProvider}}t.TraceAPI=u},377:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;let a=r(339),i=r(421),n=(0,i.createContextKey)("OpenTelemetry Baggage Key");function s(e){return e.getValue(n)||void 0}t.getBaggage=s,t.getActiveBaggage=function(){return s(a.ContextAPI.getInstance().active())},t.setBaggage=function(e,t){return e.setValue(n,t)},t.deleteBaggage=function(e){return e.deleteValue(n)}},496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaggageImpl=void 0;class r{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){let t=this._entries.get(e);if(t)return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map(([e,t])=>[e,t])}setEntry(e,t){let a=new r(this._entries);return a._entries.set(e,t),a}removeEntry(e){let t=new r(this._entries);return t._entries.delete(e),t}removeEntries(...e){let t=new r(this._entries);for(let r of e)t._entries.delete(r);return t}clear(){return new r}}t.BaggageImpl=r},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataSymbol=void 0,t.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")},701:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataFromString=t.createBaggage=void 0;let a=r(741),i=r(496),n=r(817),s=a.DiagAPI.instance();t.createBaggage=function(e={}){return new i.BaggageImpl(new Map(Object.entries(e)))},t.baggageEntryMetadataFromString=function(e){return"string"!=typeof e&&(s.error(`Cannot create baggage metadata from unknown type: ${typeof e}`),e=""),{__TYPE__:n.baggageEntryMetadataSymbol,toString:()=>e}}},388:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.context=void 0;let a=r(339);t.context=a.ContextAPI.getInstance()},44:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopContextManager=void 0;let a=r(421);t.NoopContextManager=class{active(){return a.ROOT_CONTEXT}with(e,t,r,...a){return t.call(r,...a)}bind(e,t){return t}enable(){return this}disable(){return this}}},421:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_CONTEXT=t.createContextKey=void 0,t.createContextKey=function(e){return Symbol.for(e)};class r{constructor(e){let t=this;t._currentContext=e?new Map(e):new Map,t.getValue=e=>t._currentContext.get(e),t.setValue=(e,a)=>{let i=new r(t._currentContext);return i._currentContext.set(e,a),i},t.deleteValue=e=>{let a=new r(t._currentContext);return a._currentContext.delete(e),a}}}t.ROOT_CONTEXT=new r},920:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diag=void 0;let a=r(741);t.diag=a.DiagAPI.instance()},144:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagComponentLogger=void 0;let a=r(38);function i(e,t,r){let i=(0,a.getGlobal)("diag");if(i)return r.unshift(t),i[e](...r)}t.DiagComponentLogger=class{constructor(e){this._namespace=e.namespace||"DiagComponentLogger"}debug(...e){return i("debug",this._namespace,e)}error(...e){return i("error",this._namespace,e)}info(...e){return i("info",this._namespace,e)}warn(...e){return i("warn",this._namespace,e)}verbose(...e){return i("verbose",this._namespace,e)}}},689:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagConsoleLogger=void 0;let r=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];t.DiagConsoleLogger=class{constructor(){for(let e=0;e<r.length;e++)this[r[e].n]=function(e){return function(...t){if(console){let r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}(r[e].c)}}},871:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogLevelDiagLogger=void 0;let a=r(133);t.createLogLevelDiagLogger=function(e,t){function r(r,a){let i=t[r];return"function"==typeof i&&e>=a?i.bind(t):function(){}}return e<a.DiagLogLevel.NONE?e=a.DiagLogLevel.NONE:e>a.DiagLogLevel.ALL&&(e=a.DiagLogLevel.ALL),t=t||{},{error:r("error",a.DiagLogLevel.ERROR),warn:r("warn",a.DiagLogLevel.WARN),info:r("info",a.DiagLogLevel.INFO),debug:r("debug",a.DiagLogLevel.DEBUG),verbose:r("verbose",a.DiagLogLevel.VERBOSE)}}},133:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagLogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(t.DiagLogLevel||(t.DiagLogLevel={}))},38:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;let a=r(966),i=r(520),n=r(565),s=i.VERSION.split(".")[0],o=Symbol.for(`opentelemetry.js.api.${s}`),l=a._globalThis;t.registerGlobal=function(e,t,r,a=!1){var n;let s=l[o]=null!==(n=l[o])&&void 0!==n?n:{version:i.VERSION};if(!a&&s[e]){let t=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);return r.error(t.stack||t.message),!1}if(s.version!==i.VERSION){let t=Error(`@opentelemetry/api: Registration of version v${s.version} for ${e} does not match previously registered API v${i.VERSION}`);return r.error(t.stack||t.message),!1}return s[e]=t,r.debug(`@opentelemetry/api: Registered a global for ${e} v${i.VERSION}.`),!0},t.getGlobal=function(e){var t,r;let a=null===(t=l[o])||void 0===t?void 0:t.version;if(a&&(0,n.isCompatible)(a))return null===(r=l[o])||void 0===r?void 0:r[e]},t.unregisterGlobal=function(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${i.VERSION}.`);let r=l[o];r&&delete r[e]}},565:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompatible=t._makeCompatibilityCheck=void 0;let a=r(520),i=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function n(e){let t=new Set([e]),r=new Set,a=e.match(i);if(!a)return()=>!1;let n={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};if(null!=n.prerelease)return function(t){return t===e};function s(e){return r.add(e),!1}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;let a=e.match(i);if(!a)return s(e);let o={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};return null!=o.prerelease||n.major!==o.major?s(e):0===n.major?n.minor===o.minor&&n.patch<=o.patch?(t.add(e),!0):s(e):n.minor<=o.minor?(t.add(e),!0):s(e)}}t._makeCompatibilityCheck=n,t.isCompatible=n(a.VERSION)},934:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metrics=void 0;let a=r(128);t.metrics=a.MetricsAPI.getInstance()},28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=void 0,function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(t.ValueType||(t.ValueType={}))},962:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class r{constructor(){}createHistogram(e,r){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,r){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,r){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,r){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,r){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,r){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=r;class a{}t.NoopMetric=a;class i extends a{add(e,t){}}t.NoopCounterMetric=i;class n extends a{add(e,t){}}t.NoopUpDownCounterMetric=n;class s extends a{record(e,t){}}t.NoopHistogramMetric=s;class o{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=o;class l extends o{}t.NoopObservableCounterMetric=l;class u extends o{}t.NoopObservableGaugeMetric=u;class c extends o{}t.NoopObservableUpDownCounterMetric=c,t.NOOP_METER=new r,t.NOOP_COUNTER_METRIC=new i,t.NOOP_HISTOGRAM_METRIC=new s,t.NOOP_UP_DOWN_COUNTER_METRIC=new n,t.NOOP_OBSERVABLE_COUNTER_METRIC=new l,t.NOOP_OBSERVABLE_GAUGE_METRIC=new u,t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new c,t.createNoopMeter=function(){return t.NOOP_METER}},333:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;let a=r(962);class i{getMeter(e,t,r){return a.NOOP_METER}}t.NoopMeterProvider=i,t.NOOP_METER_PROVIDER=new i},966:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(652),t)},385:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalThis=void 0,t._globalThis="object"==typeof globalThis?globalThis:r.g},652:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(385),t)},251:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.propagation=void 0;let a=r(930);t.propagation=a.PropagationAPI.getInstance()},600:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTextMapPropagator=void 0,t.NoopTextMapPropagator=class{inject(e,t){}extract(e,t){return e}fields(){return[]}}},625:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextMapSetter=t.defaultTextMapGetter=void 0,t.defaultTextMapGetter={get(e,t){if(null!=e)return e[t]},keys:e=>null==e?[]:Object.keys(e)},t.defaultTextMapSetter={set(e,t,r){null!=e&&(e[t]=r)}}},978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trace=void 0;let a=r(967);t.trace=a.TraceAPI.getInstance()},76:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NonRecordingSpan=void 0;let a=r(304);t.NonRecordingSpan=class{constructor(e=a.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return!1}recordException(e,t){}}},527:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracer=void 0;let a=r(339),i=r(542),n=r(76),s=r(994),o=a.ContextAPI.getInstance();t.NoopTracer=class{startSpan(e,t,r=o.active()){let a=!!(null==t?void 0:t.root);if(a)return new n.NonRecordingSpan;let l=r&&(0,i.getSpanContext)(r);return"object"==typeof l&&"string"==typeof l.spanId&&"string"==typeof l.traceId&&"number"==typeof l.traceFlags&&(0,s.isSpanContextValid)(l)?new n.NonRecordingSpan(l):new n.NonRecordingSpan}startActiveSpan(e,t,r,a){let n,s,l;if(arguments.length<2)return;2==arguments.length?l=t:3==arguments.length?(n=t,l=r):(n=t,s=r,l=a);let u=null!=s?s:o.active(),c=this.startSpan(e,n,u),d=(0,i.setSpan)(u,c);return o.with(d,l,void 0,c)}}},228:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracerProvider=void 0;let a=r(527);t.NoopTracerProvider=class{getTracer(e,t,r){return new a.NoopTracer}}},387:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracer=void 0;let a=r(527),i=new a.NoopTracer;t.ProxyTracer=class{constructor(e,t,r,a){this._provider=e,this.name=t,this.version=r,this.options=a}startSpan(e,t,r){return this._getTracer().startSpan(e,t,r)}startActiveSpan(e,t,r,a){let i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)}_getTracer(){if(this._delegate)return this._delegate;let e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):i}}},414:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracerProvider=void 0;let a=r(387),i=r(228),n=new i.NoopTracerProvider;t.ProxyTracerProvider=class{getTracer(e,t,r){var i;return null!==(i=this.getDelegateTracer(e,t,r))&&void 0!==i?i:new a.ProxyTracer(this,e,t,r)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:n}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,r){var a;return null===(a=this._delegate)||void 0===a?void 0:a.getTracer(e,t,r)}}},505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SamplingDecision=void 0,function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(t.SamplingDecision||(t.SamplingDecision={}))},542:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;let a=r(421),i=r(76),n=r(339),s=(0,a.createContextKey)("OpenTelemetry Context Key SPAN");function o(e){return e.getValue(s)||void 0}function l(e,t){return e.setValue(s,t)}t.getSpan=o,t.getActiveSpan=function(){return o(n.ContextAPI.getInstance().active())},t.setSpan=l,t.deleteSpan=function(e){return e.deleteValue(s)},t.setSpanContext=function(e,t){return l(e,new i.NonRecordingSpan(t))},t.getSpanContext=function(e){var t;return null===(t=o(e))||void 0===t?void 0:t.spanContext()}},430:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStateImpl=void 0;let a=r(450);class i{constructor(e){this._internalState=new Map,e&&this._parse(e)}set(e,t){let r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r}unset(e){let t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){!(e.length>512)&&(this._internalState=e.split(",").reverse().reduce((e,t)=>{let r=t.trim(),i=r.indexOf("=");if(-1!==i){let n=r.slice(0,i),s=r.slice(i+1,t.length);(0,a.validateKey)(n)&&(0,a.validateValue)(s)&&e.set(n,s)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new i;return e._internalState=new Map(this._internalState),e}}t.TraceStateImpl=i},450:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateValue=t.validateKey=void 0;let r="[_0-9a-z-*/]",a=`[a-z]${r}{0,255}`,i=`[a-z0-9]${r}{0,240}@[a-z]${r}{0,13}`,n=RegExp(`^(?:${a}|${i})$`),s=/^[ -~]{0,255}[!-~]$/,o=/,|=/;t.validateKey=function(e){return n.test(e)},t.validateValue=function(e){return s.test(e)&&!o.test(e)}},757:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTraceState=void 0;let a=r(430);t.createTraceState=function(e){return new a.TraceStateImpl(e)}},304:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;let a=r(762);t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:a.TraceFlags.NONE}},902:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanKind=void 0,function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(t.SpanKind||(t.SpanKind={}))},994:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;let a=r(304),i=r(76),n=/^([0-9a-f]{32})$/i,s=/^[0-9a-f]{16}$/i;function o(e){return n.test(e)&&e!==a.INVALID_TRACEID}function l(e){return s.test(e)&&e!==a.INVALID_SPANID}t.isValidTraceId=o,t.isValidSpanId=l,t.isSpanContextValid=function(e){return o(e.traceId)&&l(e.spanId)},t.wrapSpanContext=function(e){return new i.NonRecordingSpan(e)}},832:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanStatusCode=void 0,function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(t.SpanStatusCode||(t.SpanStatusCode={}))},762:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceFlags=void 0,function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(t.TraceFlags||(t.TraceFlags={}))},520:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="1.4.1"}},a={};function i(e){var r=a[e];if(void 0!==r)return r.exports;var n=a[e]={exports:{}},s=!0;try{t[e].call(n.exports,n,n.exports,i),s=!1}finally{s&&delete a[e]}return n.exports}i.ab="//";var n={};(()=>{Object.defineProperty(n,"__esModule",{value:!0}),n.trace=n.propagation=n.metrics=n.diag=n.context=n.INVALID_SPAN_CONTEXT=n.INVALID_TRACEID=n.INVALID_SPANID=n.isValidSpanId=n.isValidTraceId=n.isSpanContextValid=n.createTraceState=n.TraceFlags=n.SpanStatusCode=n.SpanKind=n.SamplingDecision=n.ProxyTracerProvider=n.ProxyTracer=n.defaultTextMapSetter=n.defaultTextMapGetter=n.ValueType=n.createNoopMeter=n.DiagLogLevel=n.DiagConsoleLogger=n.ROOT_CONTEXT=n.createContextKey=n.baggageEntryMetadataFromString=void 0;var e=i(701);Object.defineProperty(n,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return e.baggageEntryMetadataFromString}});var t=i(421);Object.defineProperty(n,"createContextKey",{enumerable:!0,get:function(){return t.createContextKey}}),Object.defineProperty(n,"ROOT_CONTEXT",{enumerable:!0,get:function(){return t.ROOT_CONTEXT}});var r=i(689);Object.defineProperty(n,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var a=i(133);Object.defineProperty(n,"DiagLogLevel",{enumerable:!0,get:function(){return a.DiagLogLevel}});var s=i(962);Object.defineProperty(n,"createNoopMeter",{enumerable:!0,get:function(){return s.createNoopMeter}});var o=i(28);Object.defineProperty(n,"ValueType",{enumerable:!0,get:function(){return o.ValueType}});var l=i(625);Object.defineProperty(n,"defaultTextMapGetter",{enumerable:!0,get:function(){return l.defaultTextMapGetter}}),Object.defineProperty(n,"defaultTextMapSetter",{enumerable:!0,get:function(){return l.defaultTextMapSetter}});var u=i(387);Object.defineProperty(n,"ProxyTracer",{enumerable:!0,get:function(){return u.ProxyTracer}});var c=i(414);Object.defineProperty(n,"ProxyTracerProvider",{enumerable:!0,get:function(){return c.ProxyTracerProvider}});var d=i(505);Object.defineProperty(n,"SamplingDecision",{enumerable:!0,get:function(){return d.SamplingDecision}});var h=i(902);Object.defineProperty(n,"SpanKind",{enumerable:!0,get:function(){return h.SpanKind}});var p=i(832);Object.defineProperty(n,"SpanStatusCode",{enumerable:!0,get:function(){return p.SpanStatusCode}});var f=i(762);Object.defineProperty(n,"TraceFlags",{enumerable:!0,get:function(){return f.TraceFlags}});var m=i(757);Object.defineProperty(n,"createTraceState",{enumerable:!0,get:function(){return m.createTraceState}});var g=i(994);Object.defineProperty(n,"isSpanContextValid",{enumerable:!0,get:function(){return g.isSpanContextValid}}),Object.defineProperty(n,"isValidTraceId",{enumerable:!0,get:function(){return g.isValidTraceId}}),Object.defineProperty(n,"isValidSpanId",{enumerable:!0,get:function(){return g.isValidSpanId}});var y=i(304);Object.defineProperty(n,"INVALID_SPANID",{enumerable:!0,get:function(){return y.INVALID_SPANID}}),Object.defineProperty(n,"INVALID_TRACEID",{enumerable:!0,get:function(){return y.INVALID_TRACEID}}),Object.defineProperty(n,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return y.INVALID_SPAN_CONTEXT}});let v=i(388);Object.defineProperty(n,"context",{enumerable:!0,get:function(){return v.context}});let b=i(920);Object.defineProperty(n,"diag",{enumerable:!0,get:function(){return b.diag}});let _=i(934);Object.defineProperty(n,"metrics",{enumerable:!0,get:function(){return _.metrics}});let w=i(251);Object.defineProperty(n,"propagation",{enumerable:!0,get:function(){return w.propagation}});let x=i(978);Object.defineProperty(n,"trace",{enumerable:!0,get:function(){return x.trace}}),n.default={context:v.context,diag:b.diag,metrics:_.metrics,propagation:w.propagation,trace:x.trace}})(),e.exports=n})()},9063:e=>{"use strict";(()=>{"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//");var t={};(()=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(t,r){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var i={},n=t.split(a),s=(r||{}).decode||e,o=0;o<n.length;o++){var l=n[o],u=l.indexOf("=");if(!(u<0)){var c=l.substr(0,u).trim(),d=l.substr(++u,l.length).trim();'"'==d[0]&&(d=d.slice(1,-1)),void 0==i[c]&&(i[c]=function(e,t){try{return t(e)}catch(t){return e}}(d,s))}}return i},t.serialize=function(e,t,a){var n=a||{},s=n.encode||r;if("function"!=typeof s)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var o=s(t);if(o&&!i.test(o))throw TypeError("argument val is invalid");var l=e+"="+o;if(null!=n.maxAge){var u=n.maxAge-0;if(isNaN(u)||!isFinite(u))throw TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(u)}if(n.domain){if(!i.test(n.domain))throw TypeError("option domain is invalid");l+="; Domain="+n.domain}if(n.path){if(!i.test(n.path))throw TypeError("option path is invalid");l+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw TypeError("option expires is invalid");l+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(l+="; HttpOnly"),n.secure&&(l+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"none":l+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return l};var e=decodeURIComponent,r=encodeURIComponent,a=/; */,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/})(),e.exports=t})()},937:e=>{"use strict";(()=>{var t={806:(e,t,r)=>{let a=r(190),i=Symbol("max"),n=Symbol("length"),s=Symbol("lengthCalculator"),o=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),d=Symbol("lruList"),h=Symbol("cache"),p=Symbol("updateAgeOnGet"),f=()=>1,m=(e,t,r)=>{let a=e[h].get(t);if(a){let t=a.value;if(g(e,t)){if(v(e,a),!e[o])return}else r&&(e[p]&&(a.value.now=Date.now()),e[d].unshiftNode(a));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[l]&&r>e[l]},y=e=>{if(e[n]>e[i])for(let t=e[d].tail;e[n]>e[i]&&null!==t;){let r=t.prev;v(e,t),t=r}},v=(e,t)=>{if(t){let r=t.value;e[u]&&e[u](r.key,r.value),e[n]-=r.length,e[h].delete(r.key),e[d].removeNode(t)}};class b{constructor(e,t,r,a,i){this.key=e,this.value=t,this.length=r,this.now=a,this.maxAge=i||0}}let _=(e,t,r,a)=>{let i=r.value;g(e,i)&&(v(e,r),e[o]||(i=void 0)),i&&t.call(a,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw TypeError("max must be a non-negative number");this[i]=e.max||1/0;let t=e.length||f;if(this[s]="function"!=typeof t?f:t,this[o]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw TypeError("max must be a non-negative number");this[i]=e||1/0,y(this)}get max(){return this[i]}set allowStale(e){this[o]=!!e}get allowStale(){return this[o]}set maxAge(e){if("number"!=typeof e)throw TypeError("maxAge must be a non-negative number");this[l]=e,y(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=f),e!==this[s]&&(this[s]=e,this[n]=0,this[d].forEach(e=>{e.length=this[s](e.value,e.key),this[n]+=e.length})),y(this)}get lengthCalculator(){return this[s]}get length(){return this[n]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let r=this[d].tail;null!==r;){let a=r.prev;_(this,e,r,t),r=a}}forEach(e,t){t=t||this;for(let r=this[d].head;null!==r;){let a=r.next;_(this,e,r,t),r=a}}keys(){return this[d].toArray().map(e=>e.key)}values(){return this[d].toArray().map(e=>e.value)}reset(){this[u]&&this[d]&&this[d].length&&this[d].forEach(e=>this[u](e.key,e.value)),this[h]=new Map,this[d]=new a,this[n]=0}dump(){return this[d].map(e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[d]}set(e,t,r){if((r=r||this[l])&&"number"!=typeof r)throw TypeError("maxAge must be a number");let a=r?Date.now():0,o=this[s](t,e);if(this[h].has(e)){if(o>this[i])return v(this,this[h].get(e)),!1;let s=this[h].get(e),l=s.value;return this[u]&&!this[c]&&this[u](e,l.value),l.now=a,l.maxAge=r,l.value=t,this[n]+=o-l.length,l.length=o,this.get(e),y(this),!0}let p=new b(e,t,o,a,r);return p.length>this[i]?(this[u]&&this[u](e,t),!1):(this[n]+=p.length,this[d].unshift(p),this[h].set(e,this[d].head),y(this),!0)}has(e){if(!this[h].has(e))return!1;let t=this[h].get(e).value;return!g(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){let e=this[d].tail;return e?(v(this,e),e.value):null}del(e){v(this,this[h].get(e))}load(e){this.reset();let t=Date.now();for(let r=e.length-1;r>=0;r--){let a=e[r],i=a.e||0;if(0===i)this.set(a.k,a.v);else{let e=i-t;e>0&&this.set(a.k,a.v,e)}}}prune(){this[h].forEach((e,t)=>m(this,t,!1))}}},76:e=>{e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},190:(e,t,r)=>{function a(e){var t=this;if(t instanceof a||(t=new a),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,i=arguments.length;r<i;r++)t.push(arguments[r]);return t}function i(e,t,r,a){if(!(this instanceof i))return new i(e,t,r,a);this.list=a,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=a,a.Node=i,a.create=a,a.prototype.removeNode=function(e){if(e.list!==this)throw Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},a.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},a.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},a.prototype.push=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.tail=new i(e,this.tail,null,this),this.head||(this.head=this.tail),this.length++;return this.length},a.prototype.unshift=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.head=new i(e,null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},a.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},a.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},a.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,a=0;null!==r;a++)e.call(t,r.value,a,this),r=r.next},a.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,a=this.length-1;null!==r;a--)e.call(t,r.value,a,this),r=r.prev},a.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},a.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},a.prototype.map=function(e,t){t=t||this;for(var r=new a,i=this.head;null!==i;)r.push(e.call(t,i.value,this)),i=i.next;return r},a.prototype.mapReverse=function(e,t){t=t||this;for(var r=new a,i=this.tail;null!==i;)r.push(e.call(t,i.value,this)),i=i.prev;return r},a.prototype.reduce=function(e,t){var r,a=this.head;if(arguments.length>1)r=t;else if(this.head)a=this.head.next,r=this.head.value;else throw TypeError("Reduce of empty list with no initial value");for(var i=0;null!==a;i++)r=e(r,a.value,i),a=a.next;return r},a.prototype.reduceReverse=function(e,t){var r,a=this.tail;if(arguments.length>1)r=t;else if(this.tail)a=this.tail.prev,r=this.tail.value;else throw TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;null!==a;i--)r=e(r,a.value,i),a=a.prev;return r},a.prototype.toArray=function(){for(var e=Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},a.prototype.toArrayReverse=function(){for(var e=Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},a.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new a;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,n=this.head;null!==n&&i<e;i++)n=n.next;for(;null!==n&&i<t;i++,n=n.next)r.push(n.value);return r},a.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new a;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,n=this.tail;null!==n&&i>t;i--)n=n.prev;for(;null!==n&&i>e;i--,n=n.prev)r.push(n.value);return r},a.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,a=this.head;null!==a&&r<e;r++)a=a.next;for(var n=[],r=0;a&&r<t;r++)n.push(a.value),a=this.removeNode(a);null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev);for(var r=2;r<arguments.length;r++)a=function(e,t,r){var a=t===e.head?new i(r,null,t,e):new i(r,t,t.next,e);return null===a.next&&(e.tail=a),null===a.prev&&(e.head=a),e.length++,a}(this,a,arguments[r]);return n},a.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var a=r.prev;r.prev=r.next,r.next=a}return this.head=t,this.tail=e,this};try{r(76)(a)}catch(e){}}},r={};function a(e){var i=r[e];if(void 0!==i)return i.exports;var n=r[e]={exports:{}},s=!0;try{t[e](n,n.exports,a),s=!1}finally{s&&delete r[e]}return n.exports}a.ab="//";var i=a(806);e.exports=i})()},9368:e=>{"use strict";!function(){var t={114:function(e){function t(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,a="",i=0,n=-1,s=0,o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(47===r)break;else r=47;if(47===r){if(n===o-1||1===s);else if(n!==o-1&&2===s){if(a.length<2||2!==i||46!==a.charCodeAt(a.length-1)||46!==a.charCodeAt(a.length-2)){if(a.length>2){var l=a.lastIndexOf("/");if(l!==a.length-1){-1===l?(a="",i=0):i=(a=a.slice(0,l)).length-1-a.lastIndexOf("/"),n=o,s=0;continue}}else if(2===a.length||1===a.length){a="",i=0,n=o,s=0;continue}}t&&(a.length>0?a+="/..":a="..",i=2)}else a.length>0?a+="/"+e.slice(n+1,o):a=e.slice(n+1,o),i=o-n-1;n=o,s=0}else 46===r&&-1!==s?++s:s=-1}return a}var a={resolve:function(){for(var e,a,i="",n=!1,s=arguments.length-1;s>=-1&&!n;s--)s>=0?a=arguments[s]:(void 0===e&&(e=""),a=e),t(a),0!==a.length&&(i=a+"/"+i,n=47===a.charCodeAt(0));return(i=r(i,!n),n)?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var a=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=r(e,!a)).length||a||(e="."),e.length>0&&i&&(e+="/"),a)?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":a.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r||(e=a.resolve(e))===(r=a.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var n=e.length,s=n-i,o=1;o<r.length&&47===r.charCodeAt(o);++o);for(var l=r.length-o,u=s<l?s:l,c=-1,d=0;d<=u;++d){if(d===u){if(l>u){if(47===r.charCodeAt(o+d))return r.slice(o+d+1);if(0===d)return r.slice(o+d)}else s>u&&(47===e.charCodeAt(i+d)?c=d:0===d&&(c=0));break}var h=e.charCodeAt(i+d);if(h!==r.charCodeAt(o+d))break;47===h&&(c=d)}var p="";for(d=i+c+1;d<=n;++d)(d===n||47===e.charCodeAt(d))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+r.slice(o+c):(o+=c,47===r.charCodeAt(o)&&++o,r.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),a=47===r,i=-1,n=!0,s=e.length-1;s>=1;--s)if(47===(r=e.charCodeAt(s))){if(!n){i=s;break}}else n=!1;return -1===i?a?"/":".":a&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw TypeError('"ext" argument must be a string');t(e);var a,i=0,n=-1,s=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var o=r.length-1,l=-1;for(a=e.length-1;a>=0;--a){var u=e.charCodeAt(a);if(47===u){if(!s){i=a+1;break}}else -1===l&&(s=!1,l=a+1),o>=0&&(u===r.charCodeAt(o)?-1==--o&&(n=a):(o=-1,n=l))}return i===n?n=l:-1===n&&(n=e.length),e.slice(i,n)}for(a=e.length-1;a>=0;--a)if(47===e.charCodeAt(a)){if(!s){i=a+1;break}}else -1===n&&(s=!1,n=a+1);return -1===n?"":e.slice(i,n)},extname:function(e){t(e);for(var r=-1,a=0,i=-1,n=!0,s=0,o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(47===l){if(!n){a=o+1;break}continue}-1===i&&(n=!1,i=o+1),46===l?-1===r?r=o:1!==s&&(s=1):-1!==r&&(s=-1)}return -1===r||-1===i||0===s||1===s&&r===i-1&&r===a+1?"":e.slice(r,i)},format:function(e){var t,r;if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||""),t?t===e.root?t+r:t+"/"+r:r},parse:function(e){t(e);var r,a={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return a;var i=e.charCodeAt(0),n=47===i;n?(a.root="/",r=1):r=0;for(var s=-1,o=0,l=-1,u=!0,c=e.length-1,d=0;c>=r;--c){if(47===(i=e.charCodeAt(c))){if(!u){o=c+1;break}continue}-1===l&&(u=!1,l=c+1),46===i?-1===s?s=c:1!==d&&(d=1):-1!==s&&(d=-1)}return -1===s||-1===l||0===d||1===d&&s===l-1&&s===o+1?-1!==l&&(0===o&&n?a.base=a.name=e.slice(1,l):a.base=a.name=e.slice(o,l)):(0===o&&n?(a.name=e.slice(1,s),a.base=e.slice(1,l)):(a.name=e.slice(o,s),a.base=e.slice(o,l)),a.ext=e.slice(s,l)),o>0?a.dir=e.slice(0,o-1):n&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};a.posix=a,e.exports=a}},r={};function a(e){var i=r[e];if(void 0!==i)return i.exports;var n=r[e]={exports:{}},s=!0;try{t[e](n,n.exports,a),s=!1}finally{s&&delete r[e]}return n.exports}a.ab="//";var i=a(114);e.exports=i}()},1691:(e,t,r)=>{"use strict";r.d(t,{H4:()=>l,i4:()=>a,ph:()=>i,pz:()=>n,vu:()=>o,yR:()=>s});let a="RSC",i="Next-Router-State-Tree",n="Next-Router-Prefetch",s="x-vercel-sc-headers",o=[[a],[i],[n]],l="_rsc"},4926:(e,t,r)=>{"use strict";r.r(t),r.d(t,{cookies:()=>d,draftMode:()=>h,headers:()=>c});var a=r(9375),i=r(9183),n=r(3627),s=r(533),o=r(5430),l=r(3766);class u{get isEnabled(){return this._provider.isEnabled}enable(){if(!(0,l.staticGenerationBailout)("draftMode().enable()"))return this._provider.enable()}disable(){if(!(0,l.staticGenerationBailout)("draftMode().disable()"))return this._provider.disable()}constructor(e){this._provider=e}}function c(){if((0,l.staticGenerationBailout)("headers"))return i.h.seal(new Headers({}));let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: Method expects to have requestAsyncStorage, none available");return e.headers}function d(){if((0,l.staticGenerationBailout)("cookies"))return a.Qb.seal(new n.q(new Headers({})));let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: Method expects to have requestAsyncStorage, none available");let t=o.actionAsyncStorage.getStore();return t&&(t.isAction||t.isAppRoute)?e.mutableCookies:e.cookies}function h(){let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: Method expects to have requestAsyncStorage, none available");return new u(e.draftMode)}},4721:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DYNAMIC_ERROR_CODE:()=>a,DynamicServerError:()=>i});let a="DYNAMIC_SERVER_USAGE";class i extends Error{constructor(e){super("Dynamic server usage: "+e),this.digest=a}}},3766:(e,t,r)=>{"use strict";r.r(t),r.d(t,{staticGenerationBailout:()=>s});var a=r(4721),i=r(5948);class n extends Error{constructor(...e){super(...e),this.code="NEXT_STATIC_GEN_BAILOUT"}}let s=(e,t)=>{let r=i.staticGenerationAsyncStorage.getStore();if(null==r?void 0:r.forceStatic)return!0;if(null==r?void 0:r.dynamicShouldError){let{dynamic:r="error",link:a}=t||{};throw new n('Page with `dynamic = "'+r+"\"` couldn't be rendered statically because it used `"+e+"`."+(a?" See more info here: "+a:""))}if(r&&(r.revalidate=0),null==r?void 0:r.isStaticGeneration){let t=new a.DynamicServerError(e);throw r.dynamicUsageDescription=e,r.dynamicUsageStack=t.stack,t}return!1}},821:(e,t,r)=>{"use strict";r.d(t,{BR:()=>s,Qq:()=>n,dN:()=>a,y3:()=>i});let a="nxtP",i="x-prerender-revalidate",n="x-prerender-revalidate-if-generated",s=31536e3,o={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"actionBrowser",api:"api",middleware:"middleware",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",appMetadataRoute:"app-metadata-route"};({...o,GROUP:{server:[o.reactServerComponents,o.actionBrowser,o.appMetadataRoute]}})},5803:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let a=new Proxy(e=>e,{get:(e,t)=>["hex","rgb","ansi256","bgHex","bgRgb","bgAnsi256"].includes(t)?()=>a:a}),i=a},4487:(e,t,r)=>{"use strict";let a,i;r.d(t,{Z:()=>en});class n{constructor({userland:e,definition:t}){this.userland=e,this.definition=t}}var s,o,l,u,c,d,h,p,f,m,g,y,v,b=r(1691),_=r(9183),w=r(9375),x=r(3627),P=r(821);let O="__prerender_bypass";Symbol("__next_preview_data"),Symbol(O);class T{constructor(e,t,r,a){var i;let n=e&&function(e,t){let r=_.h.from(e.headers),a=r.get(P.y3),i=a===t.previewModeId,n=r.has(P.Qq);return{isOnDemandRevalidate:i,revalidateOnlyGenerated:n}}(t,e).isOnDemandRevalidate,s=null==(i=r.get(O))?void 0:i.value;this.isEnabled=!!(!n&&s&&e&&s===e.previewModeId),this._previewModeId=null==e?void 0:e.previewModeId,this._mutableCookies=a}enable(){if(!this._previewModeId)throw Error("Invariant: previewProps missing previewModeId this should never happen");this._mutableCookies.set({name:O,value:this._previewModeId,httpOnly:!0,sameSite:"none",secure:!0,path:"/"})}disable(){this._mutableCookies.set({name:O,value:"",httpOnly:!0,sameSite:"none",secure:!0,path:"/",expires:new Date(0)})}}let S={wrap(e,{req:t,res:r,renderOpts:a},i){let n;a&&"previewProps"in a&&(n=a.previewProps);let s={},o={get headers(){return s.headers||(s.headers=function(e){let t=_.h.from(e);for(let e of b.vu)t.delete(e.toString().toLowerCase());return _.h.seal(t)}(t.headers)),s.headers},get cookies(){return s.cookies||(s.cookies=function(e){let t=new x.q(_.h.from(e));return w.Qb.seal(t)}(t.headers)),s.cookies},get mutableCookies(){return s.mutableCookies||(s.mutableCookies=function(e,t){let r=new x.q(_.h.from(e));return w.vr.wrap(r,t)}(t.headers,r)),s.mutableCookies},get draftMode(){return s.draftMode||(s.draftMode=new T(n,t,this.cookies,this.mutableCookies)),s.draftMode}};return e.run(o,i,o)}},E={wrap(e,{pathname:t,renderOpts:r},a){let i=!r.supportsDynamicHTML&&!r.isDraftMode,n={isStaticGeneration:i,pathname:t,originalPathname:r.originalPathname,incrementalCache:r.incrementalCache||globalThis.__incrementalCache,isRevalidate:r.isRevalidate,isPrerendering:r.nextExport,fetchCache:r.fetchCache,isOnDemandRevalidate:r.isOnDemandRevalidate,isDraftMode:r.isDraftMode};return r.store=n,e.run(n,a,n)}};function k(){return new Response(null,{status:400})}function A(){return new Response(null,{status:405})}let I=["GET","HEAD","OPTIONS","POST","PUT","DELETE","PATCH"];!function(e){e.handleRequest="BaseServer.handleRequest",e.run="BaseServer.run",e.pipe="BaseServer.pipe",e.getStaticHTML="BaseServer.getStaticHTML",e.render="BaseServer.render",e.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",e.renderToResponse="BaseServer.renderToResponse",e.renderToHTML="BaseServer.renderToHTML",e.renderError="BaseServer.renderError",e.renderErrorToResponse="BaseServer.renderErrorToResponse",e.renderErrorToHTML="BaseServer.renderErrorToHTML",e.render404="BaseServer.render404"}(s||(s={})),function(e){e.loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",e.loadComponents="LoadComponents.loadComponents"}(o||(o={})),function(e){e.getRequestHandler="NextServer.getRequestHandler",e.getServer="NextServer.getServer",e.getServerRequestHandler="NextServer.getServerRequestHandler",e.createServer="createServer.createServer"}(l||(l={})),function(e){e.compression="NextNodeServer.compression",e.getBuildId="NextNodeServer.getBuildId",e.generateStaticRoutes="NextNodeServer.generateStaticRoutes",e.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",e.generatePublicRoutes="NextNodeServer.generatePublicRoutes",e.generateImageRoutes="NextNodeServer.generateImageRoutes.route",e.sendRenderResult="NextNodeServer.sendRenderResult",e.sendStatic="NextNodeServer.sendStatic",e.proxyRequest="NextNodeServer.proxyRequest",e.runApi="NextNodeServer.runApi",e.render="NextNodeServer.render",e.renderHTML="NextNodeServer.renderHTML",e.imageOptimizer="NextNodeServer.imageOptimizer",e.getPagePath="NextNodeServer.getPagePath",e.getRoutesManifest="NextNodeServer.getRoutesManifest",e.findPageComponents="NextNodeServer.findPageComponents",e.getFontManifest="NextNodeServer.getFontManifest",e.getServerComponentManifest="NextNodeServer.getServerComponentManifest",e.getRequestHandler="NextNodeServer.getRequestHandler",e.renderToHTML="NextNodeServer.renderToHTML",e.renderError="NextNodeServer.renderError",e.renderErrorToHTML="NextNodeServer.renderErrorToHTML",e.render404="NextNodeServer.render404",e.route="route",e.onProxyReq="onProxyReq",e.apiResolver="apiResolver"}(u||(u={})),(c||(c={})).startServer="startServer.startServer",function(e){e.getServerSideProps="Render.getServerSideProps",e.getStaticProps="Render.getStaticProps",e.renderToString="Render.renderToString",e.renderDocument="Render.renderDocument",e.createBodyResult="Render.createBodyResult"}(d||(d={})),function(e){e.renderToString="AppRender.renderToString",e.renderToReadableStream="AppRender.renderToReadableStream",e.getBodyResult="AppRender.getBodyResult",e.fetch="AppRender.fetch"}(h||(h={})),(p||(p={})).executeRoute="Router.executeRoute",(f||(f={})).runHandler="Node.runHandler",(m||(m={})).runHandler="AppRouteRouteHandlers.runHandler",(g||(g={})).generateMetadata="ResolveMetadata.generateMetadata";let C=["BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata"];a=r(5049);let{context:j,trace:N,SpanStatusCode:R,SpanKind:L}=a,M=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then,D=(e,t)=>{t&&e.recordException(t),e.setStatus({code:R.ERROR,message:null==t?void 0:t.message}),e.end()},$=new Map,Z=a.createContextKey("next.rootSpanId"),U=0,B=()=>U++;class V{getTracerInstance(){return N.getTracer("next.js","0.0.1")}getContext(){return j}getActiveScopeSpan(){return N.getSpan(null==j?void 0:j.active())}trace(...e){let[t,r,i]=e,{fn:n,options:s}="function"==typeof r?{fn:r,options:{}}:{fn:i,options:{...r}};if(!C.includes(t)&&"1"!==process.env.NEXT_OTEL_VERBOSE||s.hideSpan)return n();let o=s.spanName??t,l=this.getSpanContext((null==s?void 0:s.parentSpan)??this.getActiveScopeSpan()),u=!1;l||(l=a.ROOT_CONTEXT,u=!0);let c=B();return s.attributes={"next.span_name":o,"next.span_type":t,...s.attributes},a.context.with(l.setValue(Z,c),()=>this.getTracerInstance().startActiveSpan(o,s,e=>{let t=()=>{$.delete(c)};u&&$.set(c,new Map(Object.entries(s.attributes??{})));try{if(n.length>1)return n(e,t=>D(e,t));let r=n(e);return M(r)?r.then(()=>e.end(),t=>D(e,t)).finally(t):(e.end(),t()),r}catch(r){throw D(e,r),t(),r}}))}wrap(...e){let t=this,[r,a,i]=3===e.length?e:[e[0],{},e[1]];return C.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=a;"function"==typeof e&&"function"==typeof i&&(e=e.apply(this,arguments));let n=arguments.length-1,s=arguments[n];if("function"!=typeof s)return t.trace(r,e,()=>i.apply(this,arguments));{let a=t.getContext().bind(j.active(),s);return t.trace(r,e,(e,t)=>(arguments[n]=function(e){return null==t||t(e),a.apply(this,arguments)},i.apply(this,arguments)))}}:i}startSpan(...e){let[t,r]=e,a=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,a)}getSpanContext(e){let t=e?N.setSpan(j.active(),e):void 0;return t}getRootSpanAttributes(){let e=j.active().getValue(Z);return $.get(e)}}let K=(()=>{let e=new V;return()=>e})();var z=r(6195).Buffer;function F(e){let t=[],r=null==e?void 0:e.originalPathname;return r&&(Array.isArray(e.tags)||(e.tags=[]),e.tags.includes(r)||e.tags.push(r),t.push(r)),t}function q(e,t){if(!e)return;e.fetchMetrics||(e.fetchMetrics=[]);let r=["url","status","method"];e.fetchMetrics.some(e=>r.every(r=>e[r]===t[r]))||e.fetchMetrics.push({url:t.url,cacheStatus:t.cacheStatus,status:t.status,method:t.method,start:t.start,end:Date.now(),idx:e.nextFetchId||0})}var H=r(3928),G=r(580);function J(e){let t=new URL(e);return t.host="localhost:3000",t.search="",t.protocol="http",t.toString()}function W(e){if("string"!=typeof(null==e?void 0:e.digest))return!1;let[t,r,a]=e.digest.split(";",3);return"NEXT_REDIRECT"===t&&("replace"===r||"push"===r)&&"string"==typeof a}r(533),!function(e){e.push="push",e.replace="replace"}(y||(y={})),(i=r(5803).Z).cyan("wait"),i.red("error"),i.yellow("warn"),i.green("ready"),i.cyan("info"),i.magenta("event"),i.magenta("trace");let Y=["HEAD","OPTIONS"],Q=["OPTIONS","POST","PUT","DELETE","PATCH"];!function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(v||(v={}));let{requestAsyncStorage:X}=r(533),{staticGenerationAsyncStorage:ee}=r(5948),et=r(4721),er=r(4926),{staticGenerationBailout:ea}=r(3766),{actionAsyncStorage:ei}=r(5430),en=class extends n{static is(e){return e.definition.kind===v.APP_ROUTE}constructor({userland:e,definition:t,resolvedPagePath:r,nextConfigOutput:a}){if(super({userland:e,definition:t}),this.requestAsyncStorage=X,this.staticGenerationAsyncStorage=ee,this.serverHooks=et,this.headerHooks=er,this.staticGenerationBailout=ea,this.actionAsyncStorage=ei,this.resolvedPagePath=r,this.nextConfigOutput=a,this.methods=function(e){let t=I.reduce((t,r)=>({...t,[r]:e[r]??A}),{}),r=new Set(I.filter(t=>e[t])),a=Y.filter(e=>!r.has(e));for(let i of a){if("HEAD"===i){if(!e.GET)break;t.HEAD=e.GET,r.add("HEAD");continue}if("OPTIONS"===i){let e=["OPTIONS",...r];!r.has("HEAD")&&r.has("GET")&&e.push("HEAD");let a={Allow:e.sort().join(", ")};t.OPTIONS=()=>new Response(null,{status:204,headers:a}),r.add("OPTIONS");continue}throw Error(`Invariant: should handle all automatic implementable methods, got method: ${i}`)}return t}(e),this.nonStaticMethods=function(e){let t=Q.filter(t=>e[t]);return 0!==t.length&&t}(e),this.dynamic=this.userland.dynamic,"export"===this.nextConfigOutput){if(this.dynamic&&"auto"!==this.dynamic){if("force-dynamic"===this.dynamic)throw Error(`export const dynamic = "force-dynamic" on page "${t.pathname}" cannot be used with "output: export". See more info here: https://nextjs.org/docs/advanced-features/static-html-export`)}else this.dynamic="error"}}resolve(e){return I.includes(e)?this.methods[e]:k}async execute(e,t){let a=this.resolve(e.method),i={req:e};i.renderOpts={previewProps:t.prerenderManifest.preview};let n={pathname:this.definition.pathname,renderOpts:t.staticGenerationContext??{supportsDynamicHTML:!1}};n.renderOpts.fetchCache=this.userland.fetchCache;let s=await this.actionAsyncStorage.run({isAppRoute:!0},()=>S.wrap(this.requestAsyncStorage,i,()=>E.wrap(this.staticGenerationAsyncStorage,n,i=>{var n;switch(this.nonStaticMethods&&this.staticGenerationBailout(`non-static methods used ${this.nonStaticMethods.join(", ")}`),this.dynamic){case"force-dynamic":i.forceDynamic=!0,this.staticGenerationBailout("force-dynamic",{dynamic:this.dynamic});break;case"force-static":i.forceStatic=!0;break;case"error":i.dynamicShouldError=!0}i.revalidate??=this.userland.revalidate??!1;let s=function(e,{dynamic:t},r){function a(e){switch(e){case"search":case"searchParams":case"toString":case"href":case"origin":r.staticGenerationBailout(`nextUrl.${e}`);return;default:return}}let i={},n=(e,t)=>{switch(t){case"search":return"";case"searchParams":return i.searchParams||(i.searchParams=new URLSearchParams),i.searchParams;case"url":case"href":return i.url||(i.url=J(e)),i.url;case"toJSON":case"toString":return i.url||(i.url=J(e)),i.toString||(i.toString=()=>i.url),i.toString;case"headers":return i.headers||(i.headers=new Headers),i.headers;case"cookies":return i.headers||(i.headers=new Headers),i.cookies||(i.cookies=new H.RequestCookies(i.headers)),i.cookies;case"clone":return i.url||(i.url=J(e)),()=>new G.c(i.url)}},s=new Proxy(e.nextUrl,{get(e,r){if(a(r),"force-static"===t&&"string"==typeof r){let t=n(e.href,r);if(void 0!==t)return t}let i=e[r];return"function"==typeof i?i.bind(e):i},set:(e,t,r)=>(a(t),e[t]=r,!0)}),o=e=>{switch(e){case"headers":r.headerHooks.headers();return;case"url":case"body":case"blob":case"json":case"text":case"arrayBuffer":case"formData":r.staticGenerationBailout(`request.${e}`);return;default:return}};return new Proxy(e,{get(e,r){if(o(r),"nextUrl"===r)return s;if("force-static"===t&&"string"==typeof r){let t=n(e.url,r);if(void 0!==t)return t}let a=e[r];return"function"==typeof a?a.bind(e):a},set:(e,t,r)=>(o(t),e[t]=r,!0)})}(e,{dynamic:this.dynamic},{headerHooks:this.headerHooks,serverHooks:this.serverHooks,staticGenerationBailout:this.staticGenerationBailout}),o=function(e){let t="/app/";e.includes(t)||(t="\\app\\");let[,...r]=e.split(t),a=t[0]+r.join(t),i=a.split(".").slice(0,-1).join(".");return i}(this.resolvedPagePath);return null==(n=K().getRootSpanAttributes())||n.set("next.route",o),K().trace(m.runHandler,{spanName:`executing api route (app) ${o}`,attributes:{"next.route":o}},async()=>{var e;!function({serverHooks:e,staticGenerationAsyncStorage:t}){if(globalThis._nextOriginalFetch||(globalThis._nextOriginalFetch=globalThis.fetch),globalThis.fetch.__nextPatched)return;let{DynamicServerError:a}=e,i=globalThis._nextOriginalFetch;globalThis.fetch=async(e,n)=>{var s;let o;try{(o=new URL(e instanceof Request?e.url:e)).username="",o.password=""}catch{o=void 0}let l=(null==o?void 0:o.href)??"",u=Date.now(),c=(null==n?void 0:null==(s=n.method)?void 0:s.toUpperCase())||"GET";return await K().trace(h.fetch,{kind:L.CLIENT,spanName:["fetch",c,l].filter(Boolean).join(" "),attributes:{"http.url":l,"http.method":c,"net.peer.name":null==o?void 0:o.hostname,"net.peer.port":(null==o?void 0:o.port)||void 0}},async()=>{var s,o,c;let d,h;let p=t.getStore(),f=e&&"object"==typeof e&&"string"==typeof e.method,m=t=>(f?e[t]:null)||(null==n?void 0:n[t]);if(!p||(null==(s=null==n?void 0:n.next)?void 0:s.internal)||p.isDraftMode)return i(e,n);let g=t=>{var r,a,i;return void 0!==(null==n?void 0:null==(r=n.next)?void 0:r[t])?null==n?void 0:null==(a=n.next)?void 0:a[t]:f?null==(i=e.next)?void 0:i[t]:void 0},y=g("revalidate"),v=g("tags")||[];if(Array.isArray(v))for(let e of(p.tags||(p.tags=[]),v))p.tags.includes(e)||p.tags.push(e);let b=F(p);for(let e of b||[])v.includes(e)||v.push(e);let _="only-cache"===p.fetchCache,w="force-cache"===p.fetchCache,x="default-cache"===p.fetchCache,O="default-no-store"===p.fetchCache,T="only-no-store"===p.fetchCache,S="force-no-store"===p.fetchCache,E=m("cache");"string"==typeof E&&void 0!==y&&(console.warn(`Warning: fetch for ${l} on ${p.pathname} specified "cache: ${E}" and "revalidate: ${y}", only one should be specified.`),E=void 0),"force-cache"===E&&(y=!1),["no-cache","no-store"].includes(E||"")&&(y=0),("number"==typeof y||!1===y)&&(h=y);let k="",A=m("headers"),I="function"==typeof(null==A?void 0:A.get)?A:new Headers(A||{}),C=I.get("authorization")||I.get("cookie"),j=!["get","head"].includes((null==(o=m("method"))?void 0:o.toLowerCase())||"get"),N=(C||j)&&0===p.revalidate;if(S&&(h=0,k="fetchCache = force-no-store"),T){if("force-cache"===E||0===h)throw Error(`cache: 'force-cache' used on fetch for ${l} with 'export const fetchCache = 'only-no-store'`);h=0,k="fetchCache = only-no-store"}if(_&&"no-store"===E)throw Error(`cache: 'no-store' used on fetch for ${l} with 'export const fetchCache = 'only-cache'`);w&&(void 0===y||0===y)&&(k="fetchCache = force-cache",h=!1),void 0===h?x?(h=!1,k="fetchCache = default-cache"):N?(h=0,k="auto no cache"):O?(h=0,k="fetchCache = default-no-store"):(k="auto cache",h="boolean"!=typeof p.revalidate&&void 0!==p.revalidate&&p.revalidate):k||(k=`revalidate: ${h}`),!N&&(void 0===p.revalidate||"number"==typeof h&&(!1===p.revalidate||"number"==typeof p.revalidate&&h<p.revalidate))&&(p.revalidate=h);let R="number"==typeof h&&h>0||!1===h;if(p.incrementalCache&&R)try{d=await p.incrementalCache.fetchCacheKey(l,f?e:n)}catch(t){console.error("Failed to generate cache key for",e)}let L=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window","duplex"];if(f){let t=e,r={body:t._ogBody||t.body};for(let e of L)r[e]=t[e];e=new Request(t.url,r)}else if(n){let e=n;for(let t of(n={body:n._ogBody||n.body},L))n[t]=e[t]}let M=p.nextFetchId??1;p.nextFetchId=M+1;let D="number"!=typeof h?P.BR:h,$=async t=>{let r={...n,next:{...null==n?void 0:n.next,fetchType:"origin",fetchIdx:M}};return i(e,r).then(async a=>{if(t||q(p,{start:u,url:l,cacheReason:k,cacheStatus:"miss",status:a.status,method:r.method||"GET"}),200===a.status&&p.incrementalCache&&d&&R){let t=z.from(await a.arrayBuffer());try{await p.incrementalCache.set(d,{kind:"FETCH",data:{headers:Object.fromEntries(a.headers.entries()),body:t.toString("base64"),status:a.status,tags:v,url:a.url},revalidate:D},h,!0,l,M)}catch(t){console.warn("Failed to set fetch cache",e,t)}let r=new Response(t,{headers:new Headers(a.headers),status:a.status});return Object.defineProperty(r,"url",{value:a.url}),r}return a})};if(d&&(null==p?void 0:p.incrementalCache)){let e=p.isOnDemandRevalidate?null:await p.incrementalCache.get(d,!0,h,l,M);if((null==e?void 0:e.value)&&"FETCH"===e.value.kind){let t=e.value.data.tags;if(!(p.isRevalidate&&e.isStale)){let a;if(e.isStale)p.pendingRevalidates||(p.pendingRevalidates=[]),p.pendingRevalidates.push($(!0).catch(console.error));else if(v&&!v.every(e=>null==t?void 0:t.includes(e))){for(let t of(e.value.data.tags||(e.value.data.tags=[]),v))e.value.data.tags.includes(t)||e.value.data.tags.push(t);null==(c=p.incrementalCache)||c.set(d,e.value,h,!0,l,M)}let i=e.value.data;{let{decode:e}=r(8135);a=e(i.body)}q(p,{start:u,url:l,cacheReason:k,cacheStatus:"hit",status:i.status||200,method:(null==n?void 0:n.method)||"GET"});let s=new Response(a,{headers:i.headers,status:i.status});return Object.defineProperty(s,"url",{value:e.value.data.url}),s}}}if(p.isStaticGeneration&&n&&"object"==typeof n){let t=n.cache;if(delete n.cache,"no-store"===t){p.revalidate=0;let t=`no-store fetch ${e}${p.pathname?` ${p.pathname}`:""}`,r=new a(t);p.dynamicUsageErr=r,p.dynamicUsageStack=r.stack,p.dynamicUsageDescription=t}let r="next"in n,i=n.next||{};if("number"==typeof i.revalidate&&(void 0===p.revalidate||"number"==typeof p.revalidate&&i.revalidate<p.revalidate)){let t=p.forceDynamic;if(t&&0===i.revalidate||(p.revalidate=i.revalidate),!t&&0===i.revalidate){let t=`revalidate: ${i.revalidate} fetch ${e}${p.pathname?` ${p.pathname}`:""}`,r=new a(t);p.dynamicUsageErr=r,p.dynamicUsageStack=r.stack,p.dynamicUsageDescription=t}}r&&delete n.next}return $()})},globalThis.fetch.__nextGetStaticStore=()=>t,globalThis.fetch.__nextPatched=!0}({serverHooks:this.serverHooks,staticGenerationAsyncStorage:this.staticGenerationAsyncStorage});let n=await a(s,{params:t.params});t.staticGenerationContext.fetchMetrics=i.fetchMetrics,await Promise.all(i.pendingRevalidates||[]),F(i),t.staticGenerationContext.fetchTags=null==(e=i.tags)?void 0:e.join(",");let o=this.requestAsyncStorage.getStore();if(o&&o.mutableCookies){let e=new Headers(n.headers);if((0,w._5)(e,o.mutableCookies))return new Response(n.body,{status:n.status,statusText:n.statusText,headers:e})}return n})})));if(!(s instanceof Response))return new Response(null,{status:500});if(s.headers.has("x-middleware-rewrite"))throw Error("NextResponse.rewrite() was used in a app route handler, this is not currently supported. Please remove the invocation to continue.");if("1"===s.headers.get("x-middleware-next"))throw Error("NextResponse.next() was used in a app route handler, this is not supported. See here for more info: https://nextjs.org/docs/messages/next-response-next-in-app-route-handler");return s}async handle(e,t){try{let r=await this.execute(e,t);return r}catch(t){let e=function(e){if(W(e)){let t=W(e)?e.digest.split(";",3)[2]:null;if(!t)throw Error("Invariant: Unexpected redirect url format");return function(e,t){let r=new Headers({location:e});return(0,w._5)(r,t),new Response(null,{status:307,headers:r})}(t,e.mutableCookies)}return(null==e?void 0:e.digest)==="NEXT_NOT_FOUND"&&new Response(null,{status:404})}(t);if(!e)throw t;return e}}}},9996:()=>{"getAll"in Headers.prototype||(Headers.prototype.getAll=function(e){if("set-cookie"!==(e=e.toLowerCase()))throw Error("Headers.getAll is only supported for Set-Cookie header");let t=[...this.entries()].filter(([t])=>t===e);return t.map(([,e])=>e)})},8426:(e,t,r)=>{"use strict";let a,i,n;async function s(){if("_ENTRIES"in globalThis&&_ENTRIES.middleware_instrumentation&&_ENTRIES.middleware_instrumentation.register)try{await _ENTRIES.middleware_instrumentation.register()}catch(e){throw e.message=`An error occurred while loading instrumentation hook: ${e.message}`,e}}r.d(t,{a:()=>er});let o=null;function l(){return o||(o=s()),o}function u(e){return`The edge runtime does not support Node.js '${e}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}process!==r.g.process&&(process.env=r.g.process.env,r.g.process=process),Object.defineProperty(globalThis,"__import_unsupported",{value:function(e){let t=new Proxy(function(){},{get(t,r){if("then"===r)return{};throw Error(u(e))},construct(){throw Error(u(e))},apply(r,a,i){if("function"==typeof i[0])return i[0](t);throw Error(u(e))}});return new Proxy({},{get:()=>t})},enumerable:!1,configurable:!1}),l();class c extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class d extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class h extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}var p=r(9351);let f=Symbol("response"),m=Symbol("passThrough"),g=Symbol("waitUntil");class y{constructor(e){this[g]=[],this[m]=!1}respondWith(e){this[f]||(this[f]=Promise.resolve(e))}passThroughOnException(){this[m]=!0}waitUntil(e){this[g].push(e)}}class v extends y{constructor(e){super(e.request),this.sourcePage=e.page}get request(){throw new c({page:this.sourcePage})}respondWith(){throw new c({page:this.sourcePage})}}var b=r(580),_=r(3627);let w=Symbol("internal request");class x extends Request{constructor(e,t={}){let r="string"!=typeof e&&"url"in e?e.url:String(e);(0,p.r4)(r),super(r,t);let a=new b.c(r,{headers:(0,p.lb)(this.headers),nextConfig:t.nextConfig});this[w]={cookies:new _.q(this.headers),geo:t.geo||{},ip:t.ip,nextUrl:a,url:a.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[w].cookies}get geo(){return this[w].geo}get ip(){return this[w].ip}get nextUrl(){return this[w].nextUrl}get page(){throw new d}get ua(){throw new h}get url(){return this[w].url}}var P=r(7845);function O(e,t){let r="string"==typeof t?new URL(t):t,a=new URL(e,t),i=r.protocol+"//"+r.host;return a.protocol+"//"+a.host===i?a.toString().replace(i,""):a.toString()}var T=r(1691);let S=["__nextFallback","__nextLocale","__nextInferredLocaleFromDefault","__nextDefaultLocale","__nextIsNotFound",T.H4],E=["__nextDataReq"];var k=r(821);class A extends x{constructor(e){super(e.input,e.init),this.sourcePage=e.page}get request(){throw new c({page:this.sourcePage})}respondWith(){throw new c({page:this.sourcePage})}waitUntil(){throw new c({page:this.sourcePage})}}let I=[[T.i4],[T.ph],[T.pz],[T.yR]];async function C(e){await l();let t=void 0!==self.__BUILD_MANIFEST;e.request.url=e.request.url.replace(/\.rsc($|\?)/,"$1");let r=new b.c(e.request.url,{headers:e.request.headers,nextConfig:e.request.nextConfig}),a=[...r.searchParams.keys()];for(let e of a){let t=r.searchParams.getAll(e);if(e!==k.dN&&e.startsWith(k.dN)){let a=e.substring(k.dN.length);for(let e of(r.searchParams.delete(a),t))r.searchParams.append(a,e);r.searchParams.delete(e)}}let i=r.buildId;r.buildId="";let n=e.request.headers["x-nextjs-data"];n&&"/index"===r.pathname&&(r.pathname="/");let s=(0,p.EK)(e.request.headers),o=new Map;if(!t)for(let e of I){let t=e.toString().toLowerCase(),r=s.get(t);r&&(o.set(t,s.get(t)),s.delete(t))}let u=new A({page:e.page,input:(function(e,t){let r="string"==typeof e,a=r?new URL(e):e;for(let e of S)a.searchParams.delete(e);if(t)for(let e of E)a.searchParams.delete(e);return r?a.toString():a})(r,!0).toString(),init:{body:e.request.body,geo:e.request.geo,headers:s,ip:e.request.ip,method:e.request.method,nextConfig:e.request.nextConfig,signal:e.request.signal}});n&&Object.defineProperty(u,"__isData",{enumerable:!1,value:!0}),!globalThis.__incrementalCache&&e.IncrementalCache&&(globalThis.__incrementalCache=new e.IncrementalCache({appDir:!0,fetchCache:!0,minimalMode:!0,fetchCacheKeyPrefix:void 0,dev:!1,requestHeaders:e.request.headers,requestProtocol:"https",getPrerenderManifest:()=>({version:-1,routes:{},dynamicRoutes:{},notFoundRoutes:[],preview:{previewModeId:"development-id"}})}));let c=new v({request:u,page:e.page}),d=await e.handler(u,c);if(d&&!(d instanceof Response))throw TypeError("Expected an instance of Response to be returned");let h=null==d?void 0:d.headers.get("x-middleware-rewrite");if(d&&h){let t=new b.c(h,{forceLocale:!0,headers:e.request.headers,nextConfig:e.request.nextConfig});t.host===u.nextUrl.host&&(t.buildId=i||t.buildId,d.headers.set("x-middleware-rewrite",String(t)));let a=O(String(t),String(r));n&&d.headers.set("x-nextjs-rewrite",a)}let f=null==d?void 0:d.headers.get("Location");if(d&&f&&!t){let t=new b.c(f,{forceLocale:!1,headers:e.request.headers,nextConfig:e.request.nextConfig});d=new Response(d.body,d),t.host===u.nextUrl.host&&(t.buildId=i||t.buildId,d.headers.set("Location",String(t))),n&&(d.headers.delete("Location"),d.headers.set("x-nextjs-redirect",O(String(t),String(r))))}let m=d||P.x.next(),y=m.headers.get("x-middleware-override-headers"),_=[];if(y){for(let[e,t]of o)m.headers.set(`x-middleware-request-${e}`,t),_.push(e);_.length>0&&m.headers.set("x-middleware-override-headers",y+","+_.join(","))}return{response:m,waitUntil:Promise.all(c[g])}}var j=r(937),N=r.n(j),R=r(5441),L=r.n(R);let M=e=>{let t=["/"];for(let r of e||[])if(r.startsWith("/")){let e=r.split("/");for(let r=1;r<e.length+1;r++){let a=e.slice(0,r).join("/");a&&(t.push(a),t.includes(a)||t.push(a))}}else t.includes(r)||t.push(r);return t};class D{constructor(e){this.fs=e.fs,this.flushToDisk=e.flushToDisk,this.serverDistDir=e.serverDistDir,this.appDir=!!e._appDir,this.revalidatedTags=e.revalidatedTags,e.maxMemoryCacheSize&&!a&&(a=new(N())({max:e.maxMemoryCacheSize,length({value:e}){var t;if(!e)return 25;if("REDIRECT"===e.kind)return JSON.stringify(e.props).length;if("IMAGE"===e.kind)throw Error("invariant image should not be incremental-cache");return"FETCH"===e.kind?JSON.stringify(e.data||"").length:"ROUTE"===e.kind?e.body.length:e.html.length+((null==(t=JSON.stringify(e.pageData))?void 0:t.length)||0)}})),this.serverDistDir&&this.fs&&(this.tagsManifestPath=L().join(this.serverDistDir,"..","cache","fetch-cache","tags-manifest.json"),this.loadTagsManifest())}loadTagsManifest(){if(this.tagsManifestPath&&this.fs&&!i)try{i=JSON.parse(this.fs.readFileSync(this.tagsManifestPath).toString("utf8"))}catch(e){i={version:1,items:{}}}}async setTags(e,t){if(this.loadTagsManifest(),i&&this.tagsManifestPath){for(let r of t){let t=i.items[r]||{keys:[]};t.keys.includes(e)||t.keys.push(e),i.items[r]=t}try{await this.fs.mkdir(L().dirname(this.tagsManifestPath)),await this.fs.writeFile(this.tagsManifestPath,JSON.stringify(i||{}))}catch(e){console.warn("Failed to update tags manifest.",e)}}}async revalidateTag(e){if(this.loadTagsManifest(),!i||!this.tagsManifestPath)return;let t=i.items[e]||{keys:[]};t.revalidatedAt=Date.now(),i.items[e]=t;try{await this.fs.mkdir(L().dirname(this.tagsManifestPath)),await this.fs.writeFile(this.tagsManifestPath,JSON.stringify(i||{}))}catch(e){console.warn("Failed to update tags manifest.",e)}}async get(e,t){var r,n,s,o;let l;let u=null==a?void 0:a.get(e);if((null==u?void 0:null==(r=u.value)?void 0:r.kind)==="PAGE"){let e=null==(o=u.value.headers)?void 0:o["x-next-cache-tags"];"string"==typeof e&&(l=e.split(","))}if((null==u?void 0:null==(n=u.value)?void 0:n.kind)==="PAGE"&&(null==l?void 0:l.length)){this.loadTagsManifest();let e=M(l||[]),t=e.some(e=>{var t;return(null==(t=null==i?void 0:i.items[e])?void 0:t.revalidatedAt)&&(null==i?void 0:i.items[e].revalidatedAt)>=((null==u?void 0:u.lastModified)||Date.now())});t&&(u.lastModified=-1)}if(u&&(null==u?void 0:null==(s=u.value)?void 0:s.kind)==="FETCH"){this.loadTagsManifest();let e=u.value.data,t=M(e.tags||[]),r=t.some(e=>{var t;return!!this.revalidatedTags.includes(e)||(null==(t=null==i?void 0:i.items[e])?void 0:t.revalidatedAt)&&(null==i?void 0:i.items[e].revalidatedAt)>=((null==u?void 0:u.lastModified)||Date.now())});r&&(u=void 0)}return u||null}async set(e,t){if(null==a||a.set(e,{value:t,lastModified:Date.now()}),this.flushToDisk){if((null==t?void 0:t.kind)==="ROUTE"){let{filePath:r}=await this.getFsPath({pathname:`${e}.body`,appDir:!0});await this.fs.mkdir(L().dirname(r)),await this.fs.writeFile(r,t.body),await this.fs.writeFile(r.replace(/\.body$/,".meta"),JSON.stringify({headers:t.headers,status:t.status}));return}if((null==t?void 0:t.kind)==="PAGE"){let r="string"==typeof t.pageData,{filePath:a}=await this.getFsPath({pathname:`${e}.html`,appDir:r});await this.fs.mkdir(L().dirname(a)),await this.fs.writeFile(a,t.html),await this.fs.writeFile((await this.getFsPath({pathname:`${e}.${r?"rsc":"json"}`,appDir:r})).filePath,r?t.pageData:JSON.stringify(t.pageData)),(t.headers||t.status)&&await this.fs.writeFile(a.replace(/\.html$/,".meta"),JSON.stringify({headers:t.headers,status:t.status}))}else if((null==t?void 0:t.kind)==="FETCH"){let{filePath:r}=await this.getFsPath({pathname:e,fetchCache:!0});await this.fs.mkdir(L().dirname(r)),await this.fs.writeFile(r,JSON.stringify(t)),await this.setTags(e,t.data.tags||[])}}}async getFsPath({pathname:e,appDir:t,fetchCache:r}){if(r)return{filePath:L().join(this.serverDistDir,"..","cache","fetch-cache",e),isAppPath:!1};let a=L().join(this.serverDistDir,"pages",e);if(!this.appDir||!1===t)return{filePath:a,isAppPath:!1};try{return await this.fs.readFile(a),{filePath:a,isAppPath:!1}}catch(t){return{filePath:L().join(this.serverDistDir,"app",e),isAppPath:!0}}}}let $=/\/\[[^/]+?\](?=\/|$)/,Z="undefined"!=typeof performance;Z&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class U extends Error{}function B(e){var t;let r=(t=/^\/index(\/|$)/.test(e)&&!$.test(e)?"/index"+e:"/"===e?"/index":e).startsWith("/")?t:"/"+t;return r}let V=0;class K{static isAvailable(e){return!!(e._requestHeaders["x-vercel-sc-host"]||process.env.SUSPENSE_CACHE_URL)}constructor(e){if(this.debug=!!process.env.NEXT_PRIVATE_DEBUG_CACHE,this.headers={},this.revalidatedTags=e.revalidatedTags,this.headers["Content-Type"]="application/json",T.yR in e._requestHeaders){let t=JSON.parse(e._requestHeaders[T.yR]);for(let e in t)this.headers[e]=t[e];delete e._requestHeaders[T.yR]}let t=e._requestHeaders["x-vercel-sc-host"]||process.env.SUSPENSE_CACHE_URL,r=e._requestHeaders["x-vercel-sc-basepath"]||process.env.SUSPENSE_CACHE_BASEPATH;process.env.SUSPENSE_CACHE_AUTH_TOKEN&&(this.headers.Authorization=`Bearer ${process.env.SUSPENSE_CACHE_AUTH_TOKEN}`),t?(this.cacheEndpoint=`https://${t}${r||""}`,this.debug&&console.log("using cache endpoint",this.cacheEndpoint)):this.debug&&console.log("no cache endpoint available"),e.maxMemoryCacheSize?n||(this.debug&&console.log("using memory store for fetch cache"),n=new(N())({max:e.maxMemoryCacheSize,length({value:e}){var t;if(!e)return 25;if("REDIRECT"===e.kind)return JSON.stringify(e.props).length;if("IMAGE"===e.kind)throw Error("invariant image should not be incremental-cache");return"FETCH"===e.kind?JSON.stringify(e.data||"").length:"ROUTE"===e.kind?e.body.length:e.html.length+((null==(t=JSON.stringify(e.pageData))?void 0:t.length)||0)}})):this.debug&&console.log("not using memory store for fetch cache")}async revalidateTag(e){if(this.debug&&console.log("revalidateTag",e),Date.now()<V){this.debug&&console.log("rate limited ",V);return}try{let t=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/revalidate?tags=${e}`,{method:"POST",headers:this.headers,next:{internal:!0}});if(429===t.status){let e=t.headers.get("retry-after")||"60000";V=Date.now()+parseInt(e)}if(!t.ok)throw Error(`Request failed with status ${t.status}.`)}catch(t){console.warn(`Failed to revalidate tag ${e}`,t)}}async get(e,t,r,a){var i;if(!t)return null;if(Date.now()<V)return this.debug&&console.log("rate limited"),null;let s=null==n?void 0:n.get(e);if(Date.now()-((null==s?void 0:s.lastModified)||0)>2e3&&(s=void 0),!s&&this.cacheEndpoint)try{let t=Date.now(),i=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/${e}`,{method:"GET",headers:{...this.headers,"X-Vercel-Cache-Item-Name":r},next:{internal:!0,fetchType:"cache-get",fetchUrl:r,fetchIdx:a}});if(429===i.status){let e=i.headers.get("retry-after")||"60000";V=Date.now()+parseInt(e)}if(404===i.status)return this.debug&&console.log(`no fetch cache entry for ${e}, duration: ${Date.now()-t}ms`),null;if(!i.ok)throw console.error(await i.text()),Error(`invalid response from cache ${i.status}`);let o=await i.json();if(!o||"FETCH"!==o.kind)throw this.debug&&console.log({cached:o}),Error("invalid cache value");let l=i.headers.get("x-vercel-cache-state"),u=i.headers.get("age");s={value:o,lastModified:"fresh"!==l?Date.now()-k.BR:Date.now()-1e3*parseInt(u||"0",10)},this.debug&&console.log(`got fetch cache entry for ${e}, duration: ${Date.now()-t}ms, size: ${Object.keys(o).length}, cache-state: ${l}`),s&&(null==n||n.set(e,s))}catch(e){this.debug&&console.error("Failed to get from fetch-cache",e)}if((null==s?void 0:null==(i=s.value)?void 0:i.kind)==="FETCH"){let e=s.value.data,t=M(e.tags||[]);t.some(e=>this.revalidatedTags.includes(e))&&(s=void 0)}return s||null}async set(e,t,r,a,i){if(r){if(Date.now()<V){this.debug&&console.log("rate limited");return}if(null==n||n.set(e,{value:t,lastModified:Date.now()}),this.cacheEndpoint)try{let r=Date.now();null!==t&&"revalidate"in t&&(this.headers["x-vercel-revalidate"]=t.revalidate.toString()),!this.headers["x-vercel-revalidate"]&&null!==t&&"data"in t&&(this.headers["x-vercel-cache-control"]=t.data.headers["cache-control"]);let n=JSON.stringify(t),s={...this.headers};null!==t&&"data"in t&&t.data.tags&&(s["x-vercel-cache-tags"]=t.data.tags.join(",")),this.debug&&console.log("set cache",e,{tags:s["x-vercel-cache-tags"]});let o=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/${e}`,{method:"POST",headers:{...s,"X-Vercel-Cache-Item-Name":a||""},body:n,next:{internal:!0,fetchType:"cache-set",fetchUrl:a,fetchIdx:i}});if(429===o.status){let e=o.headers.get("retry-after")||"60000";V=Date.now()+parseInt(e)}if(!o.ok)throw this.debug&&console.log(await o.text()),Error(`invalid response ${o.status}`);this.debug&&console.log(`successfully set to fetch-cache for ${e}, duration: ${Date.now()-r}ms, size: ${n.length}`)}catch(e){this.debug&&console.error("Failed to update fetch cache",e)}}}}var z=r(8135);function F(e){return new TextEncoder().encode(e)}function q(e){return e.replace(/\/$/,"").replace(/\/index$/,"")||"/"}class H{constructor({fs:e,dev:t,appDir:r,flushToDisk:a,fetchCache:i,minimalMode:n,serverDistDir:s,requestHeaders:o,requestProtocol:l,maxMemoryCacheSize:u,getPrerenderManifest:c,fetchCacheKeyPrefix:d,CurCacheHandler:h,allowedRevalidateHeaderKeys:p}){var f,m,g,y;let v=!!process.env.NEXT_PRIVATE_DEBUG_CACHE;h?v&&console.log("using custom cache handler",h.name):(e&&s&&(v&&console.log("using filesystem cache handler"),h=D),K.isAvailable({_requestHeaders:o})&&n&&i&&(v&&console.log("using fetch cache handler"),h=K)),process.env.__NEXT_TEST_MAX_ISR_CACHE&&(u=parseInt(process.env.__NEXT_TEST_MAX_ISR_CACHE,10)),this.dev=t,this.minimalMode=n,this.requestHeaders=o,this.requestProtocol=l,this.allowedRevalidateHeaderKeys=p,this.prerenderManifest=c(),this.fetchCacheKeyPrefix=d;let b=[];o[k.y3]===(null==(f=this.prerenderManifest)?void 0:null==(m=f.preview)?void 0:m.previewModeId)&&(this.isOnDemandRevalidate=!0),n&&"string"==typeof o["x-next-revalidated-tags"]&&o["x-next-revalidate-tag-token"]===(null==(g=this.prerenderManifest)?void 0:null==(y=g.preview)?void 0:y.previewModeId)&&(b=o["x-next-revalidated-tags"].split(",")),h&&(this.cacheHandler=new h({dev:t,fs:e,flushToDisk:a,serverDistDir:s,revalidatedTags:b,maxMemoryCacheSize:u,_appDir:!!r,_requestHeaders:o,fetchCacheKeyPrefix:d}))}calculateRevalidate(e,t,r){if(r)return new Date().getTime()-1e3;let{initialRevalidateSeconds:a}=this.prerenderManifest.routes[q(e)]||{initialRevalidateSeconds:1};return"number"==typeof a?1e3*a+t:a}_getPathname(e,t){return t?e:B(e)}async revalidateTag(e){var t;return null==(t=this.cacheHandler)?void 0:null==t.revalidateTag?void 0:t.revalidateTag(e)}async fetchCacheKey(e,t={}){let r;let a=[];if(t.body){if("function"==typeof t.body.getReader){let e=t.body,r=e.getReader(),i=new Uint8Array;await r.read().then(function e({done:t,value:n}){if(!t){if(n)try{a.push("string"==typeof n?n:(0,z.encode)(n));let e="string"==typeof n?F(n):new Uint8Array(n),t=i;(i=new Uint8Array(t.byteLength+e.byteLength)).set(t),i.set(e,t.byteLength)}catch(e){console.error(e)}r.read().then(e)}}),t._ogBody=i}else if("function"==typeof t.body.keys){let e=t.body;for(let r of(t._ogBody=t.body,new Set([...e.keys()]))){let t=e.getAll(r);a.push(`${r}=${(await Promise.all(t.map(async e=>"string"==typeof e?e:await e.text()))).join(",")}`)}}else if("function"==typeof t.body.arrayBuffer){let e=t.body,r=await e.arrayBuffer();a.push((0,z.encode)(await t.body.arrayBuffer())),t._ogBody=new Blob([r],{type:e.type})}else"string"==typeof t.body&&(a.push(t.body),t._ogBody=t.body)}let i=JSON.stringify(["v3",this.fetchCacheKeyPrefix||"",e,t.method,"function"==typeof(t.headers||{}).keys?Object.fromEntries(t.headers):t.headers,t.mode,t.redirect,t.credentials,t.referrer,t.referrerPolicy,t.integrity,t.cache,a]);{var n;let e=F(i);n=await crypto.subtle.digest("SHA-256",e),r=Array.prototype.map.call(new Uint8Array(n),e=>e.toString(16).padStart(2,"0")).join("")}return r}async get(e,t,r,a,i){var n,s,o;let l,u;if(this.dev&&(!t||"no-cache"===this.requestHeaders["cache-control"]))return null;e=this._getPathname(e,t);let c=null,d=await (null==(n=this.cacheHandler)?void 0:n.get(e,t,a,i));if((null==d?void 0:null==(s=d.value)?void 0:s.kind)==="FETCH"){r=r||d.value.revalidate;let e=Math.round((Date.now()-(d.lastModified||0))/1e3),t=e>r,a=d.value.data;return{isStale:t,value:{kind:"FETCH",data:a,revalidate:r},revalidateAfter:Date.now()+1e3*r}}let h=null==(o=this.prerenderManifest.routes[q(e)])?void 0:o.initialRevalidateSeconds;return(null==d?void 0:d.lastModified)===-1?(l=-1,u=-1*k.BR):l=!!(!1!==(u=this.calculateRevalidate(e,(null==d?void 0:d.lastModified)||Date.now(),this.dev&&!t))&&u<Date.now())||void 0,d&&(c={isStale:l,curRevalidate:h,revalidateAfter:u,value:d.value}),!d&&this.prerenderManifest.notFoundRoutes.includes(e)&&(c={isStale:l,value:null,curRevalidate:h,revalidateAfter:u},this.set(e,c.value,h,t,a,i)),c}async set(e,t,r,a,i,n){if(!this.dev||a){if(a&&JSON.stringify(t).length>2097152){if(this.dev)throw Error("fetch for over 2MB of data can not be cached");return}e=this._getPathname(e,a);try{var s;void 0===r||a||(this.prerenderManifest.routes[e]={dataRoute:L().posix.join("/_next/data",`${B(e)}.json`),srcRoute:null,initialRevalidateSeconds:r}),await (null==(s=this.cacheHandler)?void 0:s.set(e,t,a,i,n))}catch(t){console.warn("Failed to update prerender cache for",e,t)}}}}let G=["(..)(..)","(.)","(..)","(...)"],J=/[|\\{}()[\]^$+*?.-]/,W=/[|\\{}()[\]^$+*?.-]/g;function Y(e){return J.test(e)?e.replace(W,"\\$&"):e}var Q=r(5640);function X(e){let t=e.startsWith("[")&&e.endsWith("]");t&&(e=e.slice(1,-1));let r=e.startsWith("...");return r&&(e=e.slice(3)),{key:e,repeat:r,optional:t}}class ee{constructor(e){var t;this.definition=e,t=e.pathname,$.test(t)&&(this.dynamic=function(e){let{re:t,groups:r}=e;return e=>{let a=t.exec(e);if(!a)return!1;let i=e=>{try{return decodeURIComponent(e)}catch(e){throw new U("failed to decode param")}},n={};return Object.keys(r).forEach(e=>{let t=r[e],s=a[t.pos];void 0!==s&&(n[e]=~s.indexOf("/")?s.split("/").map(e=>i(e)):t.repeat?[i(s)]:i(s))}),n}}(function(e){let{parameterizedRoute:t,groups:r}=function(e){let t=(0,Q.Q)(e).slice(1).split("/"),r={},a=1;return{parameterizedRoute:t.map(e=>{let t=G.find(t=>e.startsWith(t)),i=e.match(/\[((?:\[.*\])|.+)\]/);if(t&&i){let{key:e,optional:n,repeat:s}=X(i[1]);return r[e]={pos:a++,repeat:s,optional:n},"/"+Y(t)+"([^/]+?)"}if(!i)return"/"+Y(e);{let{key:e,repeat:t,optional:n}=X(i[1]);return r[e]={pos:a++,repeat:t,optional:n},t?n?"(?:/(.+?))?":"/(.+?)":"/([^/]+?)"}}).join(""),groups:r}}(e);return{re:RegExp("^"+t+"(?:/)?$"),groups:r}}(e.pathname)))}get identity(){return this.definition.pathname}get isDynamic(){return void 0!==this.dynamic}match(e){let t=this.test(e);return t?{definition:this.definition,params:t.params}:null}test(e){if(this.dynamic){let t=this.dynamic(e);return t?{params:t}:null}return e===this.definition.pathname?{}:null}}var et=r(1635);class er{constructor(e){this.routeModule=e,this.matcher=new ee(e.definition)}static wrap(e,t={}){let r=new er(e);return e=>C({...e,...t,IncrementalCache:H,handler:r.handler.bind(r)})}async handler(e){let t=(0,Q.Q)(new URL(e.url).pathname),{basePath:r}=e.nextUrl;r&&(t=(0,et.n)(t,r));let a=this.matcher.match(t);if(!a)throw Error(`Invariant: no match found for request. Pathname '${t}' should have matched '${this.matcher.definition.pathname}'`);let i={params:a.params,prerenderManifest:{version:4,routes:{},dynamicRoutes:{},preview:{previewModeEncryptionKey:"",previewModeId:"",previewModeSigningKey:""},notFoundRoutes:[]},staticGenerationContext:{supportsDynamicHTML:!0}};return await this.routeModule.handle(e,i)}}},5459:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a.x});var a=r(7845)},580:(e,t,r)=>{"use strict";r.d(t,{c:()=>h});var a=r(5640),i=r(389);function n(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:a,hash:n}=(0,i.c)(e);return""+t+r+a+n}function s(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:a,hash:n}=(0,i.c)(e);return""+r+t+a+n}var o=r(9044),l=r(1635);let u=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|::1|localhost)/;function c(e,t){return new URL(String(e).replace(u,"localhost"),t&&String(t).replace(u,"localhost"))}let d=Symbol("NextURLInternal");class h{constructor(e,t,r){let a,i;"object"==typeof t&&"pathname"in t||"string"==typeof t?(a=t,i=r||{}):i=r||t||{},this[d]={url:c(e,a??i.base),options:i,basePath:""},this.analyze()}analyze(){var e,t,r,a,i;let n=function(e,t){var r,a,i;let{basePath:n,i18n:s,trailingSlash:u}=null!=(r=t.nextConfig)?r:{},c={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):u};if(n&&(0,o.Y)(c.pathname,n)&&(c.pathname=(0,l.n)(c.pathname,n),c.basePath=n),!0===t.parseData&&c.pathname.startsWith("/_next/data/")&&c.pathname.endsWith(".json")){let e=c.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),t=e[0];c.pathname="index"!==e[1]?"/"+e.slice(1).join("/"):"/",c.buildId=t}if(t.i18nProvider){let e=t.i18nProvider.analyze(c.pathname);c.locale=e.detectedLocale,c.pathname=null!=(a=e.pathname)?a:c.pathname}else if(s){let e=function(e,t){let r;let a=e.split("/");return(t||[]).some(t=>!!a[1]&&a[1].toLowerCase()===t.toLowerCase()&&(r=t,a.splice(1,1),e=a.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}(c.pathname,s.locales);c.locale=e.detectedLocale,c.pathname=null!=(i=e.pathname)?i:c.pathname}return c}(this[d].url.pathname,{nextConfig:this[d].options.nextConfig,parseData:!0,i18nProvider:this[d].options.i18nProvider}),s=function(e,t){let r;if((null==t?void 0:t.host)&&!Array.isArray(t.host))r=t.host.toString().split(":")[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}(this[d].url,this[d].options.headers);this[d].domainLocale=this[d].options.i18nProvider?this[d].options.i18nProvider.detectDomainLocale(s):function(e,t,r){if(e)for(let n of(r&&(r=r.toLowerCase()),e)){var a,i;let e=null==(a=n.domain)?void 0:a.split(":")[0].toLowerCase();if(t===e||r===n.defaultLocale.toLowerCase()||(null==(i=n.locales)?void 0:i.some(e=>e.toLowerCase()===r)))return n}}(null==(e=this[d].options.nextConfig)?void 0:null==(t=e.i18n)?void 0:t.domains,s);let u=(null==(r=this[d].domainLocale)?void 0:r.defaultLocale)||(null==(a=this[d].options.nextConfig)?void 0:null==(i=a.i18n)?void 0:i.defaultLocale);this[d].url.pathname=n.pathname,this[d].defaultLocale=u,this[d].basePath=n.basePath??"",this[d].buildId=n.buildId,this[d].locale=n.locale??u,this[d].trailingSlash=n.trailingSlash}formatPathname(){var e;let t;return t=function(e,t,r,a){if(!t||t===r)return e;let i=e.toLowerCase();return!a&&((0,o.Y)(i,"/api")||(0,o.Y)(i,"/"+t.toLowerCase()))?e:n(e,"/"+t)}((e={basePath:this[d].basePath,buildId:this[d].buildId,defaultLocale:this[d].options.forceLocale?void 0:this[d].defaultLocale,locale:this[d].locale,pathname:this[d].url.pathname,trailingSlash:this[d].trailingSlash}).pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix),(e.buildId||!e.trailingSlash)&&(t=(0,a.Q)(t)),e.buildId&&(t=s(n(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=n(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:s(t,"/"):(0,a.Q)(t)}formatSearch(){return this[d].url.search}get buildId(){return this[d].buildId}set buildId(e){this[d].buildId=e}get locale(){return this[d].locale??""}set locale(e){var t,r;if(!this[d].locale||!(null==(t=this[d].options.nextConfig)?void 0:null==(r=t.i18n)?void 0:r.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[d].locale=e}get defaultLocale(){return this[d].defaultLocale}get domainLocale(){return this[d].domainLocale}get searchParams(){return this[d].url.searchParams}get host(){return this[d].url.host}set host(e){this[d].url.host=e}get hostname(){return this[d].url.hostname}set hostname(e){this[d].url.hostname=e}get port(){return this[d].url.port}set port(e){this[d].url.port=e}get protocol(){return this[d].url.protocol}set protocol(e){this[d].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[d].url=c(e),this.analyze()}get origin(){return this[d].url.origin}get pathname(){return this[d].url.pathname}set pathname(e){this[d].url.pathname=e}get hash(){return this[d].url.hash}set hash(e){this[d].url.hash=e}get search(){return this[d].url.search}set search(e){this[d].url.search=e}get password(){return this[d].url.password}set password(e){this[d].url.password=e}get username(){return this[d].url.username}set username(e){this[d].url.username=e}get basePath(){return this[d].basePath}set basePath(e){this[d].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new h(String(this),this[d].options)}}},9183:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var a=r(6291);class i extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new i}}class n extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,i){if("symbol"==typeof r)return a.g.get(t,r,i);let n=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===n);if(void 0!==s)return a.g.get(t,s,i)},set(t,r,i,n){if("symbol"==typeof r)return a.g.set(t,r,i,n);let s=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===s);return a.g.set(t,o??r,i,n)},has(t,r){if("symbol"==typeof r)return a.g.has(t,r);let i=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0!==n&&a.g.has(t,n)},deleteProperty(t,r){if("symbol"==typeof r)return a.g.deleteProperty(t,r);let i=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0===n||a.g.deleteProperty(t,n)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return i.callable;default:return a.g.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new n(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,a]of this.entries())e.call(t,a,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},6291:(e,t,r)=>{"use strict";r.d(t,{g:()=>a});class a{static get(e,t,r){let a=Reflect.get(e,t,r);return"function"==typeof a?a.bind(e):a}static set(e,t,r,a){return Reflect.set(e,t,r,a)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},9375:(e,t,r)=>{"use strict";r.d(t,{Qb:()=>s,_5:()=>l,vr:()=>u});var a=r(3627),i=r(6291);class n extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new n}}class s{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return n.callable;default:return i.g.get(e,t,r)}}})}}let o=Symbol.for("next.mutated.cookies");function l(e,t){let r=function(e){let t=e[o];return t&&Array.isArray(t)&&0!==t.length?t:[]}(t);if(0===r.length)return!1;let i=new a.n(e),n=i.getAll();for(let e of r)i.set(e);for(let e of n)i.set(e);return!0}class u{static wrap(e,t){let r=new a.n(new Headers);for(let t of e.getAll())r.set(t);let n=[],s=new Set,l=()=>{var e;let i=null==fetch.__nextGetStaticStore?void 0:null==(e=fetch.__nextGetStaticStore())?void 0:e.getStore();i&&(i.pathWasRevalidated=!0);let o=r.getAll();if(n=o.filter(e=>s.has(e.name)),t){let e=[];for(let t of n){let r=new a.n(new Headers);r.set(t),e.push(r.toString())}t.setHeader("Set-Cookie",e)}};return new Proxy(r,{get(e,t,r){switch(t){case o:return n;case"delete":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{l()}};case"set":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{l()}};default:return i.g.get(e,t,r)}}})}}},3627:(e,t,r)=>{"use strict";r.d(t,{n:()=>a.ResponseCookies,q:()=>a.RequestCookies});var a=r(3928)},7845:(e,t,r)=>{"use strict";r.d(t,{x:()=>u});var a=r(580),i=r(9351),n=r(3627);let s=Symbol("internal response"),o=new Set([301,302,303,307,308]);function l(e,t){var r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let r=[];for(let[a,i]of e.request.headers)t.set("x-middleware-request-"+a,i),r.push(a);t.set("x-middleware-override-headers",r.join(","))}}class u extends Response{constructor(e,t={}){super(e,t),this[s]={cookies:new n.n(this.headers),url:t.url?new a.c(t.url,{headers:(0,i.lb)(this.headers),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[s].cookies}static json(e,t){let r=Response.json(e,t);return new u(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!o.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let a="object"==typeof t?t:{},n=new Headers(null==a?void 0:a.headers);return n.set("Location",(0,i.r4)(e)),new u(null,{...a,headers:n,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,i.r4)(e)),l(t,r),new u(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),l(e,t),new u(null,{...e,headers:t})}}},9351:(e,t,r)=>{"use strict";function a(e){let t=new Headers;for(let[r,a]of Object.entries(e)){let e=Array.isArray(a)?a:[a];for(let a of e)void 0!==a&&("number"==typeof a&&(a=a.toString()),t.append(r,a))}return t}function i(e){let t={},r=[];if(e)for(let[a,i]of e.entries())"set-cookie"===a.toLowerCase()?(r.push(...function(e){var t,r,a,i,n,s=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,n=!1;l();)if(","===(r=e.charAt(o))){for(a=o,o+=1,l(),i=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(n=!0,o=i,s.push(e.substring(t,a)),t=o):o=a+1}else o+=1;(!n||o>=e.length)&&s.push(e.substring(t,e.length))}return s}(i)),t[a]=1===r.length?r[0]:r):t[a]=i;return t}function n(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}r.d(t,{EK:()=>a,lb:()=>i,r4:()=>n})},8135:(e,t,r)=>{"use strict";r.r(t),r.d(t,{decode:()=>s,encode:()=>n});let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<a.length;e++)i[a.charCodeAt(e)]=e;let n=e=>{let t=new Uint8Array(e),r,i=t.length,n="";for(r=0;r<i;r+=3)n+=a[t[r]>>2]+a[(3&t[r])<<4|t[r+1]>>4]+a[(15&t[r+1])<<2|t[r+2]>>6]+a[63&t[r+2]];return i%3==2?n=n.substring(0,n.length-1)+"=":i%3==1&&(n=n.substring(0,n.length-2)+"=="),n},s=e=>{let t=.75*e.length,r=e.length,a,n=0,s,o,l,u;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);let c=new ArrayBuffer(t),d=new Uint8Array(c);for(a=0;a<r;a+=4)s=i[e.charCodeAt(a)],o=i[e.charCodeAt(a+1)],l=i[e.charCodeAt(a+2)],u=i[e.charCodeAt(a+3)],d[n++]=s<<2|o>>4,d[n++]=(15&o)<<4|l>>2,d[n++]=(3&l)<<6|63&u;return c}},5441:(e,t,r)=>{"use strict";let a;a=r(9368),e.exports=a},389:(e,t,r)=>{"use strict";function a(e){let t=e.indexOf("#"),r=e.indexOf("?"),a=r>-1&&(t<0||r<t);return a||t>-1?{pathname:e.substring(0,a?r:t),query:a?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}r.d(t,{c:()=>a})},9044:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var a=r(389);function i(e,t){if("string"!=typeof e)return!1;let{pathname:r}=(0,a.c)(e);return r===t||r.startsWith(t+"/")}},1635:(e,t,r)=>{"use strict";r.d(t,{n:()=>i});var a=r(9044);function i(e,t){if(!(0,a.Y)(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:"/"+r}},5640:(e,t,r)=>{"use strict";function a(e){return e.replace(/\/$/,"")||"/"}r.d(t,{Q:()=>a})},440:e=>{"use strict";e.exports=(function e(t,r,a){function i(s,o){if(!r[s]){if(!t[s]){if(n)return n(s,!0);throw Error("Cannot find module '"+s+"'")}o=r[s]={exports:{}},t[s][0].call(o.exports,function(e){return i(t[s][1][e]||e)},o,o.exports,e,t,r,a)}return r[s].exports}for(var n=void 0,s=0;s<a.length;s++)i(a[s]);return i})({1:[function(e,t,r){(function(a,i,n,s,o,l,u,c,d){var h=e("crypto");function p(e,t){var r;return void 0===(r="passthrough"!==(t=g(e,t)).algorithm?h.createHash(t.algorithm):new b).write&&(r.write=r.update,r.end=r.update),v(t,r).dispatch(e),r.update||r.end(""),r.digest?r.digest("buffer"===t.encoding?void 0:t.encoding):(e=r.read(),"buffer"!==t.encoding?e.toString(t.encoding):e)}(r=t.exports=p).sha1=function(e){return p(e)},r.keys=function(e){return p(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},r.MD5=function(e){return p(e,{algorithm:"md5",encoding:"hex"})},r.keysMD5=function(e){return p(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=h.getHashes?h.getHashes().slice():["sha1","md5"],m=(f.push("passthrough"),["buffer","hex","binary","base64"]);function g(e,t){var r={};if(r.algorithm=(t=t||{}).algorithm||"sha1",r.encoding=t.encoding||"hex",r.excludeValues=!!t.excludeValues,r.algorithm=r.algorithm.toLowerCase(),r.encoding=r.encoding.toLowerCase(),r.ignoreUnknown=!0===t.ignoreUnknown,r.respectType=!1!==t.respectType,r.respectFunctionNames=!1!==t.respectFunctionNames,r.respectFunctionProperties=!1!==t.respectFunctionProperties,r.unorderedArrays=!0===t.unorderedArrays,r.unorderedSets=!1!==t.unorderedSets,r.unorderedObjects=!1!==t.unorderedObjects,r.replacer=t.replacer||void 0,r.excludeKeys=t.excludeKeys||void 0,void 0===e)throw Error("Object argument required.");for(var a=0;a<f.length;++a)f[a].toLowerCase()===r.algorithm.toLowerCase()&&(r.algorithm=f[a]);if(-1===f.indexOf(r.algorithm))throw Error('Algorithm "'+r.algorithm+'"  not supported. supported values: '+f.join(", "));if(-1===m.indexOf(r.encoding)&&"passthrough"!==r.algorithm)throw Error('Encoding "'+r.encoding+'"  not supported. supported values: '+m.join(", "));return r}function y(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function v(e,t,r){function a(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return r=r||[],{dispatch:function(t){return this["_"+(null===(t=e.replacer?e.replacer(t):t)?"null":typeof t)](t)},_object:function(t){var i,s=Object.prototype.toString.call(t),o=/\[object (.*)\]/i.exec(s);if(o=(o=o?o[1]:"unknown:["+s+"]").toLowerCase(),0<=(s=r.indexOf(t)))return this.dispatch("[CIRCULAR:"+s+"]");if(r.push(t),void 0!==n&&n.isBuffer&&n.isBuffer(t))return a("buffer:"),a(t);if("object"===o||"function"===o||"asyncfunction"===o)return s=Object.keys(t),e.unorderedObjects&&(s=s.sort()),!1===e.respectType||y(t)||s.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(s=s.filter(function(t){return!e.excludeKeys(t)})),a("object:"+s.length+":"),i=this,s.forEach(function(r){i.dispatch(r),a(":"),e.excludeValues||i.dispatch(t[r]),a(",")});if(!this["_"+o]){if(e.ignoreUnknown)return a("["+o+"]");throw Error('Unknown object type "'+o+'"')}this["_"+o](t)},_array:function(t,i){i=void 0!==i?i:!1!==e.unorderedArrays;var n=this;if(a("array:"+t.length+":"),!i||t.length<=1)return t.forEach(function(e){return n.dispatch(e)});var s=[],i=t.map(function(t){var a=new b,i=r.slice();return v(e,a,i).dispatch(t),s=s.concat(i.slice(r.length)),a.read().toString()});return r=r.concat(s),i.sort(),this._array(i,!1)},_date:function(e){return a("date:"+e.toJSON())},_symbol:function(e){return a("symbol:"+e.toString())},_error:function(e){return a("error:"+e.toString())},_boolean:function(e){return a("bool:"+e.toString())},_string:function(e){a("string:"+e.length+":"),a(e.toString())},_function:function(t){a("fn:"),y(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return a("number:"+e.toString())},_xml:function(e){return a("xml:"+e.toString())},_null:function(){return a("Null")},_undefined:function(){return a("Undefined")},_regexp:function(e){return a("regex:"+e.toString())},_uint8array:function(e){return a("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return a("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return a("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return a("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return a("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return a("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return a("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return a("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return a("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return a("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return a("url:"+e.toString())},_map:function(t){return a("map:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_set:function(t){return a("set:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_file:function(e){return a("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return a("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return a("domwindow")},_bigint:function(e){return a("bigint:"+e.toString())},_process:function(){return a("process")},_timer:function(){return a("timer")},_pipe:function(){return a("pipe")},_tcp:function(){return a("tcp")},_udp:function(){return a("udp")},_tty:function(){return a("tty")},_statwatcher:function(){return a("statwatcher")},_securecontext:function(){return a("securecontext")},_connection:function(){return a("connection")},_zlib:function(){return a("zlib")},_context:function(){return a("context")},_nodescript:function(){return a("nodescript")},_httpparser:function(){return a("httpparser")},_dataview:function(){return a("dataview")},_signal:function(){return a("signal")},_fsevent:function(){return a("fsevent")},_tlswrap:function(){return a("tlswrap")}}}function b(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}r.writeToStream=function(e,t,r){return void 0===r&&(r=t,t={}),v(t=g(e,t),r).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,t,r){(function(e,t,a,i,n,s,o,l,u){!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array;function r(e){return 43===(e=e.charCodeAt(0))||45===e?62:47===e||95===e?63:e<48?-1:e<58?e-48+26+26:e<91?e-65:e<123?e-97+26:void 0}e.toByteArray=function(e){if(0<e.length%4)throw Error("Invalid string. Length must be a multiple of 4");var a,i,n=e.length,n="="===e.charAt(n-2)?2:"="===e.charAt(n-1)?1:0,s=new t(3*e.length/4-n),o=0<n?e.length-4:e.length,l=0;function u(e){s[l++]=e}for(a=0;a<o;a+=4)u((16711680&(i=r(e.charAt(a))<<18|r(e.charAt(a+1))<<12|r(e.charAt(a+2))<<6|r(e.charAt(a+3))))>>16),u((65280&i)>>8),u(255&i);return 2==n?u(255&(i=r(e.charAt(a))<<2|r(e.charAt(a+1))>>4)):1==n&&(u((i=r(e.charAt(a))<<10|r(e.charAt(a+1))<<4|r(e.charAt(a+2))>>2)>>8&255),u(255&i)),s},e.fromByteArray=function(e){var t,r,a,i,n=e.length%3,s="";function o(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,a=e.length-n;t<a;t+=3)s+=o((i=r=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+o(i>>12&63)+o(i>>6&63)+o(63&i);switch(n){case 1:s=(s+=o((r=e[e.length-1])>>2))+o(r<<4&63)+"==";break;case 2:s=(s=(s+=o((r=(e[e.length-2]<<8)+e[e.length-1])>>10))+o(r>>4&63))+o(r<<2&63)+"="}return s}}(void 0===r?this.base64js={}:r)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,t,r){(function(t,a,i,n,s,o,l,u,c){var d=e("base64-js"),h=e("ieee754");function i(e,t,r){if(!(this instanceof i))return new i(e,t,r);var a,n,s,o,l=typeof e;if("base64"===t&&"string"==l)for(e=(o=e).trim?o.trim():o.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==l)a=E(e);else if("string"==l)a=i.byteLength(e,t);else{if("object"!=l)throw Error("First argument needs to be a number, array or string.");a=E(e.length)}if(i._useTypedArrays?n=i._augment(new Uint8Array(a)):((n=this).length=a,n._isBuffer=!0),i._useTypedArrays&&"number"==typeof e.byteLength)n._set(e);else if(k(o=e)||i.isBuffer(o)||o&&"object"==typeof o&&"number"==typeof o.length)for(s=0;s<a;s++)i.isBuffer(e)?n[s]=e.readUInt8(s):n[s]=e[s];else if("string"==l)n.write(e,0,t);else if("number"==l&&!i._useTypedArrays&&!r)for(s=0;s<a;s++)n[s]=0;return n}function p(e,t,r,a){a||(D("boolean"==typeof r,"missing or invalid endian"),D(null!=t,"missing offset"),D(t+1<e.length,"Trying to read beyond buffer length"));var i,a=e.length;if(!(a<=t))return r?(i=e[t],t+1<a&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<a&&(i|=e[t+1])),i}function f(e,t,r,a){a||(D("boolean"==typeof r,"missing or invalid endian"),D(null!=t,"missing offset"),D(t+3<e.length,"Trying to read beyond buffer length"));var i,a=e.length;if(!(a<=t))return r?(t+2<a&&(i=e[t+2]<<16),t+1<a&&(i|=e[t+1]<<8),i|=e[t],t+3<a&&(i+=e[t+3]<<24>>>0)):(t+1<a&&(i=e[t+1]<<16),t+2<a&&(i|=e[t+2]<<8),t+3<a&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}function m(e,t,r,a){if(a||(D("boolean"==typeof r,"missing or invalid endian"),D(null!=t,"missing offset"),D(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 32768&(a=p(e,t,r,!0))?-1*(65535-a+1):a}function g(e,t,r,a){if(a||(D("boolean"==typeof r,"missing or invalid endian"),D(null!=t,"missing offset"),D(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 2147483648&(a=f(e,t,r,!0))?-1*(4294967295-a+1):a}function y(e,t,r,a){return a||(D("boolean"==typeof r,"missing or invalid endian"),D(t+3<e.length,"Trying to read beyond buffer length")),h.read(e,t,r,23,4)}function v(e,t,r,a){return a||(D("boolean"==typeof r,"missing or invalid endian"),D(t+7<e.length,"Trying to read beyond buffer length")),h.read(e,t,r,52,8)}function b(e,t,r,a,i){if(i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+1<e.length,"trying to write beyond buffer length"),R(t,65535)),!((i=e.length)<=r))for(var n=0,s=Math.min(i-r,2);n<s;n++)e[r+n]=(t&255<<8*(a?n:1-n))>>>8*(a?n:1-n)}function _(e,t,r,a,i){if(i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+3<e.length,"trying to write beyond buffer length"),R(t,4294967295)),!((i=e.length)<=r))for(var n=0,s=Math.min(i-r,4);n<s;n++)e[r+n]=t>>>8*(a?n:3-n)&255}function w(e,t,r,a,i){i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+1<e.length,"Trying to write beyond buffer length"),L(t,32767,-32768)),e.length<=r||b(e,0<=t?t:65535+t+1,r,a,i)}function x(e,t,r,a,i){i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+3<e.length,"Trying to write beyond buffer length"),L(t,2147483647,-2147483648)),e.length<=r||_(e,0<=t?t:4294967295+t+1,r,a,i)}function P(e,t,r,a,i){i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+3<e.length,"Trying to write beyond buffer length"),M(t,34028234663852886e22,-34028234663852886e22)),e.length<=r||h.write(e,t,r,a,23,4)}function O(e,t,r,a,i){i||(D(null!=t,"missing value"),D("boolean"==typeof a,"missing or invalid endian"),D(null!=r,"missing offset"),D(r+7<e.length,"Trying to write beyond buffer length"),M(t,17976931348623157e292,-17976931348623157e292)),e.length<=r||h.write(e,t,r,a,52,8)}r.Buffer=i,r.SlowBuffer=i,r.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(e){return!(null==e||!e._isBuffer)},i.byteLength=function(e,t){var r;switch(e+="",t||"utf8"){case"hex":r=e.length/2;break;case"utf8":case"utf-8":r=I(e).length;break;case"ascii":case"binary":case"raw":r=e.length;break;case"base64":r=C(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*e.length;break;default:throw Error("Unknown encoding")}return r},i.concat=function(e,t){if(D(k(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new i(0);if(1===e.length)return e[0];if("number"!=typeof t)for(n=t=0;n<e.length;n++)t+=e[n].length;for(var r=new i(t),a=0,n=0;n<e.length;n++){var s=e[n];s.copy(r,a),a+=s.length}return r},i.prototype.write=function(e,t,r,a){isFinite(t)?isFinite(r)||(a=r,r=void 0):(p=a,a=t,t=r,r=p),t=Number(t)||0;var n,s,o,l,u,c,d,h,p=this.length-t;switch((!r||p<(r=Number(r)))&&(r=p),a=String(a||"utf8").toLowerCase()){case"hex":u=function(e,t,r,a){r=Number(r)||0;var n=e.length-r;(!a||n<(a=Number(a)))&&(a=n),D((n=t.length)%2==0,"Invalid hex string"),n/2<a&&(a=n/2);for(var s=0;s<a;s++){var o=parseInt(t.substr(2*s,2),16);D(!isNaN(o),"Invalid hex string"),e[r+s]=o}return i._charsWritten=2*s,s}(this,e,t,r);break;case"utf8":case"utf-8":c=this,d=t,h=r,u=i._charsWritten=j(I(e),c,d,h);break;case"ascii":case"binary":n=t,s=r,u=i._charsWritten=j(function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}(e),this,n,s);break;case"base64":c=this,d=t,h=r,u=i._charsWritten=j(C(e),c,d,h);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=t,l=r,u=i._charsWritten=j(function(e){for(var t,r,a=[],i=0;i<e.length;i++)t=(r=e.charCodeAt(i))>>8,a.push(r%=256),a.push(t);return a}(e),this,o,l);break;default:throw Error("Unknown encoding")}return u},i.prototype.toString=function(e,t,r){var a,i,n;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(r=void 0!==r?Number(r):this.length)===t)return"";switch(e){case"hex":a=function(e,t,r){var a=e.length;(!t||t<0)&&(t=0),(!r||r<0||a<r)&&(r=a);for(var i="",n=t;n<r;n++)i+=A(e[n]);return i}(this,t,r);break;case"utf8":case"utf-8":a=function(e,t,r){var a="",i="";r=Math.min(e.length,r);for(var n=t;n<r;n++)e[n]<=127?(a+=N(i)+String.fromCharCode(e[n]),i=""):i+="%"+e[n].toString(16);return a+N(i)}(this,t,r);break;case"ascii":case"binary":a=function(e,t,r){var a="";r=Math.min(e.length,r);for(var i=t;i<r;i++)a+=String.fromCharCode(e[i]);return a}(this,t,r);break;case"base64":n=r,a=0===(i=t)&&n===this.length?d.fromByteArray(this):d.fromByteArray(this.slice(i,n));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":a=function(e,t,r){for(var a=e.slice(t,r),i="",n=0;n<a.length;n+=2)i+=String.fromCharCode(a[n]+256*a[n+1]);return i}(this,t,r);break;default:throw Error("Unknown encoding")}return a},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(e,t,r,a){if(t=t||0,(a=a||0===a?a:this.length)!==(r=r||0)&&0!==e.length&&0!==this.length){D(r<=a,"sourceEnd < sourceStart"),D(0<=t&&t<e.length,"targetStart out of bounds"),D(0<=r&&r<this.length,"sourceStart out of bounds"),D(0<=a&&a<=this.length,"sourceEnd out of bounds"),a>this.length&&(a=this.length);var n=(a=e.length-t<a-r?e.length-t+r:a)-r;if(n<100||!i._useTypedArrays)for(var s=0;s<n;s++)e[s+t]=this[s+r];else e._set(this.subarray(r,r+n),t)}},i.prototype.slice=function(e,t){var r=this.length;if(e=S(e,r,0),t=S(t,r,r),i._useTypedArrays)return i._augment(this.subarray(e,t));for(var a=t-e,n=new i(a,void 0,!0),s=0;s<a;s++)n[s]=this[s+e];return n},i.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},i.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},i.prototype.readUInt8=function(e,t){if(t||(D(null!=e,"missing offset"),D(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},i.prototype.readUInt16LE=function(e,t){return p(this,e,!0,t)},i.prototype.readUInt16BE=function(e,t){return p(this,e,!1,t)},i.prototype.readUInt32LE=function(e,t){return f(this,e,!0,t)},i.prototype.readUInt32BE=function(e,t){return f(this,e,!1,t)},i.prototype.readInt8=function(e,t){if(t||(D(null!=e,"missing offset"),D(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){return m(this,e,!0,t)},i.prototype.readInt16BE=function(e,t){return m(this,e,!1,t)},i.prototype.readInt32LE=function(e,t){return g(this,e,!0,t)},i.prototype.readInt32BE=function(e,t){return g(this,e,!1,t)},i.prototype.readFloatLE=function(e,t){return y(this,e,!0,t)},i.prototype.readFloatBE=function(e,t){return y(this,e,!1,t)},i.prototype.readDoubleLE=function(e,t){return v(this,e,!0,t)},i.prototype.readDoubleBE=function(e,t){return v(this,e,!1,t)},i.prototype.writeUInt8=function(e,t,r){r||(D(null!=e,"missing value"),D(null!=t,"missing offset"),D(t<this.length,"trying to write beyond buffer length"),R(e,255)),t>=this.length||(this[t]=e)},i.prototype.writeUInt16LE=function(e,t,r){b(this,e,t,!0,r)},i.prototype.writeUInt16BE=function(e,t,r){b(this,e,t,!1,r)},i.prototype.writeUInt32LE=function(e,t,r){_(this,e,t,!0,r)},i.prototype.writeUInt32BE=function(e,t,r){_(this,e,t,!1,r)},i.prototype.writeInt8=function(e,t,r){r||(D(null!=e,"missing value"),D(null!=t,"missing offset"),D(t<this.length,"Trying to write beyond buffer length"),L(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,r):this.writeUInt8(255+e+1,t,r))},i.prototype.writeInt16LE=function(e,t,r){w(this,e,t,!0,r)},i.prototype.writeInt16BE=function(e,t,r){w(this,e,t,!1,r)},i.prototype.writeInt32LE=function(e,t,r){x(this,e,t,!0,r)},i.prototype.writeInt32BE=function(e,t,r){x(this,e,t,!1,r)},i.prototype.writeFloatLE=function(e,t,r){P(this,e,t,!0,r)},i.prototype.writeFloatBE=function(e,t,r){P(this,e,t,!1,r)},i.prototype.writeDoubleLE=function(e,t,r){O(this,e,t,!0,r)},i.prototype.writeDoubleBE=function(e,t,r){O(this,e,t,!1,r)},i.prototype.fill=function(e,t,r){if(t=t||0,r=r||this.length,D("number"==typeof(e="string"==typeof(e=e||0)?e.charCodeAt(0):e)&&!isNaN(e),"value is not a number"),D(t<=r,"end < start"),r!==t&&0!==this.length){D(0<=t&&t<this.length,"start out of bounds"),D(0<=r&&r<=this.length,"end out of bounds");for(var a=t;a<r;a++)this[a]=e}},i.prototype.inspect=function(){for(var e=[],t=this.length,a=0;a<t;a++)if(e[a]=A(this[a]),a===r.INSPECT_MAX_BYTES){e[a+1]="...";break}return"<Buffer "+e.join(" ")+">"},i.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw Error("Buffer.toArrayBuffer not supported in this browser");if(i._useTypedArrays)return new i(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;t<r;t+=1)e[t]=this[t];return e.buffer};var T=i.prototype;function S(e,t,r){return"number"!=typeof e?r:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function E(e){return(e=~~Math.ceil(+e))<0?0:e}function k(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function I(e){for(var t=[],r=0;r<e.length;r++){var a=e.charCodeAt(r);if(a<=127)t.push(e.charCodeAt(r));else for(var i=r,n=(55296<=a&&a<=57343&&r++,encodeURIComponent(e.slice(i,r+1)).substr(1).split("%")),s=0;s<n.length;s++)t.push(parseInt(n[s],16))}return t}function C(e){return d.toByteArray(e)}function j(e,t,r,a){for(var i=0;i<a&&!(i+r>=t.length||i>=e.length);i++)t[i+r]=e[i];return i}function N(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function R(e,t){D("number"==typeof e,"cannot write a non-number as a number"),D(0<=e,"specified a negative value for writing an unsigned value"),D(e<=t,"value is larger than maximum value for type"),D(Math.floor(e)===e,"value has a fractional component")}function L(e,t,r){D("number"==typeof e,"cannot write a non-number as a number"),D(e<=t,"value larger than maximum allowed value"),D(r<=e,"value smaller than minimum allowed value"),D(Math.floor(e)===e,"value has a fractional component")}function M(e,t,r){D("number"==typeof e,"cannot write a non-number as a number"),D(e<=t,"value larger than maximum allowed value"),D(r<=e,"value smaller than minimum allowed value")}function D(e,t){if(!e)throw Error(t||"Failed assertion")}i._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=T.get,e.set=T.set,e.write=T.write,e.toString=T.toString,e.toLocaleString=T.toString,e.toJSON=T.toJSON,e.copy=T.copy,e.slice=T.slice,e.readUInt8=T.readUInt8,e.readUInt16LE=T.readUInt16LE,e.readUInt16BE=T.readUInt16BE,e.readUInt32LE=T.readUInt32LE,e.readUInt32BE=T.readUInt32BE,e.readInt8=T.readInt8,e.readInt16LE=T.readInt16LE,e.readInt16BE=T.readInt16BE,e.readInt32LE=T.readInt32LE,e.readInt32BE=T.readInt32BE,e.readFloatLE=T.readFloatLE,e.readFloatBE=T.readFloatBE,e.readDoubleLE=T.readDoubleLE,e.readDoubleBE=T.readDoubleBE,e.writeUInt8=T.writeUInt8,e.writeUInt16LE=T.writeUInt16LE,e.writeUInt16BE=T.writeUInt16BE,e.writeUInt32LE=T.writeUInt32LE,e.writeUInt32BE=T.writeUInt32BE,e.writeInt8=T.writeInt8,e.writeInt16LE=T.writeInt16LE,e.writeInt16BE=T.writeInt16BE,e.writeInt32LE=T.writeInt32LE,e.writeInt32BE=T.writeInt32BE,e.writeFloatLE=T.writeFloatLE,e.writeFloatBE=T.writeFloatBE,e.writeDoubleLE=T.writeDoubleLE,e.writeDoubleBE=T.writeDoubleBE,e.fill=T.fill,e.inspect=T.inspect,e.toArrayBuffer=T.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,t,r){(function(r,a,i,n,s,o,l,u,c){var i=e("buffer").Buffer,d=new i(4);d.fill(0),t.exports={hash:function(e,t,r,a){for(var n=t(function(e,t){e.length%4!=0&&(r=e.length+(4-e.length%4),e=i.concat([e,d],r));for(var r,a=[],n=t?e.readInt32BE:e.readInt32LE,s=0;s<e.length;s+=4)a.push(n.call(e,s));return a}(e=i.isBuffer(e)?e:new i(e),a),8*e.length),t=a,s=new i(r),o=t?s.writeInt32BE:s.writeInt32LE,l=0;l<n.length;l++)o.call(s,n[l],4*l,!0);return s}}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,t,r){(function(t,a,i,n,s,o,l,u,c){var i=e("buffer").Buffer,d=e("./sha"),h=e("./sha256"),p=e("./rng"),f={sha1:d,sha256:h,md5:e("./md5")},m=new i(64);function g(e,t){var r=f[e=e||"sha1"],a=[];return r||y("algorithm:",e,"is not yet supported"),{update:function(e){return i.isBuffer(e)||(e=new i(e)),a.push(e),e.length,this},digest:function(e){var n=i.concat(a),n=t?function(e,t,r){i.isBuffer(t)||(t=new i(t)),i.isBuffer(r)||(r=new i(r)),t.length>64?t=e(t):t.length<64&&(t=i.concat([t,m],64));for(var a=new i(64),n=new i(64),s=0;s<64;s++)a[s]=54^t[s],n[s]=92^t[s];return r=e(i.concat([a,r])),e(i.concat([n,r]))}(r,t,n):r(n);return a=null,e?n.toString(e):n}}}function y(){var e=[].slice.call(arguments).join(" ");throw Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}m.fill(0),r.createHash=function(e){return g(e)},r.createHmac=g,r.randomBytes=function(e,t){if(!t||!t.call)return new i(p(e));try{t.call(this,void 0,new i(p(e)))}catch(e){t(e)}};var v,b=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],_=function(e){r[e]=function(){y("sorry,",e,"is not implemented yet")}};for(v in b)_(b[v],v)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,t,r){(function(r,a,i,n,s,o,l,u,c){var d=e("./helpers");function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,a=-271733879,i=-1732584194,n=271733878,s=0;s<e.length;s+=16){var o=r,l=a,u=i,c=n,r=f(r,a,i,n,e[s+0],7,-680876936),n=f(n,r,a,i,e[s+1],12,-389564586),i=f(i,n,r,a,e[s+2],17,606105819),a=f(a,i,n,r,e[s+3],22,-1044525330);r=f(r,a,i,n,e[s+4],7,-176418897),n=f(n,r,a,i,e[s+5],12,1200080426),i=f(i,n,r,a,e[s+6],17,-1473231341),a=f(a,i,n,r,e[s+7],22,-45705983),r=f(r,a,i,n,e[s+8],7,1770035416),n=f(n,r,a,i,e[s+9],12,-1958414417),i=f(i,n,r,a,e[s+10],17,-42063),a=f(a,i,n,r,e[s+11],22,-1990404162),r=f(r,a,i,n,e[s+12],7,1804603682),n=f(n,r,a,i,e[s+13],12,-40341101),i=f(i,n,r,a,e[s+14],17,-1502002290),r=m(r,a=f(a,i,n,r,e[s+15],22,1236535329),i,n,e[s+1],5,-165796510),n=m(n,r,a,i,e[s+6],9,-1069501632),i=m(i,n,r,a,e[s+11],14,643717713),a=m(a,i,n,r,e[s+0],20,-373897302),r=m(r,a,i,n,e[s+5],5,-701558691),n=m(n,r,a,i,e[s+10],9,38016083),i=m(i,n,r,a,e[s+15],14,-660478335),a=m(a,i,n,r,e[s+4],20,-405537848),r=m(r,a,i,n,e[s+9],5,568446438),n=m(n,r,a,i,e[s+14],9,-1019803690),i=m(i,n,r,a,e[s+3],14,-187363961),a=m(a,i,n,r,e[s+8],20,1163531501),r=m(r,a,i,n,e[s+13],5,-1444681467),n=m(n,r,a,i,e[s+2],9,-51403784),i=m(i,n,r,a,e[s+7],14,1735328473),r=g(r,a=m(a,i,n,r,e[s+12],20,-1926607734),i,n,e[s+5],4,-378558),n=g(n,r,a,i,e[s+8],11,-2022574463),i=g(i,n,r,a,e[s+11],16,1839030562),a=g(a,i,n,r,e[s+14],23,-35309556),r=g(r,a,i,n,e[s+1],4,-1530992060),n=g(n,r,a,i,e[s+4],11,1272893353),i=g(i,n,r,a,e[s+7],16,-155497632),a=g(a,i,n,r,e[s+10],23,-1094730640),r=g(r,a,i,n,e[s+13],4,681279174),n=g(n,r,a,i,e[s+0],11,-358537222),i=g(i,n,r,a,e[s+3],16,-722521979),a=g(a,i,n,r,e[s+6],23,76029189),r=g(r,a,i,n,e[s+9],4,-640364487),n=g(n,r,a,i,e[s+12],11,-421815835),i=g(i,n,r,a,e[s+15],16,530742520),r=y(r,a=g(a,i,n,r,e[s+2],23,-995338651),i,n,e[s+0],6,-198630844),n=y(n,r,a,i,e[s+7],10,1126891415),i=y(i,n,r,a,e[s+14],15,-1416354905),a=y(a,i,n,r,e[s+5],21,-57434055),r=y(r,a,i,n,e[s+12],6,1700485571),n=y(n,r,a,i,e[s+3],10,-1894986606),i=y(i,n,r,a,e[s+10],15,-1051523),a=y(a,i,n,r,e[s+1],21,-2054922799),r=y(r,a,i,n,e[s+8],6,1873313359),n=y(n,r,a,i,e[s+15],10,-30611744),i=y(i,n,r,a,e[s+6],15,-1560198380),a=y(a,i,n,r,e[s+13],21,1309151649),r=y(r,a,i,n,e[s+4],6,-145523070),n=y(n,r,a,i,e[s+11],10,-1120210379),i=y(i,n,r,a,e[s+2],15,718787259),a=y(a,i,n,r,e[s+9],21,-343485551),r=v(r,o),a=v(a,l),i=v(i,u),n=v(n,c)}return[r,a,i,n]}function p(e,t,r,a,i,n){return v((t=v(v(t,e),v(a,n)))<<i|t>>>32-i,r)}function f(e,t,r,a,i,n,s){return p(t&r|~t&a,e,t,i,n,s)}function m(e,t,r,a,i,n,s){return p(t&a|r&~a,e,t,i,n,s)}function g(e,t,r,a,i,n,s){return p(t^r^a,e,t,i,n,s)}function y(e,t,r,a,i,n,s){return p(r^(t|~a),e,t,i,n,s)}function v(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}t.exports=function(e){return d.hash(e,h,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,t,r){(function(e,r,a,i,n,s,o,l,u){var c;t.exports=c||function(e){for(var t,r=Array(e),a=0;a<e;a++)0==(3&a)&&(t=4294967296*Math.random()),r[a]=t>>>((3&a)<<3)&255;return r}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,t,r){(function(r,a,i,n,s,o,l,u,c){var d=e("./helpers");function h(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r,a,i,n=Array(80),s=1732584193,o=-271733879,l=-1732584194,u=271733878,c=-1009589776,d=0;d<e.length;d+=16){for(var h=s,m=o,g=l,y=u,v=c,b=0;b<80;b++){n[b]=b<16?e[d+b]:f(n[b-3]^n[b-8]^n[b-14]^n[b-16],1);var _=p(p(f(s,5),(_=o,a=l,i=u,(r=b)<20?_&a|~_&i:!(r<40)&&r<60?_&a|_&i|a&i:_^a^i)),p(p(c,n[b]),(r=b)<20?1518500249:r<40?1859775393:r<60?-1894007588:-899497514)),c=u,u=l,l=f(o,30),o=s,s=_}s=p(s,h),o=p(o,m),l=p(l,g),u=p(u,y),c=p(c,v)}return[s,o,l,u,c]}function p(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(e,t){return e<<t|e>>>32-t}t.exports=function(e){return d.hash(e,h,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,t,r){(function(r,a,i,n,s,o,l,u,c){function d(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function h(e,t){var r,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],n=Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var s,o,l=0;l<e.length;l+=16){for(var u=i[0],c=i[1],h=i[2],p=i[3],g=i[4],y=i[5],v=i[6],b=i[7],_=0;_<64;_++)n[_]=_<16?e[_+l]:d(d(d(f(o=n[_-2],17)^f(o,19)^m(o,10),n[_-7]),f(o=n[_-15],7)^f(o,18)^m(o,3)),n[_-16]),r=d(d(d(d(b,f(o=g,6)^f(o,11)^f(o,25)),g&y^~g&v),a[_]),n[_]),s=d(f(s=u,2)^f(s,13)^f(s,22),u&c^u&h^c&h),b=v,v=y,y=g,g=d(p,r),p=h,h=c,c=u,u=d(r,s);i[0]=d(u,i[0]),i[1]=d(c,i[1]),i[2]=d(h,i[2]),i[3]=d(p,i[3]),i[4]=d(g,i[4]),i[5]=d(y,i[5]),i[6]=d(v,i[6]),i[7]=d(b,i[7])}return i}var p=e("./helpers"),f=function(e,t){return e>>>t|e<<32-t},m=function(e,t){return e>>>t};t.exports=function(e){return p.hash(e,h,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,t,r){(function(e,t,a,i,n,s,o,l,u){r.read=function(e,t,r,a,i){var n,s,o=8*i-a-1,l=(1<<o)-1,u=l>>1,c=-7,d=r?i-1:0,h=r?-1:1,i=e[t+d];for(d+=h,n=i&(1<<-c)-1,i>>=-c,c+=o;0<c;n=256*n+e[t+d],d+=h,c-=8);for(s=n&(1<<-c)-1,n>>=-c,c+=a;0<c;s=256*s+e[t+d],d+=h,c-=8);if(0===n)n=1-u;else{if(n===l)return s?NaN:1/0*(i?-1:1);s+=Math.pow(2,a),n-=u}return(i?-1:1)*s*Math.pow(2,n-a)},r.write=function(e,t,r,a,i,n){var s,o,l=8*n-i-1,u=(1<<l)-1,c=u>>1,d=23===i?5960464477539062e-23:0,h=a?0:n-1,p=a?1:-1,n=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-s))<1&&(s--,a*=2),2<=(t+=1<=s+c?d/a:d*Math.pow(2,1-c))*a&&(s++,a/=2),u<=s+c?(o=0,s=u):1<=s+c?(o=(t*a-1)*Math.pow(2,i),s+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),s=0));8<=i;e[r+h]=255&o,h+=p,o/=256,i-=8);for(s=s<<i|o,l+=i;0<l;e[r+h]=255&s,h+=p,s/=256,l-=8);e[r+h-p]|=128*n}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,t,r){(function(e,r,a,i,n,s,o,l,u){function c(){}(e=t.exports={}).nextTick=function(e){setTimeout(e,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=c,e.addListener=c,e.once=c,e.off=c,e.removeListener=c,e.removeAllListeners=c,e.emit=c,e.binding=function(e){throw Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)},5519:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},6519:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(1342),i=r(6857),n=r(5662),s=()=>{},o=new i.TimeoutError;t.default=class extends a{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let n=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await n)}catch(e){a(e)}this._next()};this._queue.enqueue(n,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},1316:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let a=0,i=e.length;for(;i>0;){let n=i/2|0,s=a+n;0>=r(e[s],t)?(a=++s,i-=n+1):i=n}return a}},5662:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(1316);t.default=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let i=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},1333:(e,t,r)=>{"use strict";let a=r(6330),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},o=e=>i.includes(e),l=(e,t)=>new Promise((r,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=a.operation(t);l.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){i(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof n)l.stop(),i(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),i(e);else{s(e,a,t);try{await t.onFailedAttempt(e)}catch(e){i(e);return}l.retry(e)||i(l.mainError())}}})});e.exports=l,e.exports.default=l,e.exports.AbortError=n},6857:(e,t,r)=>{"use strict";let a=r(5519);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}let n=(e,t,r)=>new Promise((n,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){n(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){s(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new i(a);"function"==typeof e.cancel&&e.cancel(),s(o)},t);a(e.then(n,s),()=>{clearTimeout(o)})});e.exports=n,e.exports.default=n,e.exports.TimeoutError=i},6330:(e,t,r)=>{"use strict";e.exports=r(8115)},8115:(e,t,r)=>{var a=r(8769);t.operation=function(e){var r=t.timeouts(e);return new a(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<t.retries;i++)a.push(this.createTimeout(i,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(i,t)),a.sort(function(e,t){return e-t}),a},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var i in a=[],e)"function"==typeof e[i]&&a.push(i);for(var n=0;n<a.length;n++){var s=a[n],o=e[s];e[s]=(function(a){var i=t.operation(r),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){a.apply(e,n)})}).bind(e,o),e[s].options=r}}},8769:e=>{"use strict";function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var i=this._errors[a],n=i.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=i,r=s)}return t}},7873:(e,t,r)=>{"use strict";let a;r.d(t,{Z:()=>u});let i="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),n={randomUUID:i},s=new Uint8Array(16);function o(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}let l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let u=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();e=e||{};let a=e.random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(a)}},8104:(e,t,r)=>{"use strict";if("object"==typeof globalThis)a=globalThis;else try{a=r(4178)}catch(e){}finally{if(!a)throw Error("Could not determine global this")}var a,i=a.WebSocket||a.MozWebSocket,n=r(7661);function s(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(s,e,{get:function(){return i[e]}})}),e.exports={w3cwebsocket:i?s:null,version:n}},7661:(e,t,r)=>{"use strict";e.exports=r(9046).version},2552:(e,t,r)=>{"use strict";t.Y_=void 0;let a=r(5667);Object.defineProperty(t,"Y_",{enumerable:!0,get:function(){return a.zodToJsonSchema}}),a.zodToJsonSchema},5774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=void 0,t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"},t.getDefaultOptions=e=>"string"==typeof e?Object.assign(Object.assign({},t.defaultOptions),{name:e}):Object.assign(Object.assign({},t.defaultOptions),e)},6531:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRefs=void 0;let a=r(5774);t.getRefs=e=>{let t=(0,a.getDefaultOptions)(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return Object.assign(Object.assign({},t),{currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))})}},7385:(e,t)=>{"use strict";function r(e,t,r,a){(null==a?void 0:a.errorMessages)&&r&&(e.errorMessage=Object.assign(Object.assign({},e.errorMessage),{[t]:r}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setResponseValueAndErrors=t.addErrorMessage=void 0,t.addErrorMessage=r,t.setResponseValueAndErrors=function(e,t,a,i,n){e[t]=a,r(e,t,i,n)}},6119:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDef=void 0;let a=r(1487),i=r(9577),n=r(8411),s=r(678),o=r(7494),l=r(308),u=r(2418),c=r(1521),d=r(4870),h=r(8170),p=r(829),f=r(9715),m=r(9789),g=r(90),y=r(9041),v=r(4229),b=r(2575),_=r(9988),w=r(1900),x=r(327),P=r(6846),O=r(8397),T=r(5303),S=r(1009),E=r(6146),k=r(5093),A=r(3236),I=r(1657),C=r(1722),j=r(14);function N(e,t,r=!1){let a=t.seen.get(e);if(a&&!r){let e=R(a,t);if(void 0!==e)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let n=M(e,e.typeName,t);return n&&D(e,t,n),i.jsonSchema=n,n}t.parseDef=N;let R=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:0===e.path.length?"":1===e.path.length?`${e.path[0]}/`:e.path.join("/")};case"relative":return{$ref:L(t.currentPath,e.path)};case"none":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return;case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return e.jsonSchema}},L=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},M=(e,t,r)=>{switch(t){case a.ZodFirstPartyTypeKind.ZodString:return(0,k.parseStringDef)(e,r);case a.ZodFirstPartyTypeKind.ZodNumber:return(0,w.parseNumberDef)(e,r);case a.ZodFirstPartyTypeKind.ZodObject:return(0,x.parseObjectDef)(e,r);case a.ZodFirstPartyTypeKind.ZodBigInt:return(0,s.parseBigintDef)(e,r);case a.ZodFirstPartyTypeKind.ZodBoolean:return(0,o.parseBooleanDef)();case a.ZodFirstPartyTypeKind.ZodDate:return(0,c.parseDateDef)(e,r);case a.ZodFirstPartyTypeKind.ZodUndefined:return(0,I.parseUndefinedDef)();case a.ZodFirstPartyTypeKind.ZodNull:return(0,b.parseNullDef)(r);case a.ZodFirstPartyTypeKind.ZodArray:return(0,n.parseArrayDef)(e,r);case a.ZodFirstPartyTypeKind.ZodUnion:case a.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,C.parseUnionDef)(e,r);case a.ZodFirstPartyTypeKind.ZodIntersection:return(0,f.parseIntersectionDef)(e,r);case a.ZodFirstPartyTypeKind.ZodTuple:return(0,A.parseTupleDef)(e,r);case a.ZodFirstPartyTypeKind.ZodRecord:return(0,S.parseRecordDef)(e,r);case a.ZodFirstPartyTypeKind.ZodLiteral:return(0,m.parseLiteralDef)(e,r);case a.ZodFirstPartyTypeKind.ZodEnum:return(0,p.parseEnumDef)(e);case a.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,y.parseNativeEnumDef)(e);case a.ZodFirstPartyTypeKind.ZodNullable:return(0,_.parseNullableDef)(e,r);case a.ZodFirstPartyTypeKind.ZodOptional:return(0,P.parseOptionalDef)(e,r);case a.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(e,r);case a.ZodFirstPartyTypeKind.ZodSet:return(0,E.parseSetDef)(e,r);case a.ZodFirstPartyTypeKind.ZodLazy:return N(e.getter()._def,r);case a.ZodFirstPartyTypeKind.ZodPromise:return(0,T.parsePromiseDef)(e,r);case a.ZodFirstPartyTypeKind.ZodNaN:case a.ZodFirstPartyTypeKind.ZodNever:return(0,v.parseNeverDef)();case a.ZodFirstPartyTypeKind.ZodEffects:return(0,h.parseEffectsDef)(e,r);case a.ZodFirstPartyTypeKind.ZodAny:return(0,i.parseAnyDef)();case a.ZodFirstPartyTypeKind.ZodUnknown:return(0,j.parseUnknownDef)();case a.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(e,r);case a.ZodFirstPartyTypeKind.ZodBranded:return(0,l.parseBrandedDef)(e,r);case a.ZodFirstPartyTypeKind.ZodCatch:return(0,u.parseCatchDef)(e,r);case a.ZodFirstPartyTypeKind.ZodPipeline:return(0,O.parsePipelineDef)(e,r);case a.ZodFirstPartyTypeKind.ZodFunction:case a.ZodFirstPartyTypeKind.ZodVoid:case a.ZodFirstPartyTypeKind.ZodSymbol:default:return}},D=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r)},9577:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnyDef=void 0,t.parseAnyDef=function(){return{}}},8411:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseArrayDef=void 0;let a=r(1487),i=r(7385),n=r(6119);t.parseArrayDef=function(e,t){var r,s;let o={type:"array"};return(null===(s=null===(r=e.type)||void 0===r?void 0:r._def)||void 0===s?void 0:s.typeName)!==a.ZodFirstPartyTypeKind.ZodAny&&(o.items=(0,n.parseDef)(e.type._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&(0,i.setResponseValueAndErrors)(o,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&(0,i.setResponseValueAndErrors)(o,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&((0,i.setResponseValueAndErrors)(o,"minItems",e.exactLength.value,e.exactLength.message,t),(0,i.setResponseValueAndErrors)(o,"maxItems",e.exactLength.value,e.exactLength.message,t)),o}},678:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBigintDef=void 0;let a=r(7385);t.parseBigintDef=function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let i of e.checks)switch(i.kind){case"min":"jsonSchema7"===t.target?i.inclusive?(0,a.setResponseValueAndErrors)(r,"minimum",i.value,i.message,t):(0,a.setResponseValueAndErrors)(r,"exclusiveMinimum",i.value,i.message,t):(i.inclusive||(r.exclusiveMinimum=!0),(0,a.setResponseValueAndErrors)(r,"minimum",i.value,i.message,t));break;case"max":"jsonSchema7"===t.target?i.inclusive?(0,a.setResponseValueAndErrors)(r,"maximum",i.value,i.message,t):(0,a.setResponseValueAndErrors)(r,"exclusiveMaximum",i.value,i.message,t):(i.inclusive||(r.exclusiveMaximum=!0),(0,a.setResponseValueAndErrors)(r,"maximum",i.value,i.message,t));break;case"multipleOf":(0,a.setResponseValueAndErrors)(r,"multipleOf",i.value,i.message,t)}return r}},7494:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBooleanDef=void 0,t.parseBooleanDef=function(){return{type:"boolean"}}},308:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBrandedDef=void 0;let a=r(6119);t.parseBrandedDef=function(e,t){return(0,a.parseDef)(e.type._def,t)}},2418:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCatchDef=void 0;let a=r(6119);t.parseCatchDef=(e,t)=>(0,a.parseDef)(e.innerType._def,t)},1521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateDef=void 0;let a=r(7385);t.parseDateDef=function(e,t){return"integer"==t.dateStrategy?i(e,t):{type:"string",format:"date-time"}};let i=(e,t)=>{let r={type:"integer",format:"unix-time"};for(let i of e.checks)switch(i.kind){case"min":"jsonSchema7"===t.target&&(0,a.setResponseValueAndErrors)(r,"minimum",i.value,i.message,t);break;case"max":"jsonSchema7"===t.target&&(0,a.setResponseValueAndErrors)(r,"maximum",i.value,i.message,t)}return r}},4870:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDefaultDef=void 0;let a=r(6119);t.parseDefaultDef=function(e,t){return Object.assign(Object.assign({},(0,a.parseDef)(e.innerType._def,t)),{default:e.defaultValue()})}},8170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEffectsDef=void 0;let a=r(6119);t.parseEffectsDef=function(e,t){return"input"===t.effectStrategy?(0,a.parseDef)(e.schema._def,t):{}}},829:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEnumDef=void 0,t.parseEnumDef=function(e){return{type:"string",enum:e.values}}},9715:(e,t,r)=>{"use strict";var a=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)0>t.indexOf(a[i])&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntersectionDef=void 0;let i=r(6119),n=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e;t.parseIntersectionDef=function(e,t){let r=[(0,i.parseDef)(e.left._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]})),(0,i.parseDef)(e.right._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter(e=>!!e),s="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(e=>{if(n(e))o.push(...e.allOf),void 0===e.unevaluatedProperties&&(s=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r}=e,i=a(e,["additionalProperties"]);t=i}else s=void 0;o.push(t)}}),o.length?Object.assign({allOf:o},s):void 0}},9789:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLiteralDef=void 0,t.parseLiteralDef=function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}},90:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMapDef=void 0;let a=r(6119);t.parseMapDef=function(e,t){let r=(0,a.parseDef)(e.keyType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||{},i=(0,a.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,i],minItems:2,maxItems:2}}}},9041:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNativeEnumDef=void 0,t.parseNativeEnumDef=function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]),a=r.map(e=>t[e]),i=Array.from(new Set(a.map(e=>typeof e)));return{type:1===i.length?"string"===i[0]?"string":"number":["string","number"],enum:a}}},4229:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNeverDef=void 0,t.parseNeverDef=function(){return{not:{}}}},2575:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullDef=void 0,t.parseNullDef=function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}},9988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullableDef=void 0;let a=r(6119),i=r(1722);t.parseNullableDef=function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:i.primitiveMappings[e.innerType._def.typeName],nullable:!0}:{type:[i.primitiveMappings[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=(0,a.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath]}));return r&&Object.assign(Object.assign({},r),{nullable:!0})}let r=(0,a.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return r&&{anyOf:[r,{type:"null"}]}}},1900:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNumberDef=void 0;let a=r(7385);t.parseNumberDef=function(e,t){let r={type:"number"};if(!e.checks)return r;for(let i of e.checks)switch(i.kind){case"int":r.type="integer",(0,a.addErrorMessage)(r,"type",i.message,t);break;case"min":"jsonSchema7"===t.target?i.inclusive?(0,a.setResponseValueAndErrors)(r,"minimum",i.value,i.message,t):(0,a.setResponseValueAndErrors)(r,"exclusiveMinimum",i.value,i.message,t):(i.inclusive||(r.exclusiveMinimum=!0),(0,a.setResponseValueAndErrors)(r,"minimum",i.value,i.message,t));break;case"max":"jsonSchema7"===t.target?i.inclusive?(0,a.setResponseValueAndErrors)(r,"maximum",i.value,i.message,t):(0,a.setResponseValueAndErrors)(r,"exclusiveMaximum",i.value,i.message,t):(i.inclusive||(r.exclusiveMaximum=!0),(0,a.setResponseValueAndErrors)(r,"maximum",i.value,i.message,t));break;case"multipleOf":(0,a.setResponseValueAndErrors)(r,"multipleOf",i.value,i.message,t)}return r}},327:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseObjectDef=t.parseObjectDefX=void 0;let a=r(6119);t.parseObjectDefX=function(e,t){var r,i;Object.keys(e.shape()).reduce((r,i)=>{let n=e.shape()[i],s=n.isOptional();s||(n=Object.assign({},n._def.innerSchema));let o=(0,a.parseDef)(n._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]}));return void 0===o||(r.properties[i]=o,s||(r.required||(r.required=[]),r.required.push(i))),r},{type:"object",properties:{},additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,a.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});let n=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce((e,[r,i])=>{if(void 0===i||void 0===i._def)return e;let n=(0,a.parseDef)(i._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===n?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:n}),required:i.isOptional()?e.required:[...e.required,r]}},{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(i=(0,a.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===i||i});return n.required.length||delete n.required,n},t.parseObjectDef=function(e,t){var r;let i=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce((e,[r,i])=>{if(void 0===i||void 0===i._def)return e;let n=(0,a.parseDef)(i._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===n?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:n}),required:i.isOptional()?e.required:[...e.required,r]}},{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,a.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});return i.required.length||delete i.required,i}},6846:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptionalDef=void 0;let a=r(6119);t.parseOptionalDef=(e,t)=>{var r;if(t.currentPath.toString()===(null===(r=t.propertyPath)||void 0===r?void 0:r.toString()))return(0,a.parseDef)(e.innerType._def,t);let i=(0,a.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return i?{anyOf:[{not:{}},i]}:{}}},8397:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePipelineDef=void 0;let a=r(6119);t.parsePipelineDef=(e,t)=>{if("input"===t.pipeStrategy)return(0,a.parseDef)(e.in._def,t);let r=(0,a.parseDef)(e.in._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]})),i=(0,a.parseDef)(e.out._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf",r?"1":"0"]}));return{allOf:[r,i].filter(e=>void 0!==e)}}},5303:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePromiseDef=void 0;let a=r(6119);t.parsePromiseDef=function(e,t){return(0,a.parseDef)(e.type._def,t)}},1009:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRecordDef=void 0;let a=r(1487),i=r(6119),n=r(5093);t.parseRecordDef=function(e,t){var r,s,o,l,u;if("openApi3"===t.target&&(null===(r=e.keyType)||void 0===r?void 0:r._def.typeName)===a.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>{var n;return Object.assign(Object.assign({},r),{[a]:null!==(n=(0,i.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",a]})))&&void 0!==n?n:{}})},{}),additionalProperties:!1};let c={type:"object",additionalProperties:null!==(s=(0,i.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))&&void 0!==s?s:{}};if("openApi3"===t.target)return c;if((null===(o=e.keyType)||void 0===o?void 0:o._def.typeName)===a.ZodFirstPartyTypeKind.ZodString&&(null===(l=e.keyType._def.checks)||void 0===l?void 0:l.length)){let r=Object.entries((0,n.parseStringDef)(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:Object.assign(Object.assign({},e),{[t]:r}),{});return Object.assign(Object.assign({},c),{propertyNames:r})}return(null===(u=e.keyType)||void 0===u?void 0:u._def.typeName)===a.ZodFirstPartyTypeKind.ZodEnum?Object.assign(Object.assign({},c),{propertyNames:{enum:e.keyType._def.values}}):c}},6146:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSetDef=void 0;let a=r(7385),i=r(6119);t.parseSetDef=function(e,t){let r=(0,i.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]})),n={type:"array",uniqueItems:!0,items:r};return e.minSize&&(0,a.setResponseValueAndErrors)(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&(0,a.setResponseValueAndErrors)(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}},5093:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringDef=t.emojiPattern=t.ulidPattern=t.cuid2Pattern=t.cuidPattern=t.emailPattern=void 0;let a=r(7385);t.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',t.cuidPattern="^c[^\\s-]{8,}$",t.cuid2Pattern="^[a-z][a-z0-9]*$",t.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",t.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u",t.parseStringDef=function(e,r){let o={type:"string"};if(e.checks)for(let l of e.checks)switch(l.kind){case"min":(0,a.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,l.value):l.value,l.message,r);break;case"max":(0,a.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,l.value):l.value,l.message,r);break;case"email":switch(r.emailStrategy){case"format:email":n(o,"email",l.message,r);break;case"format:idn-email":n(o,"idn-email",l.message,r);break;case"pattern:zod":s(o,t.emailPattern,l.message,r)}break;case"url":n(o,"uri",l.message,r);break;case"uuid":n(o,"uuid",l.message,r);break;case"regex":s(o,l.regex.source,l.message,r);break;case"cuid":s(o,t.cuidPattern,l.message,r);break;case"cuid2":s(o,t.cuid2Pattern,l.message,r);break;case"startsWith":s(o,"^"+i(l.value),l.message,r);break;case"endsWith":s(o,i(l.value)+"$",l.message,r);break;case"datetime":n(o,"date-time",l.message,r);break;case"length":(0,a.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,l.value):l.value,l.message,r),(0,a.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,l.value):l.value,l.message,r);break;case"includes":s(o,i(l.value),l.message,r);break;case"ip":"v6"!==l.version&&n(o,"ipv4",l.message,r),"v4"!==l.version&&n(o,"ipv6",l.message,r);break;case"emoji":s(o,t.emojiPattern,l.message,r);break;case"ulid":s(o,t.ulidPattern,l.message,r)}return o};let i=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),n=(e,t,r,i)=>{var n;e.format||(null===(n=e.anyOf)||void 0===n?void 0:n.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push(Object.assign({format:e.format},e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}})),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push(Object.assign({format:t},r&&i.errorMessages&&{errorMessage:{format:r}}))):(0,a.setResponseValueAndErrors)(e,"format",t,r,i)},s=(e,t,r,i)=>{var n;e.pattern||(null===(n=e.allOf)||void 0===n?void 0:n.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push(Object.assign({pattern:e.pattern},e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}})),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push(Object.assign({pattern:t},r&&i.errorMessages&&{errorMessage:{pattern:r}}))):(0,a.setResponseValueAndErrors)(e,"pattern",t,r,i)}},3236:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTupleDef=void 0;let a=r(6119);t.parseTupleDef=function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>(0,a.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]}))).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:(0,a.parseDef)(e.rest._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>(0,a.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]}))).reduce((e,t)=>void 0===t?e:[...e,t],[])}}},1657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedDef=void 0,t.parseUndefinedDef=function(){return{not:{}}}},1722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;let a=r(6119);t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},t.parseUnionDef=function(e,r){if("openApi3"===r.target)return i(e,r);let a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(e=>e._def.typeName in t.primitiveMappings&&(!e._def.checks||!e._def.checks.length))){let e=a.reduce((e,r)=>{let a=t.primitiveMappings[r._def.typeName];return a&&!e.includes(a)?[...e,a]:e},[]);return{type:e.length>1?e:e[0]}}if(a.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=a.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===a.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:a.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(a.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:a.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return i(e,r)};let i=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>(0,a.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf",`${r}`]}))).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0}},14:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnknownDef=void 0,t.parseUnknownDef=function(){return{}}},5667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;let a=r(6119),i=r(6531);t.zodToJsonSchema=(e,t)=>{var r;let n=(0,i.getRefs)(t),s="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>{var i;return Object.assign(Object.assign({},e),{[t]:null!==(i=(0,a.parseDef)(r._def,Object.assign(Object.assign({},n),{currentPath:[...n.basePath,n.definitionPath,t]}),!0))&&void 0!==i?i:{}})},{}):void 0,o="string"==typeof t?t:null==t?void 0:t.name,l=null!==(r=(0,a.parseDef)(e._def,void 0===o?n:Object.assign(Object.assign({},n),{currentPath:[...n.basePath,n.definitionPath,o]}),!1))&&void 0!==r?r:{},u=void 0===o?s?Object.assign(Object.assign({},l),{[n.definitionPath]:s}):l:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,o].join("/"),[n.definitionPath]:Object.assign(Object.assign({},s),{[o]:l})};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),u}},5848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;let a=r(2628);t.ZodIssueCode=a.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>{let t=JSON.stringify(e,null,2);return t.replace(/"([^"]+)":/g,"$1:")};class i extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a],n=a===i.path.length-1;n?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,a.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=i,i.create=e=>{let t=new i(e);return t}},8193:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;let a=function(e){return e&&e.__esModule?e:{default:e}}(r(9101));t.defaultErrorMap=a.default;let i=a.default;t.setErrorMap=function(e){i=e},t.getErrorMap=function(){return i}},354:(e,t,r)=>{"use strict";var a=Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]},i=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8193),t),i(r(7671),t),i(r(3911),t),i(r(2628),t),i(r(2653),t),i(r(5848),t)},2178:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(t.errorUtil||(t.errorUtil={}))},7671:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;let a=r(8193),i=function(e){return e&&e.__esModule?e:{default:e}}(r(9101));t.makeIssue=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,n=[...r,...i.path||[]],s={...i,path:n},o="",l=a.filter(e=>!!e).slice().reverse();for(let e of l)o=e(s,{data:t,defaultError:o}).message;return{...i,path:n,message:i.message||o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){let n=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,(0,a.getErrorMap)(),i.default].filter(e=>!!e)});e.common.issues.push(n)};class n{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){let a=[];for(let i of r){if("aborted"===i.status)return t.INVALID;"dirty"===i.status&&e.dirty(),a.push(i.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,t){let r=[];for(let e of t)r.push({key:await e.key,value:await e.value});return n.mergeObjectSync(e,r)}static mergeObjectSync(e,r){let a={};for(let i of r){let{key:r,value:n}=i;if("aborted"===r.status||"aborted"===n.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==r.value&&(void 0!==n.value||i.alwaysSet)&&(a[r.value]=n.value)}return{status:e.value,value:a}}}t.ParseStatus=n,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},3911:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2628:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r=t.util||(t.util={})),(t.objectUtil||(t.objectUtil={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{let r=typeof e;switch(r){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":if(Array.isArray(e))return t.ZodParsedType.array;if(null===e)return t.ZodParsedType.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return t.ZodParsedType.promise;if("undefined"!=typeof Map&&e instanceof Map)return t.ZodParsedType.map;if("undefined"!=typeof Set&&e instanceof Set)return t.ZodParsedType.set;if("undefined"!=typeof Date&&e instanceof Date)return t.ZodParsedType.date;return t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},1487:(e,t,r)=>{"use strict";var a=Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;let n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t}(r(354));t.z=n,function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)}(r(354),t),t.default=n},9101:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(2628),i=r(5848);t.default=(e,t)=>{let r;switch(e.code){case i.ZodIssueCode.invalid_type:r=e.received===a.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case i.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,a.util.jsonStringifyReplacer)}`;break;case i.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${a.util.joinValues(e.keys,", ")}`;break;case i.ZodIssueCode.invalid_union:r="Invalid input";break;case i.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${a.util.joinValues(e.options)}`;break;case i.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${a.util.joinValues(e.options)}, received '${e.received}'`;break;case i.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case i.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case i.ZodIssueCode.invalid_date:r="Invalid date";break;case i.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:a.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case i.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case i.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case i.ZodIssueCode.custom:r="Invalid input";break;case i.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case i.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case i.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,a.util.assertNever(e)}return{message:r}}},2653:(e,t,r)=>{"use strict";var a;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.date=t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=void 0;let n=r(8193),s=r(2178),o=r(7671),l=r(2628),u=r(5848);class c{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let d=(e,t)=>{if((0,o.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new u.ZodError(e.common.issues);return this._error=t,this._error}}};function h(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=a?a:t.defaultError}:{message:null!=r?r:t.defaultError},description:i}}class p{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return(0,l.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,l.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new o.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,l.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,o.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,l.getParsedType)(e)},i=this._parseSync({data:e,path:a.path,parent:a});return d(a,i)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,l.getParsedType)(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await ((0,o.isAsync)(a)?a:Promise.resolve(a));return d(r,i)}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),n=()=>a.addIssue({code:u.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(n(),!1)):!!i||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new Y({schema:this,typeName:a.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Q.create(this,this._def)}nullable(){return X.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return R.create(this,this._def)}promise(){return W.create(this,this._def)}or(e){return M.create([this,e],this._def)}and(e){return Z.create(this,e,this._def)}transform(e){return new Y({...h(this._def),schema:this,typeName:a.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ee({...h(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:a.ZodDefault})}brand(){return new ea({typeName:a.ZodBranded,type:this,...h(this._def)})}catch(e){return new et({...h(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:a.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ei.create(this,e)}readonly(){return en.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=p,t.Schema=p,t.ZodSchema=p;let f=/^c[^\s-]{8,}$/i,m=/^[a-z][a-z0-9]*$/,g=/^[0-9A-HJKMNP-TV-Z]{26}$/,y=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,v=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,b=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,_=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,w=e=>e.precision?e.offset?RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class x extends p{_parse(e){let t;this._def.coerce&&(e.data=String(e.data));let r=this._getType(e);if(r!==l.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.string,received:t.parsedType}),o.INVALID}let a=new o.ParseStatus;for(let r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),a.dirty());else if("max"===r.kind)e.data.length>r.value&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),a.dirty());else if("length"===r.kind){let i=e.data.length>r.value,n=e.data.length<r.value;(i||n)&&(t=this._getOrReturnCtx(e,t),i?(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):n&&(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),a.dirty())}else if("email"===r.kind)v.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"email",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("emoji"===r.kind)i||(i=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),i.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"emoji",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("uuid"===r.kind)y.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"uuid",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("cuid"===r.kind)f.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"cuid",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("cuid2"===r.kind)m.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"cuid2",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("ulid"===r.kind)g.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"ulid",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(i){t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"url",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;let i=r.regex.test(e.data);i||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"regex",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),a.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_string,validation:{startsWith:r.value},message:r.message}),a.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_string,validation:{endsWith:r.value},message:r.message}),a.dirty());else if("datetime"===r.kind){let i=w(r);i.test(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_string,validation:"datetime",message:r.message}),a.dirty())}else if("ip"===r.kind){var n,s;n=e.data,("v4"===(s=r.version)||!s)&&b.test(n)||("v6"===s||!s)&&_.test(n)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{validation:"ip",code:u.ZodIssueCode.invalid_string,message:r.message}),a.dirty())}else l.util.assertNever(r);return{status:a.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:u.ZodIssueCode.invalid_string,...s.errorUtil.errToObj(r)})}_addCheck(e){return new x({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...s.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...s.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...s.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...s.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...s.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...s.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...s.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...s.errorUtil.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...s.errorUtil.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...s.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...s.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...s.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...s.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...s.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...s.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...s.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,s.errorUtil.errToObj(e))}trim(){return new x({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new x({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new x({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodString=x,x.create=e=>{var t;return new x({checks:[],typeName:a.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...h(e)})};class P extends p{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;this._def.coerce&&(e.data=Number(e.data));let r=this._getType(e);if(r!==l.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.number,received:t.parsedType}),o.INVALID}let a=new o.ParseStatus;for(let r of this._def.checks)if("int"===r.kind)l.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:r.message}),a.dirty());else if("min"===r.kind){let i=r.inclusive?e.data<r.value:e.data<=r.value;i&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else if("max"===r.kind){let i=r.inclusive?e.data>r.value:e.data>=r.value;i&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else"multipleOf"===r.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a,n=parseInt(e.toFixed(i).replace(".","")),s=parseInt(t.toFixed(i).replace(".",""));return n%s/Math.pow(10,i)}(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.not_finite,message:r.message}),a.dirty()):l.util.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.errorUtil.toString(t))}setLimit(e,t,r,a){return new P({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.errorUtil.toString(a)}]})}_addCheck(e){return new P({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:s.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:s.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:s.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:s.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:s.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:s.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:s.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:s.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&l.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=P,P.create=e=>new P({checks:[],typeName:a.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...h(e)});class O extends p{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;this._def.coerce&&(e.data=BigInt(e.data));let r=this._getType(e);if(r!==l.ZodParsedType.bigint){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.bigint,received:t.parsedType}),o.INVALID}let a=new o.ParseStatus;for(let r of this._def.checks)if("min"===r.kind){let i=r.inclusive?e.data<r.value:e.data<=r.value;i&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else if("max"===r.kind){let i=r.inclusive?e.data>r.value:e.data>=r.value;i&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):l.util.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.errorUtil.toString(t))}setLimit(e,t,r,a){return new O({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.errorUtil.toString(a)}]})}_addCheck(e){return new O({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:s.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:s.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:s.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:s.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=O,O.create=e=>{var t;return new O({checks:[],typeName:a.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...h(e)})};class T extends p{_parse(e){this._def.coerce&&(e.data=!!e.data);let t=this._getType(e);if(t!==l.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.boolean,received:t.parsedType}),o.INVALID}return(0,o.OK)(e.data)}}t.ZodBoolean=T,T.create=e=>new T({typeName:a.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...h(e)});class S extends p{_parse(e){let t;this._def.coerce&&(e.data=new Date(e.data));let r=this._getType(e);if(r!==l.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.date,received:t.parsedType}),o.INVALID}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_date}),o.INVALID}let a=new o.ParseStatus;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),a.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(t=this._getOrReturnCtx(e,t),(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),a.dirty()):l.util.assertNever(r);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new S({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:s.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:s.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=S,S.create=e=>new S({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:a.ZodDate,...h(e)});class E extends p{_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.symbol,received:t.parsedType}),o.INVALID}return(0,o.OK)(e.data)}}t.ZodSymbol=E,E.create=e=>new E({typeName:a.ZodSymbol,...h(e)});class k extends p{_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.undefined,received:t.parsedType}),o.INVALID}return(0,o.OK)(e.data)}}t.ZodUndefined=k,k.create=e=>new k({typeName:a.ZodUndefined,...h(e)});class A extends p{_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.null,received:t.parsedType}),o.INVALID}return(0,o.OK)(e.data)}}t.ZodNull=A,A.create=e=>new A({typeName:a.ZodNull,...h(e)});class I extends p{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,o.OK)(e.data)}}t.ZodAny=I,I.create=e=>new I({typeName:a.ZodAny,...h(e)});class C extends p{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,o.OK)(e.data)}}t.ZodUnknown=C,C.create=e=>new C({typeName:a.ZodUnknown,...h(e)});class j extends p{_parse(e){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.never,received:t.parsedType}),o.INVALID}}t.ZodNever=j,j.create=e=>new j({typeName:a.ZodNever,...h(e)});class N extends p{_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.void,received:t.parsedType}),o.INVALID}return(0,o.OK)(e.data)}}t.ZodVoid=N,N.create=e=>new N({typeName:a.ZodVoid,...h(e)});class R extends p{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==l.ZodParsedType.array)return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.array,received:t.parsedType}),o.INVALID;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&((0,o.addIssueToContext)(t,{code:e?u.ZodIssueCode.too_big:u.ZodIssueCode.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&((0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&((0,o.addIssueToContext)(t,{code:u.ZodIssueCode.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new c(t,e,t.path,r)))).then(e=>o.ParseStatus.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new c(t,e,t.path,r)));return o.ParseStatus.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new R({...this._def,minLength:{value:e,message:s.errorUtil.toString(t)}})}max(e,t){return new R({...this._def,maxLength:{value:e,message:s.errorUtil.toString(t)}})}length(e,t){return new R({...this._def,exactLength:{value:e,message:s.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}t.ZodArray=R,R.create=(e,t)=>new R({type:e,minLength:null,maxLength:null,exactLength:null,typeName:a.ZodArray,...h(t)});class L extends p{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=l.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.object,received:t.parsedType}),o.INVALID}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof j&&"strip"===this._def.unknownKeys))for(let e in a.data)n.includes(e)||s.push(e);let d=[];for(let e of n){let t=i[e],r=a.data[e];d.push({key:{status:"valid",value:e},value:t._parse(new c(a,r,a.path,e)),alwaysSet:e in a.data})}if(this._def.catchall instanceof j){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)d.push({key:{status:"valid",value:e},value:{status:"valid",value:a.data[e]}});else if("strict"===e)s.length>0&&((0,o.addIssueToContext)(a,{code:u.ZodIssueCode.unrecognized_keys,keys:s}),r.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let r=a.data[t];d.push({key:{status:"valid",value:t},value:e._parse(new c(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of d){let r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>o.ParseStatus.mergeObjectSync(r,e)):o.ParseStatus.mergeObjectSync(r,d)}get shape(){return this._def.shape()}strict(e){return s.errorUtil.errToObj,new L({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,i,n,o;let l=null!==(n=null===(i=(a=this._def).errorMap)||void 0===i?void 0:i.call(a,t,r).message)&&void 0!==n?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=s.errorUtil.errToObj(e).message)&&void 0!==o?o:l}:{message:l}}}:{}})}strip(){return new L({...this._def,unknownKeys:"strip"})}passthrough(){return new L({...this._def,unknownKeys:"passthrough"})}extend(e){return new L({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){let t=new L({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:a.ZodObject});return t}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new L({...this._def,catchall:e})}pick(e){let t={};return l.util.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new L({...this._def,shape:()=>t})}omit(e){let t={};return l.util.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new L({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof L){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=Q.create(e(i))}return new L({...t._def,shape:()=>r})}return t instanceof R?new R({...t._def,type:e(t.element)}):t instanceof Q?Q.create(e(t.unwrap())):t instanceof X?X.create(e(t.unwrap())):t instanceof U?U.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return l.util.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new L({...this._def,shape:()=>t})}required(e){let t={};return l.util.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r],a=e;for(;a instanceof Q;)a=a._def.innerType;t[r]=a}}),new L({...this._def,shape:()=>t})}keyof(){return H(l.util.objectKeys(this.shape))}}t.ZodObject=L,L.create=(e,t)=>new L({shape:()=>e,unknownKeys:"strip",catchall:j.create(),typeName:a.ZodObject,...h(t)}),L.strictCreate=(e,t)=>new L({shape:()=>e,unknownKeys:"strict",catchall:j.create(),typeName:a.ZodObject,...h(t)}),L.lazycreate=(e,t)=>new L({shape:e,unknownKeys:"strip",catchall:j.create(),typeName:a.ZodObject,...h(t)});class M extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new u.ZodError(e.ctx.common.issues));return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_union,unionErrors:r}),o.INVALID});{let e;let a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new u.ZodError(e));return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_union,unionErrors:i}),o.INVALID}}get options(){return this._def.options}}t.ZodUnion=M,M.create=(e,t)=>new M({options:e,typeName:a.ZodUnion,...h(t)});let D=e=>{if(e instanceof F)return D(e.schema);if(e instanceof Y)return D(e.innerType());if(e instanceof q)return[e.value];if(e instanceof G)return e.options;if(e instanceof J)return Object.keys(e.enum);if(e instanceof ee)return D(e._def.innerType);if(e instanceof k)return[void 0];else if(e instanceof A)return[null];else return null};class $ extends p{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.ZodParsedType.object)return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.object,received:t.parsedType}),o.INVALID;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):((0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),o.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=D(r.shape[e]);if(!t)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of t){if(i.has(a))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,r)}}return new $({typeName:a.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...h(r)})}}t.ZodDiscriminatedUnion=$;class Z extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if((0,o.isAborted)(e)||(0,o.isAborted)(a))return o.INVALID;let i=function e(t,r){let a=(0,l.getParsedType)(t),i=(0,l.getParsedType)(r);if(t===r)return{valid:!0,data:t};if(a===l.ZodParsedType.object&&i===l.ZodParsedType.object){let a=l.util.objectKeys(r),i=l.util.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of i){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};n[a]=i.data}return{valid:!0,data:n}}if(a===l.ZodParsedType.array&&i===l.ZodParsedType.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let n=t[i],s=r[i],o=e(n,s);if(!o.valid)return{valid:!1};a.push(o.data)}return{valid:!0,data:a}}return a===l.ZodParsedType.date&&i===l.ZodParsedType.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return i.valid?(((0,o.isDirty)(e)||(0,o.isDirty)(a))&&t.dirty(),{status:t.value,value:i.data}):((0,o.addIssueToContext)(r,{code:u.ZodIssueCode.invalid_intersection_types}),o.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=Z,Z.create=(e,t,r)=>new Z({left:e,right:t,typeName:a.ZodIntersection,...h(r)});class U extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.ZodParsedType.array)return(0,o.addIssueToContext)(r,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.array,received:r.parsedType}),o.INVALID;if(r.data.length<this._def.items.length)return(0,o.addIssueToContext)(r,{code:u.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),o.INVALID;let a=this._def.rest;!a&&r.data.length>this._def.items.length&&((0,o.addIssueToContext)(r,{code:u.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new c(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>o.ParseStatus.mergeArray(t,e)):o.ParseStatus.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new U({...this._def,rest:e})}}t.ZodTuple=U,U.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new U({items:e,typeName:a.ZodTuple,rest:null,...h(t)})};class B extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.ZodParsedType.object)return(0,o.addIssueToContext)(r,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.object,received:r.parsedType}),o.INVALID;let a=[],i=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new c(r,e,r.path,e)),value:n._parse(new c(r,r.data[e],r.path,e))});return r.common.async?o.ParseStatus.mergeObjectAsync(t,a):o.ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new B(t instanceof p?{keyType:e,valueType:t,typeName:a.ZodRecord,...h(r)}:{keyType:x.create(),valueType:e,typeName:a.ZodRecord,...h(t)})}}t.ZodRecord=B;class V extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.ZodParsedType.map)return(0,o.addIssueToContext)(r,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.map,received:r.parsedType}),o.INVALID;let a=this._def.keyType,i=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new c(r,e,r.path,[n,"key"])),value:i._parse(new c(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return o.INVALID;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return o.INVALID;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}t.ZodMap=V,V.create=(e,t,r)=>new V({valueType:t,keyType:e,typeName:a.ZodMap,...h(r)});class K extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.ZodParsedType.set)return(0,o.addIssueToContext)(r,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.set,received:r.parsedType}),o.INVALID;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&((0,o.addIssueToContext)(r,{code:u.ZodIssueCode.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&((0,o.addIssueToContext)(r,{code:u.ZodIssueCode.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return o.INVALID;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>i._parse(new c(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>n(e)):n(s)}min(e,t){return new K({...this._def,minSize:{value:e,message:s.errorUtil.toString(t)}})}max(e,t){return new K({...this._def,maxSize:{value:e,message:s.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=K,K.create=(e,t)=>new K({valueType:e,minSize:null,maxSize:null,typeName:a.ZodSet,...h(t)});class z extends p{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.ZodParsedType.function)return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.function,received:t.parsedType}),o.INVALID;function r(e,r){return(0,o.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter(e=>!!e),issueData:{code:u.ZodIssueCode.invalid_arguments,argumentsError:r}})}function a(e,r){return(0,o.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter(e=>!!e),issueData:{code:u.ZodIssueCode.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof W){let e=this;return(0,o.OK)(async function(...t){let n=new u.ZodError([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw n.addIssue(r(t,e)),n}),l=await Reflect.apply(s,this,o),c=await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw n.addIssue(a(l,e)),n});return c})}{let e=this;return(0,o.OK)(function(...t){let n=e._def.args.safeParse(t,i);if(!n.success)throw new u.ZodError([r(t,n.error)]);let o=Reflect.apply(s,this,n.data),l=e._def.returns.safeParse(o,i);if(!l.success)throw new u.ZodError([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new z({...this._def,args:U.create(e).rest(C.create())})}returns(e){return new z({...this._def,returns:e})}implement(e){let t=this.parse(e);return t}strictImplement(e){let t=this.parse(e);return t}static create(e,t,r){return new z({args:e||U.create([]).rest(C.create()),returns:t||C.create(),typeName:a.ZodFunction,...h(r)})}}t.ZodFunction=z;class F extends p{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.getter();return r._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=F,F.create=(e,t)=>new F({getter:e,typeName:a.ZodLazy,...h(t)});class q extends p{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{received:t.data,code:u.ZodIssueCode.invalid_literal,expected:this._def.value}),o.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function H(e,t){return new G({values:e,typeName:a.ZodEnum,...h(t)})}t.ZodLiteral=q,q.create=(e,t)=>new q({value:e,typeName:a.ZodLiteral,...h(t)});class G extends p{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,o.addIssueToContext)(t,{expected:l.util.joinValues(r),received:t.parsedType,code:u.ZodIssueCode.invalid_type}),o.INVALID}if(-1===this._def.values.indexOf(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,o.addIssueToContext)(t,{received:t.data,code:u.ZodIssueCode.invalid_enum_value,options:r}),o.INVALID}return(0,o.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return G.create(e)}exclude(e){return G.create(this.options.filter(t=>!e.includes(t)))}}t.ZodEnum=G,G.create=H;class J extends p{_parse(e){let t=l.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==l.ZodParsedType.string&&r.parsedType!==l.ZodParsedType.number){let e=l.util.objectValues(t);return(0,o.addIssueToContext)(r,{expected:l.util.joinValues(e),received:r.parsedType,code:u.ZodIssueCode.invalid_type}),o.INVALID}if(-1===t.indexOf(e.data)){let e=l.util.objectValues(t);return(0,o.addIssueToContext)(r,{received:r.data,code:u.ZodIssueCode.invalid_enum_value,options:e}),o.INVALID}return(0,o.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=J,J.create=(e,t)=>new J({values:e,typeName:a.ZodNativeEnum,...h(t)});class W extends p{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.ZodParsedType.promise&&!1===t.common.async)return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.promise,received:t.parsedType}),o.INVALID;let r=t.parsedType===l.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,o.OK)(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t.ZodPromise=W,W.create=(e,t)=>new W({type:e,typeName:a.ZodPromise,...h(t)});class Y extends p{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===a.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{(0,o.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(r.data,i);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r})):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?o.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?o.INVALID:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>(0,o.isValid)(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,o.isValid)(e))return e;let n=a.transform(e.value,i);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}l.util.assertNever(a)}}t.ZodEffects=Y,t.ZodTransformer=Y,Y.create=(e,t,r)=>new Y({schema:e,typeName:a.ZodEffects,effect:t,...h(r)}),Y.createWithPreprocess=(e,t,r)=>new Y({schema:t,effect:{type:"preprocess",transform:e},typeName:a.ZodEffects,...h(r)});class Q extends p{_parse(e){let t=this._getType(e);return t===l.ZodParsedType.undefined?(0,o.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=Q,Q.create=(e,t)=>new Q({innerType:e,typeName:a.ZodOptional,...h(t)});class X extends p{_parse(e){let t=this._getType(e);return t===l.ZodParsedType.null?(0,o.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=X,X.create=(e,t)=>new X({innerType:e,typeName:a.ZodNullable,...h(t)});class ee extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===l.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=ee,ee.create=(e,t)=>new ee({innerType:e,typeName:a.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...h(t)});class et extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,o.isAsync)(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new u.ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new u.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=et,et.create=(e,t)=>new et({innerType:e,typeName:a.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...h(t)});class er extends p{_parse(e){let t=this._getType(e);if(t!==l.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,o.addIssueToContext)(t,{code:u.ZodIssueCode.invalid_type,expected:l.ZodParsedType.nan,received:t.parsedType}),o.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=er,er.create=e=>new er({typeName:a.ZodNaN,...h(e)}),t.BRAND=Symbol("zod_brand");class ea extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ea;class ei extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){let e=async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o.INVALID:"dirty"===e.status?(t.dirty(),(0,o.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})};return e()}{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ei({in:e,out:t,typeName:a.ZodPipeline})}}t.ZodPipeline=ei;class en extends p{_parse(e){let t=this._def.innerType._parse(e);return(0,o.isValid)(t)&&(t.value=Object.freeze(t.value)),t}}t.ZodReadonly=en,en.create=(e,t)=>new en({innerType:e,typeName:a.ZodReadonly,...h(t)}),t.custom=(e,t={},r)=>e?I.create().superRefine((a,i)=>{var n,s;if(!e(a)){let e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(s=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;i.addIssue({code:"custom",...l,fatal:o})}}):I.create(),t.late={object:L.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(a=t.ZodFirstPartyTypeKind||(t.ZodFirstPartyTypeKind={})),t.instanceof=(e,r={message:`Input not instance of ${e.name}`})=>(0,t.custom)(t=>t instanceof e,r);let es=x.create;t.string=es;let eo=P.create;t.number=eo;let el=er.create;t.nan=el;let eu=O.create;t.bigint=eu;let ec=T.create;t.boolean=ec;let ed=S.create;t.date=ed;let eh=E.create;t.symbol=eh;let ep=k.create;t.undefined=ep;let ef=A.create;t.null=ef;let em=I.create;t.any=em;let eg=C.create;t.unknown=eg;let ey=j.create;t.never=ey;let ev=N.create;t.void=ev;let eb=R.create;t.array=eb;let e_=L.create;t.object=e_;let ew=L.strictCreate;t.strictObject=ew;let ex=M.create;t.union=ex;let eP=$.create;t.discriminatedUnion=eP;let eO=Z.create;t.intersection=eO;let eT=U.create;t.tuple=eT;let eS=B.create;t.record=eS;let eE=V.create;t.map=eE;let ek=K.create;t.set=ek;let eA=z.create;t.function=eA;let eI=F.create;t.lazy=eI;let eC=q.create;t.literal=eC;let ej=G.create;t.enum=ej;let eN=J.create;t.nativeEnum=eN;let eR=W.create;t.promise=eR;let eL=Y.create;t.effect=eL,t.transformer=eL;let eM=Q.create;t.optional=eM;let eD=X.create;t.nullable=eD;let e$=Y.createWithPreprocess;t.preprocess=e$;let eZ=ei.create;t.pipeline=eZ,t.ostring=()=>es().optional(),t.onumber=()=>eo().optional(),t.oboolean=()=>ec().optional(),t.coerce={string:e=>x.create({...e,coerce:!0}),number:e=>P.create({...e,coerce:!0}),boolean:e=>T.create({...e,coerce:!0}),bigint:e=>O.create({...e,coerce:!0}),date:e=>S.create({...e,coerce:!0})},t.NEVER=o.INVALID},5430:(e,t,r)=>{"use strict";r.r(t),r.d(t,{actionAsyncStorage:()=>i});var a=r(8791);let i=(0,a.P)()},8791:(e,t,r)=>{"use strict";r.d(t,{P:()=>s});let a=Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available");class i{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}}let n=globalThis.AsyncLocalStorage;function s(){return n?new n:new i}},533:(e,t,r)=>{"use strict";r.r(t),r.d(t,{requestAsyncStorage:()=>i});var a=r(8791);let i=(0,a.P)()},5948:(e,t,r)=>{"use strict";r.r(t),r.d(t,{staticGenerationAsyncStorage:()=>i});var a=r(8791);let i=(0,a.P)()},723:(e,t,r)=>{"use strict";r.d(t,{wn:()=>i}),((e,t=21)=>(r=t)=>{let a="",i=r;for(;i--;)a+=e[Math.random()*e.length|0];return a})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);var a={text:0,function_call:1,data:2};Symbol("internal_openai_fn_messages");var i=class extends Response{constructor(e,t,r){let a=e;r&&(a=e.pipeThrough(r.stream)),super(a,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":r?"true":"false",...null==t?void 0:t.headers}})}};new TextDecoder("utf-8")},8498:(e,t,r)=>{"use strict";r.d(t,{j0:()=>a.j}),r(7024),r(2194),r(1064),r(5391),r(9884),r(7361),r(1335);var a=r(2360);r(173),r(2970),r(5027),r(7328),r(6260),r(3193)},6311:(e,t,r)=>{"use strict";r.d(t,{z:()=>a.ChatOpenAI});var a=r(9337)},7024:(e,t,r)=>{"use strict";r.d(t,{Py:()=>o,lf:()=>s});var a=r(2345);class i extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class n extends a.i{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw Error("Not implemented")}returnStoppedResponse(e,t,r,a){if("force"===e)return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw Error(`Invalid stopping method: ${e}`)}async prepareForOutput(e,t){return{}}}class s extends n{_agentActionType(){return"single"}}class o extends s{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter(e=>"agent_scratchpad"!==e)}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this._allowedTools=e.allowedTools,this.outputParser=e.outputParser}static getDefaultOutputParser(e){throw Error("Not implemented")}static createPrompt(e,t){throw Error("Not implemented")}static fromLLMAndTools(e,t,r){throw Error("Not implemented")}static validateTools(e){}_stop(){return[`
${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}async constructScratchPad(e){return e.reduce((e,{action:t,observation:r})=>e+[t.log,`${this.observationPrefix()}${r}`,this.llmPrefix()].join("\n"),"")}async _plan(e,t,r,a){let i=await this.constructScratchPad(e),n={...t,agent_scratchpad:r?`${i}${r}`:i};0!==this._stop().length&&(n.stop=this._stop());let s=await this.llmChain.predict(n,a);if(!this.outputParser)throw Error("Output parser not set");return this.outputParser.parse(s,a)}plan(e,t,r){return this._plan(e,t,void 0,r)}async returnStoppedResponse(e,t,r,a){if("force"===e)return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if("generate"===e)try{let e=await this._plan(t,r,"\n\nI now need to return a final answer based on the previous steps:",a);if("returnValues"in e)return e;return{returnValues:{output:e.log},log:e.log}}catch(e){if(!(e instanceof i))throw e;return{returnValues:{output:e.output},log:e.output}}throw Error(`Invalid stopping method: ${e}`)}static async deserialize(e){if("zero-shot-react-description"===e._type){let{ZeroShotAgent:t}=await Promise.resolve().then(r.bind(r,173));return t.deserialize(e)}throw Error("Unknown agent type")}}},1064:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(8039),i=r(8534),n=r(7024),s=r(5391),o=r(4072);class l extends n.Py{static lc_name(){return"ChatAgent"}constructor(e){let t=e?.outputParser??l.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}_agentType(){return"chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){let t=e.find(e=>!e.description);if(t){let e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw Error(e)}}static getDefaultOutputParser(e){return new s.x}async constructScratchPad(e){let t=await super.constructScratchPad(e);return t?`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):
${t}`:t}static createPrompt(e,t){let{prefix:r=o.Bq,suffix:a=o.NS,humanMessageTemplate:n="{input}\n\n{agent_scratchpad}"}=t??{},s=e.map(e=>`${e.name}: ${e.description}`).join("\n"),l=[r,s,o.cQ,a].join("\n\n"),u=[i.ov.fromTemplate(l),i.kq.fromTemplate(n)];return i.ks.fromMessages(u)}static fromLLMAndTools(e,t,r){l.validateTools(t);let i=l.createPrompt(t,r),n=new a.LLMChain({prompt:i,llm:e,callbacks:r?.callbacks??r?.callbackManager}),s=r?.outputParser??l.getDefaultOutputParser();return new l({llmChain:n,outputParser:s,allowedTools:t.map(e=>e.name)})}}},5391:(e,t,r)=>{"use strict";r.d(t,{x:()=>o});var a=r(5027),i=r(4072),n=r(3394);let s="Final Answer:";class o extends a.h{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}async parse(e){if(e.includes(s)||!e.includes('"action":')){let t=e.split(s),r=t[t.length-1].trim();return{returnValues:{output:r},log:e}}let t=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();try{let r=JSON.parse(t.trim());return{tool:r.action,toolInput:r.action_input,log:e}}catch{throw new n.dS(`Unable to parse JSON response from chat agent.

${e}`)}}getFormatInstructions(){return i.cQ}}},4072:(e,t,r)=>{"use strict";r.d(t,{Bq:()=>a,NS:()=>n,cQ:()=>i});let a="Answer the following questions as best you can. You have access to the following tools:",i=`The way you use the tools is by specifying a json blob, denoted below by $JSON_BLOB
Specifically, this $JSON_BLOB should have a "action" key (with the name of the tool to use) and a "action_input" key (with the input to the tool going here). 
The $JSON_BLOB should only contain a SINGLE action, do NOT return a list of multiple actions. Here is an example of a valid $JSON_BLOB:

\`\`\`
{{
  "action": "calculator",
  "action_input": "1 + 2"
}}
\`\`\`

ALWAYS use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action: 
\`\`\`
$JSON_BLOB
\`\`\`
Observation: the result of the action
... (this Thought/Action/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,n="Begin! Reminder to always use the exact characters `Final Answer` when responding."},9884:(e,t,r)=>{"use strict";r.d(t,{x:()=>c});var a=r(8039),i=r(8534),n=r(223),s=r(6899),o=r(7024),l=r(7361),u=r(1077);class c extends o.Py{static lc_name(){return"ChatConversationalAgent"}constructor(e){let t=e.outputParser??c.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]})}_agentType(){return"chat-conversational-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){let t=e.find(e=>!e.description);if(t){let e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw Error(e)}}async constructScratchPad(e){let t=[];for(let r of e)t.push(new s.gY(r.action.log)),t.push(new s.xk((0,n.SM)(u.Fg,"f-string",{observation:r.observation})));return t}static getDefaultOutputParser(e){return e?.llm?l.u.fromLLM(e.llm,{toolNames:e.toolNames}):new l.u({toolNames:e?.toolNames})}static createPrompt(e,t){let r=(t?.systemMessage??u.KV)+u.J5,a=t?.humanMessage??u.mP,s=e.map(e=>`${e.name}: ${e.description}`).join("\n"),o=e.map(e=>e.name),l=t?.outputParser??c.getDefaultOutputParser({toolNames:o}),d=l.getFormatInstructions({toolNames:o}),h=(0,n.SM)(a,"f-string",{format_instructions:d,tools:s}),p=[i.ov.fromTemplate(r),new i.ax("chat_history"),i.kq.fromTemplate(h),new i.ax("agent_scratchpad")];return i.ks.fromMessages(p)}static fromLLMAndTools(e,t,r){c.validateTools(t);let i=r?.outputParser??c.getDefaultOutputParser({llm:e,toolNames:t.map(e=>e.name)}),n=c.createPrompt(t,{...r,outputParser:i}),s=new a.LLMChain({prompt:n,llm:e,callbacks:r?.callbacks??r?.callbackManager});return new c({llmChain:s,outputParser:i,allowedTools:t.map(e=>e.name)})}}},7361:(e,t,r)=>{"use strict";r.d(t,{u:()=>u});var a=r(3394),i=r(223),n=r(5027),s=r(1077),o=r(9644);class l extends n.h{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){let t=e.trim();if(t.includes("```json")||t.includes("```")){let e=t.includes("```json")?"```json":"```",r=t.indexOf(e),a=t.indexOf("action_input");if(a>r){t=t.slice(r+e.length).trimStart();let a=t.lastIndexOf("```");-1!==a&&(t=t.slice(0,a).trimEnd())}}try{let r=JSON.parse(t),{action:a,action_input:i}=r;if("Final Answer"===a)return{returnValues:{output:i},log:e};return{tool:a,toolInput:i,log:e}}catch(t){throw new a.dS(`Failed to parse. Text: "${e}". Error: ${t}`)}}getFormatInstructions(){return(0,i.SM)(s.cQ,"f-string",{tool_names:this.toolNames.join(", ")})}}class u extends n.h{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=e?.baseParser??new l({toolNames:this.toolNames}),this.outputFixingParser=e?.outputFixingParser}getFormatInstructions(e){return e.raw?s.cQ:(0,i.SM)(s.cQ,"f-string",{tool_names:e.toolNames.join(", ")})}async parse(e){return void 0!==this.outputFixingParser?this.outputFixingParser.parse(e):this.baseParser.parse(e)}static fromLLM(e,t){let r=t.baseParser??new l({toolNames:t.toolNames??[]}),a=o.D.fromLLM(e,r);return new u({baseParser:r,outputFixingParser:a,toolNames:t.toolNames})}}},1077:(e,t,r)=>{"use strict";r.d(t,{Fg:()=>o,J5:()=>i,KV:()=>a,cQ:()=>n,mP:()=>s});let a=`Assistant is a large language model trained by OpenAI.

Assistant is designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, Assistant is able to generate human-like text based on the input it receives, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.

Assistant is constantly learning and improving, and its capabilities are constantly evolving. It is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.

Overall, Assistant is a powerful system that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether you need help with a specific question or just want to have a conversation about a particular topic, Assistant is here to assist.`,i=" However, above all else, all responses must adhere to the format of RESPONSE FORMAT INSTRUCTIONS.",n=`RESPONSE FORMAT INSTRUCTIONS
----------------------------

Output a JSON markdown code snippet containing a valid JSON object in one of two formats:

**Option 1:**
Use this if you want the human to use a tool.
Markdown code snippet formatted in the following schema:

\`\`\`json
{{{{
    "action": string, // The action to take. Must be one of [{tool_names}]
    "action_input": string // The input to the action. May be a stringified object.
}}}}
\`\`\`

**Option #2:**
Use this if you want to respond directly and conversationally to the human. Markdown code snippet formatted in the following schema:

\`\`\`json
{{{{
    "action": "Final Answer",
    "action_input": string // You should put what you want to return to use here and make sure to use valid json newline characters.
}}}}
\`\`\`

For both options, remember to always include the surrounding markdown code snippet delimiters (begin with "\`\`\`json" and end with "\`\`\`")!
`,s=`TOOLS
------
Assistant can ask the user to use tools to look up information that may be helpful in answering the users original question. The tools the human can use are:

{tools}

{format_instructions}

USER'S INPUT
--------------------
Here is the user's input (remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else):

{{input}}`,o=`TOOL RESPONSE:
---------------------
{observation}

USER'S INPUT
--------------------

Okay, so what is the response to my last comment? If using information obtained from the tools you must mention it explicitly without mentioning the tool names - I have forgotten all TOOL RESPONSES! Remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else.`},1335:(e,t,r)=>{"use strict";r.d(t,{I:()=>o});var a=r(5095),i=r(3394),n=r(8916);class s extends n.UA{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"_Exception"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Exception tool"})}async _call(e){return e}}class o extends a.l{static lc_name(){return"AgentExecutor"}get lc_namespace(){return["langchain","agents","executor"]}get inputKeys(){return this.agent.inputKeys}get outputKeys(){return this.agent.returnValues}constructor(e){if(super(e),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(this,"earlyStoppingMethod",{enumerable:!0,configurable:!0,writable:!0,value:"force"}),Object.defineProperty(this,"handleParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.agent=e.agent,this.tools=e.tools,this.handleParsingErrors=e.handleParsingErrors??this.handleParsingErrors,"multi"===this.agent._agentActionType()){for(let e of this.tools)if(e.returnDirect)throw Error(`Tool with return direct ${e.name} not supported for multi-action agent.`)}this.returnIntermediateSteps=e.returnIntermediateSteps??this.returnIntermediateSteps,this.maxIterations=e.maxIterations??this.maxIterations,this.earlyStoppingMethod=e.earlyStoppingMethod??this.earlyStoppingMethod}static fromAgentAndTools(e){return new o(e)}shouldContinue(e){return void 0===this.maxIterations||e<this.maxIterations}async _call(e,t){let r=Object.fromEntries(this.tools.map(e=>[e.name.toLowerCase(),e])),a=[],o=0,l=async e=>{let{returnValues:r}=e,i=await this.agent.prepareForOutput(r,a);return this.returnIntermediateSteps?{...r,intermediateSteps:a,...i}:(await t?.handleAgentEnd(e),{...r,...i})};for(;this.shouldContinue(o);){let u,c;try{u=await this.agent.plan(a,e,t?.getChild())}catch(e){if(e instanceof i.dS){let t;let r=e.message;if(!0===this.handleParsingErrors)e.sendToLLM?(t=e.observation,r=e.llmOutput??""):t="Invalid or incomplete response";else if("string"==typeof this.handleParsingErrors)t=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)t=this.handleParsingErrors(e);else throw e;u={tool:"_Exception",toolInput:t,log:r}}else throw e}if("returnValues"in u)return l(u);c=Array.isArray(u)?u:[u];let d=await Promise.all(c.map(async e=>{let a;await t?.handleAgentAction(e);let i="_Exception"===e.tool?new s:r[e.tool?.toLowerCase()];try{a=i?await i.call(e.toolInput,t?.getChild()):`${e.tool} is not a valid tool, try another one.`}catch(e){if(e instanceof n.YE){if(!0===this.handleParsingErrors)a="Invalid or incomplete tool input. Please try again.";else if("string"==typeof this.handleParsingErrors)a=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)a=this.handleParsingErrors(e);else throw e;a=await new s().call(a,t?.getChild())}}return{action:e,observation:a??""}}));a.push(...d);let h=a[a.length-1],p=r[h.action.tool?.toLowerCase()];if(p?.returnDirect)return l({returnValues:{[this.agent.returnValues[0]]:h.observation},log:""});o+=1}let u=await this.agent.returnStoppedResponse(this.earlyStoppingMethod,a,e);return l(u)}_chainType(){return"agent_executor"}serialize(){throw Error("Cannot serialize an AgentExecutor")}}},2360:(e,t,r)=>{"use strict";r.d(t,{j:()=>y});var a=r(7021),i=r(1064),n=r(9884),s=r(7328),o=r(1335),l=r(173),u=r(3193),c=r(8039),d=r(8534),h=r(7024),p=r(3394);let f=`You are a helpful assistant. Help the user answer any questions.

You have access to the following tools:

{tools}

In order to use a tool, you can use <tool></tool> and <tool_input></tool_input> tags.
You will then get back a response in the form <observation></observation>
For example, if you have a tool called 'search' that could run a google search, in order to search for the weather in SF you would respond:

<tool>search</tool><tool_input>weather in SF</tool_input>
<observation>64 degrees</observation>

When you are done, respond with a final answer between <final_answer></final_answer>. For example:

<final_answer>The weather in SF is 64 degrees</final_answer>

Begin!

Question: {question}`;async function m(e){if(e.includes("</tool>")){let[t,r]=e.split("</tool>"),a=t.split("<tool>")[1],i=r.split("<tool_input>")[1];return{tool:a,toolInput:i,log:e}}if(e.includes("<final_answer>")){let[,t]=e.split("<final_answer>");return{returnValues:{output:t},log:e}}throw new p.dS(`Could not parse LLM output: ${e}`)}class g extends h.lf{static lc_name(){return"XMLAgent"}_agentType(){return"xml"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","xml"]}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=e.tools,this.llmChain=e.llmChain}get inputKeys(){return["input"]}static createPrompt(){return d.ks.fromMessages([d.kq.fromTemplate(f),d.gc.fromTemplate("{intermediate_steps}")])}async plan(e,t,r){let a="";for(let{action:t,observation:r}of e)a+=`<tool>${t.tool}</tool><tool_input>${t.toolInput}</tool_input><observation>${r}</observation>`;let i="";for(let e of this.tools)i+=`${e.name}: ${e.description}
`;let n={intermediate_steps:a,tools:i,question:t.input,stop:["</tool_input>","</final_answer>"]},s=await this.llmChain.call(n,r);return m(s[this.llmChain.outputKey])}static fromLLMAndTools(e,t,r){let a=g.createPrompt(),i=new c.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks});return new g({llmChain:i,tools:t})}}async function y(e,t,r={agentType:"base_chat_model"===t._modelType()?"chat-zero-shot-react-description":"zero-shot-react-description"}){switch(r.agentType){case"zero-shot-react-description":{let{agentArgs:a,tags:i,...n}=r;return o.I.fromAgentAndTools({tags:[...i??[],"zero-shot-react-description"],agent:l.ZeroShotAgent.fromLLMAndTools(t,e,a),tools:e,...n})}case"chat-zero-shot-react-description":{let{agentArgs:a,tags:n,...s}=r;return o.I.fromAgentAndTools({tags:[...n??[],"chat-zero-shot-react-description"],agent:i.A.fromLLMAndTools(t,e,a),tools:e,...s})}case"chat-conversational-react-description":{let{agentArgs:i,memory:s,tags:l,...u}=r,c=o.I.fromAgentAndTools({tags:[...l??[],"chat-conversational-react-description"],agent:n.x.fromLLMAndTools(t,e,i),tools:e,memory:s??new a.s({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...u});return c}case"xml":{let{agentArgs:a,tags:i,...n}=r,s=o.I.fromAgentAndTools({tags:[...i??[],"xml"],agent:g.fromLLMAndTools(t,e,a),tools:e,...n});return s}case"structured-chat-zero-shot-react-description":{let{agentArgs:a,memory:i,tags:n,...l}=r,u=o.I.fromAgentAndTools({tags:[...n??[],"structured-chat-zero-shot-react-description"],agent:s.b.fromLLMAndTools(t,e,a),tools:e,memory:i,...l});return u}case"openai-functions":{let{agentArgs:i,memory:n,tags:s,...l}=r,c=o.I.fromAgentAndTools({tags:[...s??[],"openai-functions"],agent:u.q.fromLLMAndTools(t,e,i),tools:e,memory:n??new a.s({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...l});return c}default:throw Error("Unknown agent type")}}},173:(e,t,r)=>{"use strict";r.d(t,{ZeroShotAgent:()=>c});var a=r(8039),i=r(8880),n=r(223),s=r(7024);let o=async(e,t,r,i,n)=>{if(r.load_from_llm_and_tools){if(!e)throw Error("Loading from llm and tools, llm must be provided.");if(!t)throw Error("Loading from llm and tools, tools must be provided.");return i(e,t,r)}if(!r.llm_chain)throw Error("Loading from constructor, llm_chain must be provided.");let s=await a.LLMChain.deserialize(r.llm_chain);return n({...r,llmChain:s})};var l=r(2970),u=r(1868);class c extends s.Py{static lc_name(){return"ZeroShotAgent"}constructor(e){let t=e?.outputParser??c.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(e){return new l.S(e)}static validateTools(e){let t=e.find(e=>!e.description);if(t){let e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw Error(e)}}static createPrompt(e,t){let{prefix:r=u.Bq,suffix:a=u.NS,inputVariables:s=["input","agent_scratchpad"]}=t??{},o=e.map(e=>`${e.name}: ${e.description}`).join("\n"),l=e.map(e=>e.name),c=(0,n.SM)(u.cQ,"f-string",{tool_names:l}),d=[r,o,c,a].join("\n\n");return new i.PromptTemplate({template:d,inputVariables:s})}static fromLLMAndTools(e,t,r){c.validateTools(t);let i=c.createPrompt(t,r),n=r?.outputParser??c.getDefaultOutputParser(),s=new a.LLMChain({prompt:i,llm:e,callbacks:r?.callbacks??r?.callbackManager});return new c({llmChain:s,allowedTools:t.map(e=>e.name),outputParser:n})}static async deserialize(e){let{llm:t,tools:r,...a}=e;return o(t,r,a,(e,t,r)=>c.fromLLMAndTools(e,t,{prefix:r.prefix,suffix:r.suffix,inputVariables:r.input_variables}),e=>new c(e))}}},2970:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});var a=r(3394),i=r(5027),n=r(1868);class s extends i.h{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=e?.finishToolName||"Final Answer:"}async parse(e){if(e.includes(this.finishToolName)){let t=e.split(this.finishToolName),r=t[t.length-1].trim();return{returnValues:{output:r},log:e}}let t=/Action:([\s\S]*?)(?:\nAction Input:([\s\S]*?))?$/.exec(e);if(!t)throw new a.dS(`Could not parse LLM output: ${e}`);return{tool:t[1].trim(),toolInput:t[2]?t[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:e}}getFormatInstructions(){return n.cQ}}},1868:(e,t,r)=>{"use strict";r.d(t,{Bq:()=>a,NS:()=>n,cQ:()=>i});let a="Answer the following questions as best you can. You have access to the following tools:",i=`Use the following format in your response:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,n=`Begin!

Question: {input}
Thought:{agent_scratchpad}`},3193:(e,t,r)=>{"use strict";r.d(t,{q:()=>u,m:()=>l});var a=r(6899),i=r(7024),n=r(8534),s=r(8039),o=r(3394);function l(e){return e.flatMap(({action:e,observation:t})=>void 0!==e.messageLog&&void 0!==e.messageLog?e.messageLog?.concat(new a.TN(t,e.tool)):[new a.gY(e.log)])}class u extends i.Py{static lc_name(){return"OpenAIAgent"}_agentType(){return"openai-functions"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}constructor(e){super({...e,outputParser:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=e.tools}static createPrompt(e,t){let{prefix:r="You are a helpful AI assistant."}=t||{};return n.ks.fromMessages([n.ov.fromTemplate(r),new n.ax("chat_history"),n.kq.fromTemplate("{input}"),new n.ax("agent_scratchpad")])}static fromLLMAndTools(e,t,r){if(u.validateTools(t),"base_chat_model"!==e._modelType()||"openai"!==e._llmType())throw Error("OpenAIAgent requires an OpenAI chat model");let a=u.createPrompt(t,r),i=new s.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks});return new u({llmChain:i,allowedTools:t.map(e=>e.name),tools:t})}async constructScratchPad(e){return l(e)}async plan(e,t,r){let a=await this.constructScratchPad(e),i={...t,agent_scratchpad:a};0!==this._stop().length&&(i.stop=this._stop());let n=this.llmChain.llm,s={...i},l={tools:this.tools};for(let e of this.llmChain.llm.callKeys)e in t&&(l[e]=t[e],delete s[e]);let u=await this.llmChain.prompt.formatPromptValue(s),c=await n.predictMessages(u.toChatMessages(),l,r);return function(e){if(!e.additional_kwargs.function_call)return{returnValues:{output:e.content},log:e.content};{let t=e.additional_kwargs.function_call;try{let r=t.arguments?JSON.parse(t.arguments):{};return{tool:t.name,toolInput:r,log:`Invoking "${t.name}" with ${t.arguments??"{}"}
${e.content}`,messageLog:[e]}}catch(e){throw new o.dS(`Failed to parse function arguments from chat model response. Text: "${t.arguments}". ${e}`)}}}(c)}}},7328:(e,t,r)=>{"use strict";r.d(t,{b:()=>c});var a=r(2552),i=r(8039),n=r(8880),s=r(8534),o=r(7024),l=r(6260),u=r(3230);class c extends o.Py{static lc_name(){return"StructuredChatAgent"}constructor(e){let t=e?.outputParser??c.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]})}_agentType(){return"structured-chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){let t=e.find(e=>!e.description);if(t){let e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw Error(e)}}static getDefaultOutputParser(e){return e?.llm?l.Q.fromLLM(e.llm,{toolNames:e.toolNames}):new l.Q({toolNames:e?.toolNames})}async constructScratchPad(e){let t=await super.constructScratchPad(e);return t?`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):
${t}`:t}static createToolSchemasString(e){return e.map(e=>`${e.name}: ${e.description}, args: ${JSON.stringify((0,a.Y_)(e.schema).properties)}`).join("\n")}static createPrompt(e,t){let{prefix:r=u.Bq,suffix:a=u.NS,inputVariables:i=["input","agent_scratchpad"],memoryPrompts:o=[]}=t??{},l=[r,u.cQ,a].join("\n\n"),d=[new s.ov(new n.PromptTemplate({template:l,inputVariables:i,partialVariables:{tool_schemas:c.createToolSchemasString(e),tool_names:e.map(e=>e.name).join(", ")}})),...o,new s.kq(new n.PromptTemplate({template:"{input}\n\n{agent_scratchpad}",inputVariables:i}))];return s.ks.fromMessages(d)}static fromLLMAndTools(e,t,r){c.validateTools(t);let a=c.createPrompt(t,r),n=r?.outputParser??c.getDefaultOutputParser({llm:e,toolNames:t.map(e=>e.name)}),s=new i.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks});return new c({llmChain:s,outputParser:n,allowedTools:t.map(e=>e.name)})}}},6260:(e,t,r)=>{"use strict";r.d(t,{Q:()=>u});var a=r(5027),i=r(3230),n=r(9644),s=r(3394),o=r(565);class l extends a.h{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){try{let t=/```(?:json)?(.*)(```)/gs.exec(e);if(null===t)throw new s.dS('Could not parse an action. The agent action must be within a markdown code block, and "action" must be a provided tool or "Final Answer"');let r=JSON.parse(t[1].trim()),{action:a,action_input:i}=r;if("Final Answer"===a)return{returnValues:{output:i},log:e};return{tool:a,toolInput:i||{},log:e}}catch(t){throw new s.dS(`Failed to parse. Text: "${e}". Error: ${t}`)}}getFormatInstructions(){return(0,o.SM)(i.Og,"f-string",{tool_names:this.toolNames.join(", ")})}}class u extends a.h{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=e?.baseParser??new l({toolNames:this.toolNames}),this.outputFixingParser=e?.outputFixingParser}async parse(e,t){return void 0!==this.outputFixingParser?this.outputFixingParser.parse(e,t):this.baseParser.parse(e)}getFormatInstructions(){return(0,o.SM)(i.cQ,"f-string",{tool_names:this.toolNames.join(", ")})}static fromLLM(e,t){let r=t.baseParser??new l({toolNames:t.toolNames??[]}),a=n.D.fromLLM(e,r);return new u({baseParser:r,outputFixingParser:a,toolNames:t.toolNames})}}},3230:(e,t,r)=>{"use strict";r.d(t,{Bq:()=>a,NS:()=>s,Og:()=>i,cQ:()=>n});let a="Answer the following questions truthfully and as best you can.",i=`Output a JSON markdown code snippet containing a valid JSON blob (denoted below by $JSON_BLOB).
This $JSON_BLOB must have a "action" key (with the name of the tool to use) and an "action_input" key (tool input).

Valid "action" values: "Final Answer" (which you must use when giving your final response to the user), or one of [{tool_names}].

The $JSON_BLOB must be valid, parseable JSON and only contain a SINGLE action. Here is an example of an acceptable output:

\`\`\`json
{{
  "action": $TOOL_NAME,
  "action_input": $INPUT
}}
\`\`\`

Remember to include the surrounding markdown code snippet delimiters (begin with "\`\`\`" json and close with "\`\`\`")!
`,n=`You have access to the following tools.
You must format your inputs to these tools to match their "JSON schema" definitions below.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Here are the JSON Schema instances for the tools you have access to:

{tool_schemas}

The way you use the tools is as follows:

------------------------

${i}

If you are using a tool, "action_input" must adhere to the tool's input schema, given above.

------------------------

ALWAYS use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action:
\`\`\`json
$JSON_BLOB
\`\`\`
Observation: the result of the action
... (this Thought/Action/Observation can repeat N times)
Thought: I now know the final answer
Action:
\`\`\`json
{{
  "action": "Final Answer",
  "action_input": "Final response to human"
}}
\`\`\``,s="Begin! Reminder to ALWAYS use the above format, and to use tools if appropriate."},2194:(e,t,r)=>{"use strict";r.d(t,{NN:()=>u,D$:()=>n}),r(7406),r(8039),r(173),r(1335);var a=r(7175);r(8308),r(7519),r(6399);var i=r(361);function n(e,t){let r=async({input:t},r)=>{let a=await e.getRelevantDocuments(t,r?.getChild("retriever"));return a.map(e=>e.pageContent).join("\n")},n=i.z.object({input:i.z.string().describe("Natural language query used as input to the retriever")});return new a.X({...t,func:r,schema:n})}r(9696),r(2360);var s=r(8715),o=r(2571),l=r(3193);class u extends o.B{constructor(e){super(e),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:12e3}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"intermediateStepsKey",{enumerable:!0,configurable:!0,writable:!0,value:"intermediateSteps"}),this.humanPrefix=e.humanPrefix??this.humanPrefix,this.aiPrefix=e.aiPrefix??this.aiPrefix,this.llm=e.llm,this.memoryKey=e.memoryKey??this.memoryKey,this.maxTokenLimit=e.maxTokenLimit??this.maxTokenLimit,this.returnMessages=e.returnMessages??this.returnMessages,this.outputKey=e.outputKey??this.outputKey,this.intermediateStepsKey=e.intermediateStepsKey??this.intermediateStepsKey}get memoryKeys(){return[this.memoryKey]}async getMessages(){return this.chatHistory.getMessages()}async loadMemoryVariables(e){let t=await this.getMessages();if(this.returnMessages)return{[this.memoryKey]:t};{let e=(0,s.zs)(t,this.humanPrefix,this.aiPrefix);return{[this.memoryKey]:e}}}async saveContext(e,t){let r=(0,s.d9)(e,this.inputKey),a=(0,s.jG)(t,this.outputKey);await this.chatHistory.addUserMessage(r);let i=(0,l.m)(t[this.intermediateStepsKey]);for(let e of i)await this.chatHistory.addMessage(e);await this.chatHistory.addAIChatMessage(a);let n=await this.chatHistory.getMessages(),o=await this.llm.getNumTokensFromMessages(n);if(o.totalCount>this.maxTokenLimit){let e=[];for(;o.totalCount>this.maxTokenLimit;){let t=n.pop();if(!t){console.warn(`Could not prune enough messages from chat history to stay under ${this.maxTokenLimit} tokens.`);break}e.push(t),o=await this.llm.getNumTokensFromMessages(n)}for(let t of(await this.chatHistory.clear(),e))await this.chatHistory.addMessage(t)}}}},5027:(e,t,r)=>{"use strict";r.d(t,{h:()=>i});var a=r(3394);class i extends a.bI{}},8036:(e,t,r)=>{"use strict";r.d(t,{_i:()=>a}),r(8210);let a=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e},5506:(e,t,r)=>{"use strict";r.d(t,{BD:()=>m,qV:()=>g});var a=r(6899),i=r(64),n=r(8036),s=r(8210),o=r(4978),l=r(260),u=r(8534),c=r(440);let d=(...e)=>c(e.join("_")),h=new Map;class p extends a.H2{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(d(e,t))??null)}async update(e,t,r){this.cache.set(d(e,t),r)}static global(){return new p(h)}}let f=()=>!1;class m extends o.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??f(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class g extends m{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=p.global():this.cache=void 0,this.caller=new i.L(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await (0,s.b)("modelName"in this?(0,n._i)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return"string"==typeof e?new l.nw(e):Array.isArray(e)?new u.GU(e.map(a.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){let t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()},r=Object.entries(t).filter(([e,t])=>void 0!==t),a=r.map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",");return a}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){let{_type:t,_model:a,...i}=e;if(a&&"base_chat_model"!==a)throw Error(`Cannot load LLM with model ${a}`);let n={openai:(await Promise.resolve().then(r.bind(r,9337))).ChatOpenAI}[t];if(void 0===n)throw Error(`Cannot load LLM with type ${t}`);return new n(i)}}},8073:(e,t,r)=>{"use strict";r.d(t,{E:()=>s});var a=r(7873),i=r(2345);class n{}class s extends n{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,i.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||process.env?.LANGCHAIN_CALLBACKS_BACKGROUND!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return i.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return i.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends s{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:a.Z()}),Object.assign(this,e)}}}}},2389:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(8073);function i(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class n extends a.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){if(void 0!==e.parent_run_id){let t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e),await this.onRunCreate?.(e)}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleChatModelStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}async handleChainStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,r,a,n){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=i(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),n?.inputs!==void 0&&(s.inputs=i(n.inputs,"input")),await this.onChainEnd?.(s),await this._endTrace(s),s}async handleChainError(e,t,r,a,n){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.error=e.message,s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),n?.inputs!==void 0&&(s.inputs=i(n.inputs,"input")),await this.onChainError?.(s),await this._endTrace(s),s}async handleToolStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}async handleRetrieverStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,i,n){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:n?.chunk}}),await this.onLLMNewToken?.(s,e),s}}},1788:(e,t,r)=>{"use strict";let a,i,n;r.d(t,{Ye:()=>W,QH:()=>K});var s=r(7873),o=r(8073),l=r(204),u=r(2389);function c(e,t){return`${e.open}${t}${e.close}`}function d(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function h(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:p}=l;class f extends u.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=this.getParents(e).reverse(),r=[...t,e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?c(l.bold,a):a}).join(" > ");return c(p.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.green,"[chain/start]")} [${t}] Entering Chain run with input: ${d(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.cyan,"[chain/end]")} [${t}] [${h(e)}] Exiting Chain run with output: ${d(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.red,"[chain/error]")} [${t}] [${h(e)}] Chain run errored with error: ${d(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${c(p.green,"[llm/start]")} [${t}] Entering LLM run with input: ${d(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.cyan,"[llm/end]")} [${t}] [${h(e)}] Exiting LLM run with output: ${d(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.red,"[llm/error]")} [${t}] [${h(e)}] LLM run errored with error: ${d(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.cyan,"[tool/end]")} [${t}] [${h(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.red,"[tool/error]")} [${t}] [${h(e)}] Tool run errored with error: ${d(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${d(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.cyan,"[retriever/end]")} [${t}] [${h(e)}] Exiting Retriever run with output: ${d(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.red,"[retriever/error]")} [${t}] [${h(e)}] Retriever run errored with error: ${d(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${c(p.blue,"[agent/action]")} [${t}] Agent selected action: ${d(e.actions[e.actions.length-1],"[action]")}`)}}var m=r(1333),g=r(6519);let y=[400,401,403,404,405,406,407,408,409];class v{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t=g.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>m(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status;if(t&&y.includes(+t))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}function b(e){return"function"==typeof e?._getType}function _(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let w=()=>!1,x=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,P=()=>"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),O=()=>"undefined"!=typeof Deno,T=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!O(),S=()=>w()?"browser":T()?"node":x()?"webworker":P()?"jsdom":O()?"deno":"other";async function E(){if(void 0===a){let e=S(),t=function(){if(void 0!==i)return i;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=k(t);void 0!==r&&(e[t]=r)}return i=e,e}();a={library:"langsmith",runtime:e,...t}}return a}function k(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}let A=e=>{let t=e.replace("http://","").replace("https://",""),r=t.split("/")[0].split(":")[0];return"localhost"===r||"127.0.0.1"===r||"::1"===r},I=async(e,t)=>{let r=await e.text();if(!e.ok)throw Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};async function C(e){let t=[];for await(let r of e)t.push(r);return t}function j(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function N(e){return"true"===k("LANGCHAIN_HIDE_INPUTS")?{}:e}function R(e){return"true"===k("LANGCHAIN_HIDE_OUTPUTS")?{}:e}class L{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});let t=L.getDefaultClientConfig();this.apiUrl=j(e.apiUrl??t.apiUrl)??"",this.apiKey=j(e.apiKey??t.apiKey),this.webUrl=j(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new v(e.callerOptions??{})}static getDefaultClientConfig(){let e=k("LANGCHAIN_API_KEY"),t=k("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984");return{apiUrl:t,apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){let e=A(this.apiUrl);if(!e&&!this.apiKey)throw Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:A(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){let r=await this._getResponse(e,t);return r.json()}async *_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,n=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);let s=await n.json();if(0===s.length||(yield s,s.length<a))break;r+=s.length}}async createRun(e){let t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},a=await E(),i=e.project_name;delete e.project_name;let n={session_name:i,...e,extra:{...e.extra,runtime:{...a,...r.runtime}}};n.inputs=N(n.inputs),n.outputs&&(n.outputs=R(n.outputs));let s=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});await I(s,"create run")}async updateRun(e,t){t.inputs&&(t.inputs=N(t.inputs)),t.outputs&&(t.outputs=R(t.outputs));let r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await I(a,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;if(t.session_id)e=t.session_id;else if(r?.projectName)e=(await this.readProject({projectName:r?.projectName})).id;else if(r?.projectId)e=r?.projectId;else{let t=await this.readProject({projectName:k("LANGCHAIN_PROJECT")||"default"});e=t.id}let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await C(this.listRuns({id:e.child_run_ids})),r={},a={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:a,startTime:i,executionOrder:n,runType:s,error:o,id:l,limit:u,offset:c,query:d,filter:h}){let p=new URLSearchParams,f=e;if(t){if(e)throw Error("Only one of projectId or projectName may be given");f=(await this.readProject({projectName:t})).id}if(f&&p.append("session",f),r&&p.append("parent_run",r),a&&p.append("reference_example",a),i&&p.append("start_time",i.toISOString()),n&&p.append("execution_order",n.toString()),s&&p.append("run_type",s),void 0!==o&&p.append("error",o.toString()),void 0!==l)for(let e of l)p.append("id",e);for await(let e of(void 0!==u&&p.append("limit",u.toString()),void 0!==c&&p.append("offset",c.toString()),void 0!==d&&p.append("query",d),void 0!==h&&p.append("filter",h),this._getPaginated("/runs",p)))yield*e}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||s.Z()},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),i=await a.json();if(null===i||!("share_token"in i))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await I(t,"unshare run")}async readRunSharedLink(e){let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);let a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),i=await a.json();return i}async createProject({projectName:e,projectExtra:t,upsert:r,referenceDatasetId:a}){let i=`${this.apiUrl}/sessions${r?"?upsert=true":""}`,n={name:e};void 0!==t&&(n.extra=t),void 0!==a&&(n.reference_dataset_id=a);let s=await this.caller.call(fetch,i,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)}),o=await s.json();if(!s.ok)throw Error(`Failed to create session ${e}: ${s.status} ${s.statusText}`);return o}async readProject({projectId:e,projectName:t}){let r,a="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)a+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this._get(a,i);if(Array.isArray(n)){if(0===n.length)throw Error(`Project[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:n}={}){let s=new URLSearchParams;if(void 0!==e)for(let t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==r&&s.append("name_contains",r),void 0!==a)s.append("reference_dataset",a);else if(void 0!==i){let e=await this.readDataset({datasetName:i});s.append("reference_dataset",e.id)}for await(let e of(void 0!==n&&s.append("reference_free",n.toString()),this._getPaginated("/sessions",s)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e;let a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await I(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:n,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),i&&l.append("description",i),n&&l.append("data_type",n),s&&l.append("name",s);let u=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok){let e=await u.json();if(e.detail&&e.detail.includes("already exists"))throw Error(`Dataset ${t} already exists`);throw Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}let c=await u.json();return c}async createDataset(e,{description:t,dataType:r}={}){let a={name:e,description:t};r&&(a.data_type=r);let i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){let t=await i.json();if(t.detail&&t.detail.includes("already exists"))throw Error(`Dataset ${e} already exists`);throw Error(`Failed to create dataset ${i.status} ${i.statusText}`)}let n=await i.json();return n}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",i=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide datasetName or datasetId");let n=await this._get(a,i);if(Array.isArray(n)){if(0===n.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`),a=await r.text(),i=a.trim().split("\n").map(e=>JSON.parse(e));return i}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i}={}){let n=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)n.append("id",e);for await(let e of(void 0!==a&&n.append("name",a),void 0!==i&&n.append("name_contains",i),this._getPaginated("/datasets",n)))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t){let e=await this.readDataset({datasetName:t});a=e.id}if(void 0!==a)r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:i,exampleId:n}){let s=r;if(void 0===s&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==s&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===s){let e=await this.readDataset({datasetName:a});s=e.id}let o=i||new Date,l={dataset_id:s,inputs:e,outputs:t,created_at:o.toISOString(),id:n},u=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok)throw Error(`Failed to create example: ${u.status} ${u.statusText}`);let c=await u.json();return c}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>b(e)?_(e):e),i=b(t)?_(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a=e;else if(void 0!==t){let e=await this.readDataset({datasetName:t});a=e.id}else throw Error("Must provide a datasetName or datasetId");let i=new URLSearchParams({dataset:a});if(void 0!==r)for(let e of r)i.append("id",e);for await(let e of this._getPaginated("/examples",i))yield*e}async deleteExample(e){let t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){let r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);let a=await r.json();return a}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a}={loadChildRuns:!1}){let i,n;if("string"==typeof e)i=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)i=e;else throw Error(`Invalid run type: ${typeof e}`);null!==i.reference_example_id&&void 0!==i.reference_example_id&&(n=await this.readExample(i.reference_example_id));let s=await t.evaluateRun(i,n),o=r??{};return s.evaluatorInfo&&(o={...o,...s.evaluatorInfo}),await this.createFeedback(i.id,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,feedbackSourceType:"model"})}async createFeedback(e,t,{score:r,value:a,correction:i,comment:n,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c}){let d={type:l??"api",metadata:o??{}};void 0===u||d?.metadata===void 0||d.metadata.__run||(d.metadata.__run={run_id:u});let h={id:c??s.Z(),run_id:e,key:t,score:r,value:a,correction:i,comment:n,feedback_source:d},p=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms)});return await I(p,"create feedback"),h}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){let n={};null!=t&&(n.score=t),null!=r&&(n.value=r),null!=a&&(n.correction=a),null!=i&&(n.comment=i);let s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});await I(s,"update feedback")}async readFeedback(e){let t=`/feedback/${e}`,r=await this._get(t);return r}async deleteFeedback(e){let t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}}var M=r(7016);class D extends u.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,M.lS)("LANGCHAIN_PROJECT")??(0,M.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new L({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,M.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}var $=r(8715);class Z extends u.Z{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,M.lS)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let e=(0,M.lS)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){let t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){let t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){let e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){let t;let r=this.session??await this.loadDefaultSession(),a=e.serialized;if("llm"===e.run_type){let i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(e=>(0,$.zs)(e)),n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,prompts:i,response:e.outputs};t=n}else if("chain"===e.run_type){let i=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e))),n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:i.filter(e=>"llm"===e.type),child_chain_runs:i.filter(e=>"chain"===e.type),child_tool_runs:i.filter(e=>"tool"===e.type)};t=n}else if("tool"===e.run_type){let i=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e))),n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(a),child_llm_runs:i.filter(e=>"llm"===e.type),child_chain_runs:i.filter(e=>"chain"===e.type),child_tool_runs:i.filter(e=>"tool"===e.type)};t=n}else throw Error(`Unknown run type: ${e.run_type}`);return t}async persistRun(e){let t,r;t="llm"===(r=void 0!==e.run_type?await this.convertV2RunToRun(e):e).type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;let a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){let t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){let t;let r=await fetch(e,{method:"GET",headers:this.headers});if(!r.ok)return console.error(`Failed to load session: ${r.status} ${r.statusText}`),t={id:1,start_time:Date.now()},this.session=t,t;let a=await r.json();return 0===a.length?t={id:1,start_time:Date.now()}:[t]=a,this.session=t,t}}async function U(e){let t=new Z;return e?await t.loadSession(e):await t.loadDefaultSession(),t}async function B(){return new D}async function V(e,t){!0===t?await e():(void 0===n&&(n=function(){let e=g.default;return new e({autoStart:!0,concurrency:1})}()),n.add(e))}function K(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class z{setHandler(e){return this.setHandlers([e])}}class F{constructor(e,t,r,a,i,n,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map(t=>V(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}},t.awaitHandlers)))}}class q extends F{getChild(e){let t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}},t.awaitHandlers)))}}class H extends F{async handleLLMNewToken(e,t,r,a,i,n){await Promise.all(this.handlers.map(r=>V(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}},t.awaitHandlers)))}}class G extends F{getChild(e){let t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}},t.awaitHandlers)))}}class J extends F{getChild(e){let t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>V(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}},t.awaitHandlers)))}}class W extends z{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r,a,i){return Promise.all(t.map(async t=>{let r=(0,s.Z)();return await Promise.all(this.handlers.map(a=>V(async()=>{if(!a.ignoreLLM)try{await a.handleLLMStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new H(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,i){return Promise.all(t.map(async t=>{let r=(0,s.Z)();return await Promise.all(this.handlers.map(a=>V(async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await a.handleChatModelStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata);else if(a.handleLLMStart){let n=(0,$.zs)(t);await a.handleLLMStart?.(e,[n],r,this._parentRunId,i,this.tags,this.metadata)}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new H(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,s.Z)(),a){return await Promise.all(this.handlers.map(i=>V(async()=>{if(!i.ignoreChain)try{await i.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a)}catch(e){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`)}},i.awaitHandlers))),new G(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,s.Z)()){return await Promise.all(this.handlers.map(a=>V(async()=>{if(!a.ignoreAgent)try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}},a.awaitHandlers))),new J(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,s.Z)(),a){return await Promise.all(this.handlers.map(a=>V(async()=>{if(!a.ignoreRetriever)try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}},a.awaitHandlers))),new q(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new W(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends o.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,s.Z)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,i,n,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new W).setHandlers(e?.map(Y)??[],!0):o=e,o=o.copy(Array.isArray(t)?t.map(Y):t?.handlers,!1));let l=(0,M.lS)("LANGCHAIN_VERBOSE")||s?.verbose,u="true"===(0,M.lS)("LANGCHAIN_TRACING_V2"),c=u||((0,M.lS)("LANGCHAIN_TRACING")??!1);if(l||c){if(o||(o=new W),l&&!o.handlers.some(e=>e.name===f.prototype.name)){let e=new f;o.addHandler(e,!0)}if(c&&!o.handlers.some(e=>"langchain_tracer"===e.name)){if(u)o.addHandler(await B(),!0);else{let e=(0,M.lS)("LANGCHAIN_PROJECT")&&(0,M.lS)("LANGCHAIN_SESSION");o.addHandler(await U(e),!0)}}}return(r||a)&&o&&(o.addTags(r??[]),o.addTags(a??[],!1)),(i||n)&&o&&(o.addMetadata(i??{}),o.addMetadata(n??{},!1)),o}}function Y(e){return"name"in e?e:o.E.fromMethods(e)}},2740:(e,t,r)=>{"use strict";r.d(t,{APIChain:()=>c});var a=r(5095),i=r(8039),n=r(8880);let s=`You are given the below API Documentation:
{api_docs}
Using this documentation, generate the full API url to call for answering the user question.
You should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.

Question:{question}
API url:`,o=new n.PromptTemplate({inputVariables:["api_docs","question"],template:s}),l=`${s} {api_url}

Here is the response from the API:

{api_response}

Summarize this response to answer the original question.

Summary:`,u=new n.PromptTemplate({inputVariables:["api_docs","question","api_url","api_response"],template:l});class c extends a.l{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){let r=e[this.inputKey],a=await this.apiRequestChain.predict({question:r,api_docs:this.apiDocs},t?.getChild("request")),i=await fetch(a,{headers:this.headers}),n=await i.text(),s=await this.apiAnswerChain.predict({question:r,api_docs:this.apiDocs,api_url:a,api_response:n},t?.getChild("response"));return{[this.outputKey]:s}}_chainType(){return"api_chain"}static async deserialize(e){let{api_request_chain:t,api_answer_chain:r,api_docs:a}=e;if(!t)throw Error("LLMChain must have api_request_chain");if(!r)throw Error("LLMChain must have api_answer_chain");if(!a)throw Error("LLMChain must have api_docs");return new c({apiAnswerChain:await i.LLMChain.deserialize(r),apiRequestChain:await i.LLMChain.deserialize(t),apiDocs:a})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,r={}){let{apiUrlPrompt:a=o,apiResponsePrompt:n=u}=r,s=new i.LLMChain({prompt:a,llm:e}),l=new i.LLMChain({prompt:n,llm:e});return new this({apiAnswerChain:l,apiRequestChain:s,apiDocs:t,...r})}}},5095:(e,t,r)=>{"use strict";r.d(t,{l:()=>s});var a=r(6899),i=r(1788),n=r(5506);class s extends n.BD{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(1!=arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:r}),this.memory=e;else{let{memory:t,callbackManager:r,...a}=e;super({...a,callbacks:r??a.callbacks}),this.memory=t}}_selectMemoryInputs(e){let t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw Error("Method not implemented.")}async run(e,t){let r=this.inputKeys.filter(e=>!this.memory?.memoryKeys.includes(e)??!0),a=r.length<=1;if(!a)throw Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);let i=r.length?{[r[0]]:e}:{},n=await this.call(i,t),s=Object.keys(n);if(1===s.length)return n[s[0]];throw Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){let t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory){let r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(let[e,a]of Object.entries(r))t[e]=a}return t}async call(e,t,r){let n;let s=await this._formatValues(e),o=(0,i.QH)(t),l=await i.Ye.configure(o.callbacks,this.callbacks,o.tags||r,this.tags,o.metadata,this.metadata,{verbose:this.verbose}),u=await l?.handleChainStart(this.toJSON(),s);try{n=await (e.signal?Promise.race([this._call(s,u),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this._call(s,u))}catch(e){throw await u?.handleChainError(e),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),n),await u?.handleChainEnd(n),Object.defineProperty(n,a.WH,{value:u?{runId:u?.runId}:void 0,configurable:!0}),n}async apply(e,t){return Promise.all(e.map(async(e,r)=>this.call(e,t?.[r])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{let{LLMChain:t}=await Promise.resolve().then(r.bind(r,8039));return t.deserialize(e)}case"sequential_chain":{let{SequentialChain:t}=await Promise.resolve().then(r.bind(r,2279));return t.deserialize(e)}case"simple_sequential_chain":{let{SimpleSequentialChain:t}=await Promise.resolve().then(r.bind(r,2279));return t.deserialize(e)}case"stuff_documents_chain":{let{StuffDocumentsChain:t}=await Promise.resolve().then(r.bind(r,9189));return t.deserialize(e)}case"map_reduce_documents_chain":{let{MapReduceDocumentsChain:t}=await Promise.resolve().then(r.bind(r,9189));return t.deserialize(e)}case"refine_documents_chain":{let{RefineDocumentsChain:t}=await Promise.resolve().then(r.bind(r,9189));return t.deserialize(e)}case"vector_db_qa":{let{VectorDBQAChain:a}=await Promise.resolve().then(r.bind(r,247));return a.deserialize(e,t)}case"api_chain":{let{APIChain:t}=await Promise.resolve().then(r.bind(r,2740));return t.deserialize(e)}default:throw Error(`Invalid prompt type in config: ${e._type}`)}}}},9189:(e,t,r)=>{"use strict";r.d(t,{MapReduceDocumentsChain:()=>o,RefineDocumentsChain:()=>l,StuffDocumentsChain:()=>s});var a=r(5095),i=r(8039),n=r(8880);class s extends a.l{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:t,...r}=e,a=t.map(({pageContent:e})=>e),i=a.join("\n\n");return{...r,[this.documentVariableName]:i}}async _call(e,t){let r=await this.llmChain.call(this._prepInputs(e),t?.getChild("combine_documents"));return r}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw Error("Missing llm_chain");return new s({llmChain:await i.LLMChain.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class o extends a.l{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:r,...a}=e,i=r,n=[];for(let e=0;e<this.maxIterations;e+=1){let r=i.map(e=>({[this.documentVariableName]:e.pageContent,...a})),s=0!==e||!this.ensureMapStep;if(s){let e=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:i,...a})),t=await this.combineDocumentChain.llmChain.llm.getNumTokens(e),r=t<this.maxTokens;if(r)break}let o=await this.llmChain.apply(r,t?Array.from({length:r.length},(e,r)=>t.getChild(`map_${r+1}`)):void 0),{outputKey:l}=this.llmChain;this.returnIntermediateSteps&&(n=n.concat(o.map(e=>e[l]))),i=o.map(e=>({pageContent:e[l],metadata:{}}))}let s={[this.combineDocumentChain.inputKey]:i,...a},o=await this.combineDocumentChain.call(s,t?.getChild("combine_documents"));return this.returnIntermediateSteps?{...o,intermediateSteps:n}:o}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw Error("Missing llm_chain");if(!e.combine_document_chain)throw Error("Missing combine_document_chain");return new o({llmChain:await i.LLMChain.deserialize(e.llm_chain),combineDocumentChain:await s.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class l extends a.l{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new n.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){let r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(e=>{a[e]=r[e]});let i={[this.documentVariableName]:await this.documentPrompt.format({...a})},n={...i,...t};return n}async _constructRefineInputs(e,t){let r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(e=>{a[e]=r[e]});let i={[this.documentVariableName]:await this.documentPrompt.format({...a})},n={[this.initialResponseName]:t,...i};return n}async _call(e,t){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:r,...a}=e,i=await this._constructInitialInputs(r[0],a),n=await this.llmChain.predict({...i},t?.getChild("answer")),s=[n];for(let e=1;e<r.length;e+=1){let i=await this._constructRefineInputs(r[e],n),o={...i,...a};n=await this.refineLLMChain.predict({...o},t?.getChild("refine")),s.push(n)}return{[this.outputKey]:n}}_chainType(){return"refine_documents_chain"}static async deserialize(e){let t=e.llm_chain;if(!t)throw Error("Missing llm_chain");let r=e.refine_llm_chain;if(!r)throw Error("Missing refine_llm_chain");return new l({llmChain:await i.LLMChain.deserialize(t),refineLLMChain:await i.LLMChain.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},8039:(e,t,r)=>{"use strict";r.d(t,{LLMChain:()=>l});var a=r(5095),i=r(260),n=r(5506),s=r(3394);class o extends s.bI{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class l extends a.l{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new o,this.prompt.outputParser){if(e.outputParser)throw Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){let t=super._selectMemoryInputs(e);for(let r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){return this.outputParser?await this.outputParser.parseResultWithPrompt(e,t,r?.getChild()):e[0].text}call(e,t){return super.call(e,t)}async _call(e,t){let r={...e},a={...this.llmKwargs};for(let t of this.llm.callKeys)t in e&&(a[t]=e[t],delete r[t]);let i=await this.prompt.formatPromptValue(r),{generations:n}=await this.llm.generatePrompt([i],a,t?.getChild());return{[this.outputKey]:await this._getFinalOutput(n[0],i,t)}}async predict(e,t){let r=await this.call(e,t);return r[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){let{llm:t,prompt:r}=e;if(!t)throw Error("LLMChain must have llm");if(!r)throw Error("LLMChain must have prompt");return new l({llm:await n.qV.deserialize(t),prompt:await i.dy.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}},2279:(e,t,r)=>{"use strict";r.d(t,{SequentialChain:()=>o,SimpleSequentialChain:()=>l});var a=r(5095);function i(e,t){let r=new Set;for(let a of t)e.has(a)&&r.add(a);return r}function n(e,t){let r=new Set(e);for(let e of t)r.delete(e);return r}function s(e){return Array.from(e).map(e=>`"${e}"`).join(", ")}class o extends a.l{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){if(0===this.chains.length)throw Error("Sequential chain must have at least one chain.");let e=this.memory?.memoryKeys??[],t=new Set(this.inputKeys),r=new Set(e),a=i(t,r);if(a.size>0)throw Error(`The following keys: ${s(a)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);let o=function(e,t){let r=new Set(e);for(let e of t)r.add(e);return r}(t,r);for(let e of this.chains){let t=n(new Set(e.inputKeys),o);if(e.memory&&(t=n(t,new Set(e.memory.memoryKeys))),t.size>0)throw Error(`Missing variables for chain "${e._chainType()}": ${s(t)}. Only got the following variables: ${s(o)}.`);let r=new Set(e.outputKeys),a=i(o,r);if(a.size>0)throw Error(`The following output variables for chain "${e._chainType()}" are overlapping: ${s(a)}. This can lead to unexpected behaviour.`);for(let e of r)o.add(e)}if(0===this.outputVariables.length){if(this.returnAll){let e=n(o,t);this.outputVariables=Array.from(e)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys}else{let e=n(new Set(this.outputVariables),new Set(o));if(e.size>0)throw Error(`The following output variables were expected to be in the final chain output but were not found: ${s(e)}.`)}}async _call(e,t){let r={},a=0;for(let i of this.chains)for(let n of(a+=1,Object.keys(r=await i.call(e,t?.getChild(`step_${a}`)))))e[n]=r[n];let i={};for(let t of this.outputVariables)i[t]=e[t];return i}_chainType(){return"sequential_chain"}static async deserialize(e){let t=[],r=e.input_variables,i=e.output_variables,n=e.chains;for(let e of n){let r=await a.l.deserialize(e);t.push(r)}return new o({chains:t,inputVariables:r,outputVariables:i})}serialize(){let e=[];for(let t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class l extends a.l{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(let e of this.chains){if(1!==e.inputKeys.filter(t=>!e.memory?.memoryKeys.includes(t)??!0).length)throw Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(1!==e.outputKeys.length)throw Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],a=0;for(let i of this.chains)a+=1,r=(await i.call({[i.inputKeys[0]]:r,signal:e.signal},t?.getChild(`step_${a}`)))[i.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await t?.handleText(r);return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){let t=[],r=e.chains;for(let e of r){let r=await a.l.deserialize(e);t.push(r)}return new l({chains:t})}serialize(){let e=[];for(let t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}},247:(e,t,r)=>{"use strict";r.d(t,{VectorDBQAChain:()=>f});var a=r(5095),i=r(8039),n=r(9189),s=r(8880),o=r(8534);class l{async getPromptAsync(e,t){let r=this.getPrompt(e);return r.partial(t?.partialVariables??{})}}let u=new s.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),c=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,d=[o.ov.fromTemplate(c),o.kq.fromTemplate("{question}")],h=o.ks.fromMessages(d),p=new class extends l{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(let[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}(u,[[function(e){return"base_chat_model"===e._modelType()},h]]);r(565);class f extends a.l{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw Error(`Question key ${this.inputKey} not found.`);let r=e[this.inputKey],a=await this.vectorstore.similaritySearch(r,this.k,e.filter,t?.getChild("vectorstore")),i=await this.combineDocumentsChain.call({question:r,input_documents:a},t?.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:a}:i}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");let{vectorstore:r}=t;if(!e.combine_documents_chain)throw Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new f({combineDocumentsChain:await a.l.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){let a=function(e,t={}){let{prompt:r=p.getPrompt(e),verbose:a}=t,s=new i.LLMChain({prompt:r,llm:e,verbose:a}),o=new n.StuffDocumentsChain({llmChain:s,verbose:a});return o}(e);return new this({vectorstore:t,combineDocumentsChain:a,...r})}}},9337:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ChatOpenAI:()=>g,PromptLayerChatOpenAI:()=>y});var a=r(7615),i=r(8036),n=r(6899),s=r(2552);function o(e){return{name:e.name,description:e.description,parameters:(0,s.Y_)(e.schema)}}var l=r(1674),u=r(7016);let c=async(e,t,r,a,i,n,s,o)=>{let l=await e.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:t,provider:"langchain",kwargs:r,tags:a,request_response:i,request_start_time:Math.floor(n/1e3),request_end_time:Math.floor(s/1e3),api_key:o})});return l.json()};var d=r(5506),h=r(1788);class p extends d.qV{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){let r=p._convertInputToPromptValue(e),a=await this.generatePrompt([r],t,t?.callbacks),i=a.generations[0][0];return i.message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(e,t){if(this._streamResponseChunks===p.prototype._streamResponseChunks)yield this.invoke(e,t);else{let r;let a=p._convertInputToPromptValue(e),i=a.toChatMessages(),[n,s]=this._separateRunnableConfigFromCallOptions(t),o=await h.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this?.invocationParams(s)},u=await o?.handleChatModelStart(this.toJSON(),[i],void 0,void 0,l);try{for await(let e of this._streamResponseChunks(i,s,u?.[0]))yield e.message,r=r?r.concat(e):e}catch(e){throw await Promise.all((u??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((u??[]).map(e=>e?.handleLLMEnd({generations:[[r]]})))}}async _generateUncached(e,t,r){let a=e.map(e=>e.map(n.E1)),i=await h.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t)},o=await i?.handleChatModelStart(this.toJSON(),a,void 0,void 0,s),l=await Promise.allSettled(a.map((e,r)=>this._generate(e,{...t,promptIndex:r},o?.[r]))),u=[],c=[];await Promise.all(l.map(async(e,t)=>{if("fulfilled"!==e.status)return await o?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;return u[t]=r.generations,c[t]=r.llmOutput,o?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}));let d={generations:u,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(d,n.WH,{value:o?{runIds:o?.map(e=>e.runId)}:void 0,configurable:!0}),d}async generate(e,t,r){let a;a=Array.isArray(t)?{stop:t}:t;let i=e.map(e=>e.map(n.E1)),[s,o]=this._separateRunnableConfigFromCallOptions(a);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(i,o,s);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),c=[],d=await Promise.all(i.map(async(e,t)=>{let r=p._convertInputToPromptValue(e).toString(),a=await l.lookup(r,u);return a||c.push(t),a})),h={};if(c.length>0){let e=await this._generateUncached(c.map(e=>i[e]),o,s);await Promise.all(e.generations.map(async(e,t)=>{let r=c[t];d[r]=e;let a=p._convertInputToPromptValue(i[r]).toString();return l.update(a,u,e)})),h=e.llmOutput??{}}return{generations:d,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let a=e.map(e=>e.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){let a=await this.generate([e.map(n.E1)],t,r);return a.generations[0][0].message}async callPrompt(e,t,r){let a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let a=new n.xk(e),i=await this.call([a],t,r);return i.content}}var f=r(4541);function m(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":if(!n.J.isInstance(e))throw Error("Invalid generic chat message");return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role;default:throw Error(`Unknown message type: ${t}`)}}class g extends p{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,u.lS)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,u.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,u.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,u.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,u.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,u.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,u.lS)("OPENAI_ORGANIZATION"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,user:this.user,stream:this.streaming,functions:e?.functions??(e?.tools?e?.tools.map(o):void 0),function_call:e?.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async *_streamResponseChunks(e,t,r){let a;let i=e.map(e=>({role:m(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call})),s={...this.invocationParams(t),messages:i,stream:!0},o=await this.completionWithRetry(s,t);for await(let e of o){let i=e?.choices[0];if(!i)continue;let{delta:s}=i,o=function(e,t){let r;let a=e.role??t,i=e.content??"";return(r=e.function_call?{function_call:e.function_call}:{},"user"===a)?new n.ro({content:i}):"assistant"===a?new n.GC({content:i,additional_kwargs:r}):"system"===a?new n.xq({content:i}):"function"===a?new n.Cr({content:i,additional_kwargs:r,name:e.name}):new n.HD({content:i,role:a})}(s,a);a=s.role??a;let l={prompt:t.promptIndex??0,completion:i.index??0},u=new n.Ls({message:o,text:o.content,generationInfo:l});yield u,r?.handleLLMNewToken(u.text??"",l,void 0,void 0,void 0,{chunk:u})}if(t.signal?.aborted)throw Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){let a={},i=this.invocationParams(t),s=e.map(e=>({role:m(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call}));if(i.stream){let a=await this._streamResponseChunks(e,t,r),i={};for await(let e of a){let t=e.generationInfo?.completion??0;void 0===i[t]?i[t]=e:i[t]=i[t].concat(e)}let n=Object.entries(i).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t);return{generations:n}}{let e=await this.completionWithRetry({...i,stream:!1,messages:s},{signal:t?.signal,...t?.options}),{completion_tokens:r,prompt_tokens:o,total_tokens:l}=e?.usage??{};r&&(a.completionTokens=(a.completionTokens??0)+r),o&&(a.promptTokens=(a.promptTokens??0)+o),l&&(a.totalTokens=(a.totalTokens??0)+l);let u=[];for(let t of e?.choices??[]){let e=t.message?.content??"",r={text:e,message:function(e){switch(e.role){case"user":return new n.xk(e.content||"");case"assistant":return new n.gY(e.content||"",{function_call:e.function_call});case"system":return new n.jN(e.content||"");default:return new n.J(e.content||"",e.role??"unknown")}}(t.message??{role:"assistant"})};t.finish_reason&&(r.generationInfo={finish_reason:t.finish_reason}),u.push(r)}return{generations:u,llmOutput:{tokenUsage:a}}}}async getNumTokensFromMessages(e){let t=0,r=0,a=0;"gpt-3.5-turbo"===(0,i._i)(this.modelName)?(r=4,a=-1):(0,i._i)(this.modelName).startsWith("gpt-4")&&(r=3,a=1);let n=await Promise.all(e.map(async e=>{let i=await this.getNumTokens(e.content),n=await this.getNumTokens(m(e)),s=void 0!==e.name?a+await this.getNumTokens(e.name):0,o=i+r+n+s;return t+=o,o}));return{totalCount:t+=3,countPerMessage:n}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{let t=await this.client.chat.completions.create(e,r);return t}catch(t){let e=(0,f.K)(t);throw e}})}_getClientOptions(e){if(!this.client){let e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,l.O)(e),r={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};r.baseURL||delete r.baseURL,this.client=new a.Pp(r)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}class y extends g{constructor(e){super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=e?.promptLayerApiKey??("undefined"!=typeof process?process.env?.PROMPTLAYER_API_KEY:void 0),this.plTags=e?.plTags??[],this.returnPromptLayerId=e?.returnPromptLayerId??!1}async _generate(e,t,r){let a;let i=Date.now();a=Array.isArray(t)?{stop:t}:t?.timeout&&!t.signal?{...t,signal:AbortSignal.timeout(t.timeout)}:t??{};let n=await super._generate(e,a,r),s=Date.now(),o=e=>{let t;if("human"===e._getType())t={role:"user",content:e.content};else if("ai"===e._getType())t={role:"assistant",content:e.content};else if("function"===e._getType())t={role:"assistant",content:e.content};else if("system"===e._getType())t={role:"system",content:e.content};else if("generic"===e._getType())t={role:e.role,content:e.content};else throw Error(`Got unknown type ${e}`);return t},l=(e,t)=>{let r={...this.invocationParams(),model:this.modelName};if(t?.stop&&Object.keys(r).includes("stop"))throw Error("`stop` found in both the input and default params.");let a=e.map(e=>o(e));return a};for(let t=0;t<n.generations.length;t+=1){let r;let o=n.generations[t],u=l(e,a),d=[{content:o.text,role:m(o.message)}],h=await c(this.caller,"langchain.PromptLayerChatOpenAI",{...this._identifyingParams(),messages:u,stream:!1},this.plTags,d,i,s,this.promptLayerApiKey);!0===this.returnPromptLayerId&&(!0===h.success&&(r=h.request_id),o.generationInfo&&"object"==typeof o.generationInfo||(o.generationInfo={}),o.generationInfo.promptLayerRequestId=r)}return n}}},6172:(e,t,r)=>{"use strict";r.d(t,{B:()=>a});class a{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}},2345:(e,t,r)=>{"use strict";r.d(t,{i:()=>o,j:()=>s});var a=r(4490);function i(e,t){return t?.[e]||a(e)}function n(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e),r="function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name());return r?e.lc_name():e.name}r(4108);class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[i,...n]=e.split(".").reverse();for(let e of n.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}i in t&&void 0!==t[i]&&(a[i]=a[i]||t[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let a={};for(let i in e)Object.hasOwn(e,i)&&(a[t(i,r)]=e[i]);return a}(Object.keys(t).length?function(e,t){let r=n(e);for(let[e,a]of Object.entries(t)){let[t,...i]=e.split(".").reverse(),s=r;for(let e of i.reverse()){if(void 0===s[e])break;s[e]=n(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,i,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},8715:(e,t,r)=>{"use strict";r.d(t,{d9:()=>n,fF:()=>a,jG:()=>s,zs:()=>o});class a{}let i=(e,t)=>{if(void 0!==t)return e[t];let r=Object.keys(e);if(1===r.length)return e[r[0]]},n=(e,t)=>{let r=i(e,t);if(!r){let t=Object.keys(e);throw Error(`input values have ${t.length} keys, you must specify an input key or pass only 1 key as input`)}return r},s=(e,t)=>{let r=i(e,t);if(!r){let t=Object.keys(e);throw Error(`output values have ${t.length} keys, you must specify an output key or pass only 1 key as output`)}return r};function o(e,t="Human",r="AI"){let a=[];for(let i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=r;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("generic"===i._getType())e=i.role;else throw Error(`Got unsupported message type: ${i}`);let n=i.name?`${i.name}, `:"";a.push(`${e}: ${n}${i.content}`)}return a.join("\n")}},7021:(e,t,r)=>{"use strict";r.d(t,{s:()=>n});var a=r(8715),i=r(2571);class n extends i.B{constructor(e){super({chatHistory:e?.chatHistory,returnMessages:e?.returnMessages??!1,inputKey:e?.inputKey,outputKey:e?.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=e?.humanPrefix??this.humanPrefix,this.aiPrefix=e?.aiPrefix??this.aiPrefix,this.memoryKey=e?.memoryKey??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){let t=await this.chatHistory.getMessages();if(this.returnMessages){let e={[this.memoryKey]:t};return e}let r={[this.memoryKey]:(0,a.zs)(t,this.humanPrefix,this.aiPrefix)};return r}}},2571:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var a=r(8715),i=r(8454);class n extends a.fF{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=e?.chatHistory??new i.V,this.returnMessages=e?.returnMessages??this.returnMessages,this.inputKey=e?.inputKey??this.inputKey,this.outputKey=e?.outputKey??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage((0,a.d9)(e,this.inputKey)),await this.chatHistory.addAIChatMessage((0,a.jG)(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}},3065:(e,t,r)=>{"use strict";r(8880)},6532:(e,t,r)=>{"use strict";r(8039),r(6899),r(2571),r(3065)},9696:(e,t,r)=>{"use strict";r(6532)},9644:(e,t,r)=>{"use strict";r.d(t,{D:()=>l});var a=r(3394),i=r(8039),n=r(8880);let s=`Instructions:
--------------
{instructions}
--------------
Completion:
--------------
{completion}
--------------

Above, the Completion did not satisfy the constraints given in the Instructions.
Error:
--------------
{error}
--------------

Please try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:`,o=n.PromptTemplate.fromTemplate(s);class l extends a.bI{static lc_name(){return"OutputFixingParser"}static fromLLM(e,t,r){let a=r?.prompt??o,n=new i.LLMChain({llm:e,prompt:a});return new l({parser:t,retryChain:n})}constructor({parser:e,retryChain:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","fix"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.parser=e,this.retryChain=t}async parse(e,t){try{return await this.parser.parse(e,t)}catch(r){if(r instanceof a.dS){let a=await this.retryChain.call({instructions:this.parser.getFormatInstructions(),completion:e,error:r},t),i=a[this.retryChain.outputKey];return this.parser.parse(i)}throw r}}getFormatInstructions(){return this.parser.getFormatInstructions()}}},260:(e,t,r)=>{"use strict";r.d(t,{Al:()=>o,dy:()=>s,nw:()=>n});var a=r(6899);r(2345);var i=r(4978);class n extends a.MJ{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new a.xk(this.value)]}}class s extends i.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[e,a]of Object.entries(t))"string"==typeof a?r[e]=a:r[e]=await a();let a={...r,...e};return a}async invoke(e,t){return this._callWithConfig(e=>this.formatPromptValue(e),e,{...t,runType:"prompt"})}serialize(){throw Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,8880));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,8880));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,7742));return t.deserialize(e)}default:throw Error(`Invalid prompt type in config: ${e._type}`)}}}class o extends s{async formatPromptValue(e){let t=await this.format(e);return new n(t)}}},8534:(e,t,r)=>{"use strict";r.d(t,{GU:()=>l,ax:()=>u,gc:()=>f,kq:()=>p,ks:()=>g,ov:()=>m});var a=r(6899),i=r(4978),n=r(260),s=r(8880);class o extends i.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class l extends a.MJ{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class u extends o{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName}get inputVariables(){return[this.variableName]}formatMessages(e){return Promise.resolve(e[this.variableName])}}class c extends o{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class d extends n.dy{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new l(t)}}class h extends c{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new a.J(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(s.PromptTemplate.fromTemplate(e),t)}}class p extends c{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new a.xk(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class f extends c{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new a.gY(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class m extends c{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new a.jN(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class g extends d{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=new Set;for(let t of this.promptMessages)if(!(t instanceof a.ku))for(let r of t.inputVariables)e.add(r);let t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),i=new Set([...r].filter(t=>!e.has(t)));if(i.size>0)throw Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);let n=new Set([...e].filter(e=>!r.has(e)));if(n.size>0)throw Error(`Input variables \`${[...n]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let e of this.promptMessages)if(e instanceof a.ku)r.push(e);else{let a=e.inputVariables.reduce((e,r)=>{if(!(r in t))throw Error(`Missing value for input variable \`${r.toString()}\``);return e[r]=t[r],e},{}),i=await e.formatMessages(a);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new g(a)}static fromMessages(e){let t=e.reduce((e,t)=>e.concat(t instanceof g?t.promptMessages:[function(e){if("function"==typeof e.formatMessages||(0,a.QW)(e))return e;let t=(0,a.E1)(e);if("human"===t._getType())return p.fromTemplate(t.content);if("ai"===t._getType())return f.fromTemplate(t.content);if("system"===t._getType())return m.fromTemplate(t.content);if(a.J.isInstance(t))return h.fromTemplate(t.content,t.role);throw Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}(t)]),[]),r=e.reduce((e,t)=>t instanceof g?Object.assign(e,t.partialVariables):e,Object.create(null)),i=new Set;for(let e of t)if(!(e instanceof a.ku))for(let t of e.inputVariables)t in r||i.add(t);return new g({inputVariables:[...i],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}},7742:(e,t,r)=>{"use strict";r.d(t,{FewShotPromptTemplate:()=>s});var a=r(260),i=r(223),n=r(8880);class s extends a.Al{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new s(a)}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(e=>this.examplePrompt.format(e))),n=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,i.SM)(n,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t;let{example_prompt:r}=e;if(!r)throw Error("Missing example prompt");let a=await n.PromptTemplate.deserialize(r);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new s({inputVariables:e.input_variables,examplePrompt:a,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}},565:(e,t,r)=>{"use strict";r.d(t,{gc:()=>i.gc,ks:()=>i.ks,kq:()=>i.kq,Pf:()=>a.PromptTemplate,ov:()=>i.ov,SM:()=>n.SM}),r(260);var a=r(8880);r(7742);var i=r(8534),n=r(223)},8880:(e,t,r)=>{"use strict";r.d(t,{PromptTemplate:()=>n});var a=r(260),i=r(223);class n extends a.Al{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return(0,i.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a="\n\n",i=""){let s=[i,...e,t].join(a);return new n({inputVariables:r,template:s})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){let a=new Set;return(0,i.$M)(e,t).forEach(e=>{"variable"===e.type&&a.add(e.name)}),new n({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw Error("Prompt template must have a template");let t=new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format});return t}}},223:(e,t,r)=>{"use strict";r.d(t,{$M:()=>o,SM:()=>s,af:()=>l});let a=e=>{let t=e.split(""),r=[],a=(e,r)=>{for(let a=r;a<t.length;a+=1)if(e.includes(t[a]))return a;return -1},i=0;for(;i<t.length;)if("{"===t[i]&&i+1<t.length&&"{"===t[i+1])r.push({type:"literal",text:"{"}),i+=2;else if("}"===t[i]&&i+1<t.length&&"}"===t[i+1])r.push({type:"literal",text:"}"}),i+=2;else if("{"===t[i]){let e=a("}",i);if(e<0)throw Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(i+1,e).join("")}),i=e+1}else if("}"===t[i])throw Error("Single '}' in template.");else{let e=a("{}",i),n=(e<0?t.slice(i):t.slice(i,e)).join("");r.push({type:"literal",text:n}),i=e<0?t.length:e}return r},i={"f-string":(e,t)=>a(e).reduce((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw Error(`Missing value for input ${r.name}`)}return e+r.text},"")},n={"f-string":a},s=(e,t,r)=>i[t](e,r),o=(e,t)=>n[t](e),l=(e,t,r)=>{if(!(t in i)){let e=Object.keys(i);throw Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${e}`)}try{let a=r.reduce((e,t)=>(e[t]="foo",e),{});s(e,t,a)}catch(e){throw Error(`Invalid prompt schema: ${e.message}`)}}},6899:(e,t,r)=>{"use strict";r.d(t,{Cr:()=>m,E1:()=>v,GC:()=>d,H2:()=>P,HD:()=>b,J:()=>g,Ls:()=>_,MJ:()=>w,QW:()=>y,TN:()=>f,WH:()=>i,gY:()=>c,jN:()=>h,ku:()=>s,oV:()=>x,ro:()=>u,xk:()=>l,xq:()=>p});var a=r(2345);let i="__run";class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class s extends a.i{get text(){return this.content}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class o extends s{static _mergeAdditionalKwargs(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(void 0===r[e])r[e]=a;else if(typeof r[e]!=typeof a)throw Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e])throw Error(`additional_kwargs[${e}] already exists in this message chunk.`);else r[e]=this._mergeAdditionalKwargs(r[e],a);return r}}class l extends s{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class u extends o{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new u({content:this.content+e.content,additional_kwargs:u._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class c extends s{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class d extends o{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:this.content+e.content,additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends s{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class p extends o{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new p({content:this.content+e.content,additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class f extends s{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class m extends o{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new m({content:this.content+e.content,additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class g extends s{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function y(e){return"function"==typeof e._getType}function v(e){if("string"==typeof e)return new l(e);if(y(e))return e;let[t,r]=e;if("human"===t||"user"===t)return new l({content:r});if("ai"===t||"assistant"===t)return new c({content:r});if("system"===t)return new h({content:r});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class b extends o{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new b({content:this.content+e.content,additional_kwargs:b._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class _ extends n{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new _({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class w extends a.i{}class x extends a.i{addUserMessage(e){return this.addMessage(new l(e))}addAIChatMessage(e){return this.addMessage(new c(e))}}class P{}},3394:(e,t,r)=>{"use strict";r.d(t,{AN:()=>o,Bi:()=>l,bI:()=>n,dS:()=>u,tw:()=>i});var a=r(4978);class i extends a.eq{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async e=>this.parseResult([{text:e}]),e,{...t,runType:"parser"}):this._callWithConfig(async e=>this.parseResult([{message:e,text:e.content}]),e,{...t,runType:"parser"})}}class n extends i{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}}class s extends n{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:t.content}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class o extends s{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class l extends s{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}class u extends Error{constructor(e,t,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=a,a&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}},4978:(e,t,r)=>{"use strict";r.d(t,{eq:()=>I,lW:()=>R});var a={};r.r(a),r.d(a,{JsonPatchError:()=>c,_areEquals:()=>_,applyOperation:()=>m,applyPatch:()=>g,applyReducer:()=>y,deepClone:()=>d,getValueByPointer:()=>f,validate:()=>b,validator:()=>v});var i=r(1333),n=r(1788);/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */let s=Object.prototype.hasOwnProperty;function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}let c=class extends Error{constructor(e,t,r,a,i){super(u(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=u(e,{name:t,index:r,operation:a,tree:i})}},d=o,h={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=f(r,this.path);a&&(a=o(a));let i=m(r,{op:"remove",path:this.from}).removed;return m(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=f(r,this.from);return m(r,{op:"add",path:this.path,value:o(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:_(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var p={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:h.move,copy:h.copy,test:h.test,_get:h._get};function f(e,t){if(""==t)return e;var r={op:"_get",path:t};return m(e,r),r.value}function m(e,t,r=!1,a=!0,i=!0,n=0){if(r&&("function"==typeof r?r(t,0,e,t.path):v(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=f(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=_(e,t.value),!1===a.test)throw new c("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new c("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e)}}{let s,u,d;a||(e=o(e));let f=t.path||"",m=f.split("/"),g=e,y=1,b=m.length;for(u="function"==typeof r?r:v;;){if((s=m[y])&&-1!=s.indexOf("~")&&(s=s.replace(/~1/g,"/").replace(/~0/g,"~")),i&&("__proto__"==s||"prototype"==s&&y>0&&"constructor"==m[y-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===d&&(void 0===g[s]?d=m.slice(0,y).join("/"):y==b-1&&(d=t.path),void 0!==d&&u(t,0,e,d)),y++,Array.isArray(g)){if("-"===s)s=g.length;else{if(r&&!l(s))throw new c("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);l(s)&&(s=~~s)}if(y>=b){if(r&&"add"===t.op&&s>g.length)throw new c("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);let a=p[t.op].call(t,g,s,e);if(!1===a.test)throw new c("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a}}else if(y>=b){let r=h[t.op].call(t,g,s,e);if(!1===r.test)throw new c("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r}if(g=g[s],r&&y<b&&(!g||"object"!=typeof g))throw new c("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function g(e,t,r,a=!0,i=!0){if(r&&!Array.isArray(t))throw new c("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=o(e));let n=Array(t.length);for(let a=0,s=t.length;a<s;a++)n[a]=m(e,t[a],r,!0,i,a),e=n[a].newDocument;return n.newDocument=e,n}function y(e,t,r){let a=m(e,t);if(!1===a.test)throw new c("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function v(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new c("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(h[e.op]){if("string"!=typeof e.path)throw new c("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new c('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new c("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new c("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)s.call(e,r)&&t.push(r);return t}(t),i=a.length;for(var r=0;r<i;r++)if(e(t[a[r]]))return!0}}return!1}(e.value))throw new c("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var i=e.path.split("/").length,n=a.split("/").length;if(i!==n+1&&i!==n)throw new c("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new c("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var o=b([{op:"_get",path:e.from,value:void 0}],r);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new c("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new c("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function b(e,t,r){try{if(!Array.isArray(e))throw new c("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)g(o(t),o(e),r||!0);else{r=r||v;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof c)return e;throw e}}function _(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,i,n=Array.isArray(e),s=Array.isArray(t);if(n&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!_(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!_(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}({...a});var w=r(2389);class x extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();let e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new x({start:e=>(function r(){return t.read().then(({done:t,value:a})=>{if(t){e.close();return}return e.enqueue(a),r()})})()})}static fromAsyncGenerator(e){return new x({async pull(t){let{value:r,done:a}=await e.next();a?t.close():r&&t.enqueue(r)}})}}class P{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){let t=this.ops.concat(e.ops),r=g({},t);return new O({ops:t,state:r[r.length-1].newDocument})}}class O extends P{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=g(this.state,e.ops);return new O({ops:t,state:r[r.length-1].newDocument})}}class T extends w.Z{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"indexMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=x.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new P({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:[]}}]})),!this._includeRun(e))return;this.indexMap[e.id]=Math.max(...Object.values(this.indexMap),-1)+1;let t={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new P({ops:[{op:"add",path:`/logs/${this.indexMap[e.id]}`,value:t}]}))}async onRunUpdate(e){try{let t=this.indexMap[e.id];if(void 0===t)return;let r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new P({ops:r});await this.writer.write(a)}finally{if(void 0===e.parent_run_id){let t=new P({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){let r=this.indexMap[e.id];if(void 0===r)return;let a=new P({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(a)}}var S=r(2345);async function E(e){return n.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}var k=r(64);function A(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class I extends S.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new C({bound:this,kwargs:e,config:{}})}map(){return new j({bound:this})}withRetry(e){return new N({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new C({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new D({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=new k.L({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}}),n=e.map((e,t)=>i.call(async()=>{try{let r=await this.invoke(e,a[t]);return r}catch(e){if(r?.returnExceptions)return e;throw e}}));return Promise.all(n)}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return x.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){let t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){let a;let i=await E(r),n=await i?.handleChainStart(this.toJSON(),A(t,"input"),void 0,r?.runType);try{a=await e.bind(this)(t,r,n)}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(A(a,"output")),a}async _batchWithConfig(e,t,r,a){let i;let n=this._getOptionsList(r??{},t.length),s=await Promise.all(n.map(E)),o=await Promise.all(s.map((e,r)=>e?.handleChainStart(this.toJSON(),A(t[r],"input"))));try{i=await e(t,n,o,a)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(A(i,"output")))),i}async *_transformStreamWithConfig(e,t,r){let a,i,n;let s=!0,o=!0,l=await E(r),u=this.toJSON();async function*c(){for await(let t of e){if(n||(n=await l?.handleChainStart(u,{input:""},void 0,r?.runType)),s){if(void 0===a)a=t;else try{a=a.concat(t)}catch{a=void 0,s=!1}}yield t}}let d=c();try{let e=t(d,n,r);for await(let t of e)if(yield t,o){if(void 0===i)i=t;else try{i=i.concat(t)}catch{i=void 0,o=!1}}}catch(e){throw await n?.handleChainError(e,void 0,void 0,void 0,{inputs:A(a,"input")}),e}await n?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:A(a,"input")})}_patchConfig(e={},t){return{...e,callbacks:t}}pipe(e){return new R({first:this,last:$(e)})}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:r.concat(t);yield*this._streamIterator(r,t)}async *streamLog(e,t,r){let a=new T({...r,autoClose:!1}),i=t??{},{callbacks:n}=i;if(void 0===n)i.callbacks=[a];else if(Array.isArray(n))i.callbacks=n.concat([a]);else{let e=n.copy();e.inheritableHandlers.push(a),i.callbacks=e}let s=await this.stream(e,i);async function o(){try{for await(let e of s){let t=new P({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await a.writer.write(t)}}finally{await a.writer.close()}}let l=o();try{for await(let e of a)yield e}finally{await l}}static isRunnable(e){return e.lc_runnable}}class C extends I{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config}_mergeConfig(e){let t={...this.config};if(e)for(let r of Object.keys(e))"metadata"===r?t[r]={...t[r],...e[r]}:"tags"===r?t[r]=(t[r]??[]).concat(e[r]??[]):t[r]=e[r]??t[r];return t}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){let a=Array.isArray(t)?t.map(e=>this._mergeConfig({...e,...this.kwargs})):this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,this._mergeConfig({...t,...this.kwargs}))}async *transform(e,t){yield*this.bound.transform(e,this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&I.isRunnable(e.bound)}}class j extends I{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new j({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}}class N extends C{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(a))}async _invoke(e,t,r){return i(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let n={};try{await i(async i=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(i,t?.[e],r?.[e])),c=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&(s=t),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class R extends I{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=await E(t),i=await a?.handleChainStart(this.toJSON(),A(e,"input")),n=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r];n=await a.invoke(n,this._patchConfig(t,i?.getChild(`seq:step:${r+1}`)))}r=await this.last.invoke(n,this._patchConfig(t,i?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(A(r,"output")),r}async batch(e,t,r){let a;let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(E)),s=await Promise.all(n.map((t,r)=>t?.handleChainStart(this.toJSON(),A(e[r],"input")))),o=e;try{let e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){let a=e[t];o=await a.batch(o,s.map((e,r)=>this._patchConfig(i[r],e?.getChild(`seq:step:${t+1}`))),r)}a=await this.last.batch(o,s.map(e=>this._patchConfig(i[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`))),r)}catch(e){throw await Promise.all(s.map(t=>t?.handleChainError(e))),e}return await Promise.all(s.map((e,t)=>e?.handleChainEnd(A(a[t],"output")))),a}async *_streamIterator(e,t){let r;let a=await E(t),i=await a?.handleChainStart(this.toJSON(),A(e,"input")),n=e,s=[this.first,...this.middle,this.last],o=Math.min(s.length-1,s.length-[...s].reverse().findIndex(e=>{let t=e.transform===I.prototype.transform,r=C.isRunnableBinding(e)&&e.bound?.transform===I.prototype.transform;return t||r})-1);try{let e=s.slice(0,o);for(let r=0;r<e.length;r+=1){let a=e[r];n=await a.invoke(n,this._patchConfig(t,i?.getChild(`seq:step:${r+1}`)))}}catch(e){throw await i?.handleChainError(e),e}let l=!0;try{let e=await s[o]._streamIterator(n,this._patchConfig(t,i?.getChild(`seq:step:${o+1}`))),a=s.slice(o+1);for(let r=0;r<a.length;r+=1){let n=a[r];e=await n.transform(e,this._patchConfig(t,i?.getChild(`seq:step:${o+r+2}`)))}for await(let t of e)if(yield t,l){if(void 0===r)r=t;else try{r=r.concat(t)}catch(e){r=void 0,l=!1}}}catch(e){throw await i?.handleChainError(e),e}await i?.handleChainEnd(A(r,"output"))}pipe(e){return new R(R.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}:{first:this.first,middle:[...this.middle,this.last],last:$(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&I.isRunnable(e)}static from([e,...t]){return new R({first:$(e),middle:t.slice(0,-1).map($),last:$(t[t.length-1])})}}class L extends I{static lc_name(){return"RunnableMap"}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=$(r)}async invoke(e,t){let r=await E(t),a=await r?.handleChainStart(this.toJSON(),{input:e}),i={};try{await Promise.all(Object.entries(this.steps).map(async([r,n])=>{i[r]=await n.invoke(e,this._patchConfig(t,a?.getChild(r)))}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(i),i}}class M extends I{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async _invoke(e,t,r){let a=await this.func(e);return a&&I.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r?.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class D extends I{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let a=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),i=await a?.handleChainStart(this.toJSON(),A(e,"input"));for(let a of this.runnables())try{let r=await a.invoke(e,this._patchConfig(t,i?.getChild()));return await i?.handleChainEnd(A(r,"output")),r}catch(e){void 0===r&&(r=e)}if(void 0===r)throw Error("No error stored at end of fallback.");throw await i?.handleChainError(r),r}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),s=await Promise.all(i.map(e=>n.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata))),o=await Promise.all(s.map((t,r)=>t?.handleChainStart(this.toJSON(),A(e[r],"input"))));for(let t of this.runnables())try{let a=await t.batch(e,o.map((e,t)=>this._patchConfig(i[t],e?.getChild())),r);return await Promise.all(o.map((e,t)=>e?.handleChainEnd(A(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(o.map(e=>e?.handleChainError(a))),a}}function $(e){if("function"==typeof e)return new M({func:e});if(I.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=$(a);return new L({steps:t})}}},8454:(e,t,r)=>{"use strict";r.d(t,{V:()=>i});var a=r(6899);class i extends a.oV{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}},8916:(e,t,r)=>{"use strict";r.d(t,{UA:()=>l,YE:()=>s,wL:()=>o});var a=r(361),i=r(1788),n=r(5506);class s extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class o extends n.BD{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,t)}async call(e,t,r){let a,n;try{a=await this.schema.parseAsync(e)}catch(t){throw new s("Received tool input did not match expected schema",JSON.stringify(e))}let o=(0,i.QH)(t),l=await i.Ye.configure(o.callbacks,this.callbacks,o.tags||r,this.tags,o.metadata,this.metadata,{verbose:this.verbose}),u=await l?.handleToolStart(this.toJSON(),"string"==typeof a?a:JSON.stringify(a));try{n=await this._call(a,u)}catch(e){throw await u?.handleToolError(e),e}return await u?.handleToolEnd(n),n}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:a.z.object({input:a.z.string().optional()}).transform(e=>e.input)})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}}},7175:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var a=r(8916);class i extends a.wL{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}_call(e,t){return this.func(e,t)}}},7406:(e,t,r)=>{"use strict";r(635),r(8916),r(2345)},8308:(e,t,r)=>{"use strict";r(8916)},7519:(e,t,r)=>{"use strict";r(247),r(8916)},6399:(e,t,r)=>{"use strict";r(8916),r(223),r(64),r(2345)},64:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var a=r(1333),i=r(6519);let n=[400,401,402,403,404,405,406,407,408,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&n.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;let t=i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>a(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},1674:(e,t,r)=>{"use strict";function a(e){let{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:a,azureOpenAIBasePath:i,baseURL:n}=e;if(a&&i&&t)return`${i}/${t}`;if(a){if(!r)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return n}r.d(t,{O:()=>a})},7016:(e,t,r)=>{"use strict";let a;r.d(t,{lS:()=>d,sA:()=>c});let i=()=>!1,n=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,s=()=>"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),o=()=>"undefined"!=typeof Deno,l=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!o(),u=()=>i()?"browser":l()?"node":n()?"webworker":s()?"jsdom":o()?"deno":"other";async function c(){if(void 0===a){let e=u();a={library:"langchain-js",runtime:e}}return a}function d(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},4541:(e,t,r)=>{"use strict";r.d(t,{K:()=>i});var a=r(7615);function i(e){let t;return e.constructor.name===a.zo.name?(t=Error(e.message)).name="TimeoutError":e.constructor.name===a.Qr.name?(t=Error(e.message)).name="AbortError":t=e,t}},8210:(e,t,r)=>{"use strict";r.d(t,{b:()=>f});var a,i,n,s,o=Object.defineProperty,l=r(551),u=class{constructor(e,t){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder("utf-8"),this.rankMap=new Map,this.textMap=new Map,this.patStr=e.pat_str;let r=e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...i]=t.split(" "),n=Number.parseInt(a,10);return i.forEach((t,r)=>e[t]=n+r),e},{});for(let[e,t]of Object.entries(r)){let r=l.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),i=u.specialTokenRegex(Object.keys(this.specialTokens)),n=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=u.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;i.lastIndex=r,!(null==(t=i.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){n.push(r);continue}n.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let i=0;i<r.length-1;i++){let n=e.slice(r[i].start,r[i+1].end),s=t.get(n.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,i])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];n.push(u),l=t.index+t[0].length}return n}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let i=e[a],n=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=n&&(t.push(n),r+=n.length)}let a=new Uint8Array(r),i=0;for(let e of t)a.set(e,i),i+=e.length;return this.textDecoder.decode(a)}};s="specialTokenRegex",a=u,i="symbol"!=typeof s?s+"":s,n=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),i in a?o(a,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[i]=n;var c=r(64);let d={},h=new c.L({});async function p(e,t){return e in d||(d[e]=h.fetch(`https://tiktoken.pages.dev/js/${e}.json`,{signal:t?.signal}).then(e=>e.json()).catch(t=>{throw delete d[e],t})),new u(await d[e],t?.extendedSpecialTokens)}async function f(e,t){return p(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw Error("Unknown model")}}(e),t)}},7254:(e,t,r)=>{"use strict";r.d(t,{V:()=>c});var a=r(7615),i=r(7016);let n=(e,t)=>e.reduce((e,r,a)=>{let i=Math.floor(a/t),n=e[i]||[];return e[i]=n.concat([r]),e},[]);var s=r(64);class o{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new s.L(e??{})}}var l=r(1674),u=r(4541);class c extends o{constructor(e,t){let r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a=r?.openAIApiKey??(0,i.lS)("OPENAI_API_KEY"),n=r?.azureOpenAIApiKey??(0,i.lS)("AZURE_OPENAI_API_KEY");if(!n&&!a)throw Error("OpenAI or Azure OpenAI API key not found");let s=r?.azureOpenAIApiInstanceName??(0,i.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),o=(r?.azureOpenAIApiEmbeddingsDeploymentName||r?.azureOpenAIApiDeploymentName)??((0,i.lS)("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||(0,i.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME")),l=r?.azureOpenAIApiVersion??(0,i.lS)("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=r?.azureOpenAIBasePath??(0,i.lS)("AZURE_OPENAI_BASE_PATH"),this.modelName=r?.modelName??this.modelName,this.batchSize=r?.batchSize??(n?1:this.batchSize),this.stripNewLines=r?.stripNewLines??this.stripNewLines,this.timeout=r?.timeout,this.azureOpenAIApiVersion=l,this.azureOpenAIApiKey=n,this.azureOpenAIApiInstanceName=s,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw Error("Azure OpenAI API version not found");a=a??""}this.clientConfig={apiKey:a,baseURL:t?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params,...t}}async embedDocuments(e){let t=n(this.stripNewLines?e.map(e=>e.replace(/\n/g," ")):e,this.batchSize),r=t.map(e=>this.embeddingWithRetry({model:this.modelName,input:e})),a=await Promise.all(r),i=[];for(let e=0;e<a.length;e+=1){let r=t[e],{data:n}=a[e];for(let e=0;e<r.length;e+=1)i.push(n[e].embedding)}return i}async embedQuery(e){let{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){let e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,l.O)(e),r={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};r.baseURL||delete r.baseURL,this.client=new a.Pp(r)}let t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{let r=await this.client.embeddings.create(e,t);return r}catch(t){let e=(0,u.K)(t);throw e}})}}},2234:(e,t,r)=>{"use strict";r.d(t,{sW:()=>a.s,V:()=>i.V});var a=r(7021);r(6532),r(2571);var i=r(8454);r(64),r(3065),r(8039),r(6899),r(9696)},8927:(e,t,r)=>{"use strict";r.d(t,{J:()=>a.J,gY:()=>a.gY,xk:()=>a.xk});var a=r(6899)},4461:(e,t,r)=>{"use strict";r.d(t,{g:()=>c});var a=r(1788),i=r(4978);class n extends i.eq{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){let r=(0,a.QH)(t),i=await a.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),n=await i?.handleRetrieverStart(this.toJSON(),e);try{let t=await this._getRelevantDocuments(e,n);return await n?.handleRetrieverEnd(t),t}catch(e){throw await n?.handleRetrieverError(e),e}}}var s=r(2345);class o extends n{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","base"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!=typeof this.vectorStore.maxMarginalRelevanceSearch)throw Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class l extends s.i{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw Error("Not implemented.")}async similaritySearch(e,t=4,r,a){let i=await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r);return i.map(e=>e[0])}async similaritySearchWithScore(e,t=4,r,a){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,a){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,a,i,n){if("number"==typeof e)return new o({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:i,verbose:n,callbacks:r});{let t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new o(e?.searchType==="mmr"?{...t,searchKwargs:e.searchKwargs}:{...t})}}}var u=r(6172);class c extends l{_vectorstoreType(){return"supabase"}constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"upsertBatchSize",{enumerable:!0,configurable:!0,writable:!0,value:500}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter,this.upsertBatchSize=t.upsertBatchSize??this.upsertBatchSize}async addDocuments(e,t){let r=e.map(({pageContent:e})=>e);return this.addVectors(await this.embeddings.embedDocuments(r),e,t)}async addVectors(e,t,r){let a=e.map((e,r)=>({content:t[r].pageContent,embedding:e,metadata:t[r].metadata})),i=[];for(let e=0;e<a.length;e+=this.upsertBatchSize){let t=a.slice(e,e+this.upsertBatchSize).map((t,a)=>r?.ids?{id:r.ids[e+a],...t}:t),n=await this.client.from(this.tableName).upsert(t).select();if(n.error)throw Error(`Error inserting: ${n.error.message} ${n.status} ${n.statusText}`);n.data&&(i=i.concat(n.data.map(e=>e.id)))}return i}async delete(e){let{ids:t}=e;for(let e of t)await this.client.from(this.tableName).delete().eq("id",e)}async similaritySearchVectorWithScore(e,t,r){let a;if(r&&this.filter)throw Error("cannot provide both `filter` and `this.filter`");let i=r??this.filter??{},n={query_embedding:e};if("function"==typeof i)a=e=>i(e).limit(t);else if("object"==typeof i)n.filter=i,n.match_count=t,a=e=>e;else throw Error("invalid filter type");let s=this.client.rpc(this.queryName,n),{data:o,error:l}=await a(s);if(l)throw Error(`Error searching for documents: ${l.code} ${l.message} ${l.details}`);let c=o.map(e=>[new u.B({metadata:e.metadata,pageContent:e.content}),e.similarity]);return c}static async fromTexts(e,t,r,a){let i=[];for(let r=0;r<e.length;r+=1){let a=Array.isArray(t)?t[r]:t,n=new u.B({pageContent:e[r],metadata:a});i.push(n)}return c.fromDocuments(i,r,a)}static async fromDocuments(e,t,r){let a=new this(t,r);return await a.addDocuments(e),a}static async fromExistingIndex(e,t){let r=new this(e,t);return r}}},7615:(e,t,r)=>{"use strict";let a;r.d(t,{zo:()=>eV,Qr:()=>eK,Pp:()=>eZ});var i,n,s={};r.r(s),r.d(s,{APIConnectionError:()=>f,APIConnectionTimeoutError:()=>m,APIError:()=>h,APIUserAbortError:()=>p,AuthenticationError:()=>y,BadRequestError:()=>g,ConflictError:()=>_,InternalServerError:()=>P,NotFoundError:()=>b,PermissionDeniedError:()=>v,RateLimitError:()=>x,UnprocessableEntityError:()=>w});let o="4.4.0";var l=r(6195).Buffer;class u{constructor(e,t){this.response=e,this.controller=t,this.decoder=new c}async *iterMessages(){if(!this.response.body)throw this.controller.abort(),Error("Attempted to iterate over a response with no body");let e=new d,t=function(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}(this.response.body);for await(let r of t)for(let t of e.decode(r)){let e=this.decoder.decode(t);e&&(yield e)}for(let t of e.flush()){let e=this.decoder.decode(t);e&&(yield e)}}async *[Symbol.asyncIterator](){let e=!1;try{for await(let t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(null===t.event)try{yield JSON.parse(t.data)}catch(e){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),e}}e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||this.controller.abort()}}}class c{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return a.startsWith(" ")&&(a=a.substring(1)),"event"===t?this.event=a:"data"===t&&this.data.push(a),null}}class d{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=d.NEWLINE_CHARS.has(t[t.length-1]||""),a=t.split(d.NEWLINE_REGEXP);return 1!==a.length||r?(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a):(this.buffer.push(a[0]),[])}decodeText(e){var t;if(null==e)return"";if("string"==typeof e)return e;if(void 0!==l){if(e instanceof l)return e.toString();if(e instanceof Uint8Array)return l.from(e).toString();throw Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return null!==(t=this.textDecoder)&&void 0!==t||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}d.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","\x1c","\x1d","\x1e","\x85","\u2028","\u2029"]),d.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;class h extends Error{constructor(e,t,r,a){super(h.makeMessage(t,r)),this.status=e,this.headers=a,this.error=t,this.code=null==t?void 0:t.code,this.param=null==t?void 0:t.param,this.type=null==t?void 0:t.type}static makeMessage(e,t){return(null==e?void 0:e.message)?"string"==typeof e.message?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"Unknown error occurred"}static generate(e,t,r,a){if(!e)return new f({cause:ec(t)});let i=null==t?void 0:t.error;return 400===e?new g(e,i,r,a):401===e?new y(e,i,r,a):403===e?new v(e,i,r,a):404===e?new b(e,i,r,a):409===e?new _(e,i,r,a):422===e?new w(e,i,r,a):429===e?new x(e,i,r,a):e>=500?new P(e,i,r,a):new h(e,i,r,a)}}class p extends h{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class f extends h{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class m extends f{constructor(){super({message:"Request timed out."})}}class g extends h{constructor(){super(...arguments),this.status=400}}class y extends h{constructor(){super(...arguments),this.status=401}}class v extends h{constructor(){super(...arguments),this.status=403}}class b extends h{constructor(){super(...arguments),this.status=404}}class _ extends h{constructor(){super(...arguments),this.status=409}}class w extends h{constructor(){super(...arguments),this.status=422}}class x extends h{constructor(){super(...arguments),this.status=429}}class P extends h{}let O=e=>{},T=fetch.bind(void 0),S=FormData,E="undefined"!=typeof File?File:class extends Blob{constructor(){throw Error("file uploads aren't supported in this environment yet as 'File' is not defined")}};async function k(e,t){return{...t,body:new Z(e)}}async function A(){throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")}var I=r(6195).Buffer;let C=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,j=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&N(e),N=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,R=e=>j(e)||C(e)||!1;async function L(e,t,r={}){var a,i,n,s,o;if(C(e=await e)){let i=await e.blob();return t||(t=null!==(a=new URL(e.url).pathname.split(/[\\/]/).pop())&&void 0!==a?a:"unknown_file"),new E([i],t,r)}let l=await M(e);if(t||(t=null!==(i=D((s=e).name)||D(s.filename)||(null===(o=D(s.path))||void 0===o?void 0:o.split(/[\\/]/).pop()))&&void 0!==i?i:"unknown_file"),!r.type){let e=null===(n=l[0])||void 0===n?void 0:n.type;"string"==typeof e&&(r={...r,type:e})}return new E(l,t,r)}async function M(e){var t;let r=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)r.push(e);else if(N(e))r.push(await e.arrayBuffer());else if($(e))for await(let t of e)r.push(t);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return r}let D=e=>"string"==typeof e?e:void 0!==I&&e instanceof I?String(e):void 0,$=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator];class Z{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}let U=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],B=async e=>{let t=await V(e.body);return k(t,e)},V=async e=>{let t=new S;return await Promise.all(Object.entries(e||{}).map(([e,r])=>K(t,e,r))),t},K=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(R(r)){let a=await L(r);e.append(t,a)}else if(Array.isArray(r))await Promise.all(r.map(r=>K(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,a])=>K(e,`${t}[${r}]`,a)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var z=r(6195).Buffer,F=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},q=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};async function H(e){let{response:t}=e;if(e.options.stream)return new u(t,e.controller);let r=t.headers.get("content-type");if(null==r?void 0:r.includes("application/json")){let e=await t.json();return ep("response",t.status,t.url,t.headers,e),e}let a=await t.text();return ep("response",t.status,t.url,t.headers,a),a}class G extends Promise{constructor(e,t=H){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new G(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class J{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=eu("maxRetries",null!=t?t:2),this.timeout=eu("timeout",r),this.httpAgent=a,this.fetch=null!=i?i:T}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ei(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ef()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==z)return z.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){let t=new TextEncoder,r=t.encode(e);return r.length.toString()}}return null}buildRequest(e){var t,r,a,i,n,s;let{method:o,path:l,query:u,headers:c={}}=e,d=U(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,h=this.calculateContentLength(d),p=this.buildURL(l,u);"timeout"in e&&eu("timeout",e.timeout);let f=null!==(t=e.timeout)&&void 0!==t?t:this.timeout,m=null!==(a=null!==(r=e.httpAgent)&&void 0!==r?r:this.httpAgent)&&void 0!==a?a:O(p),g=f+1e3;"number"==typeof(null===(i=null==m?void 0:m.options)||void 0===i?void 0:i.timeout)&&g>(null!==(n=m.options.timeout)&&void 0!==n?n:0)&&(m.options.timeout=g),this.idempotencyHeader&&"get"!==o&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=e.idempotencyKey);let y={...h&&{"Content-Length":h},...this.defaultHeaders(e),...c};U(e.body)&&delete y["Content-Type"],Object.keys(y).forEach(e=>null===y[e]&&delete y[e]);let v={method:o,...d&&{body:d},headers:y,...m&&{agent:m},signal:null!==(s=e.signal)&&void 0!==s?s:null};return this.validateHeaders(y,c),{req:v,url:p,timeout:f}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,a){return h.generate(e,t,r,a)}request(e,t=null){return new G(this.makeRequest(e,t))}async makeRequest(e,t){var r,a,i;let n=await e;null==t&&(t=null!==(r=n.maxRetries)&&void 0!==r?r:this.maxRetries);let{req:s,url:o,timeout:l}=this.buildRequest(n);if(await this.prepareRequest(s,{url:o,options:n}),ep("request",o,n,s.headers),null===(a=n.signal)||void 0===a?void 0:a.aborted)throw new p;let u=new AbortController,c=await this.fetchWithTimeout(o,s,l,u).catch(ec);if(c instanceof Error){if(null===(i=n.signal)||void 0===i?void 0:i.aborted)throw new p;if(t)return this.retryRequest(n,t);if("AbortError"===c.name)throw new m;throw new f({cause:c})}let d=Q(c.headers);if(!c.ok){if(t&&this.shouldRetry(c))return this.retryRequest(n,t,d);let e=await c.text().catch(()=>"Unknown"),r=en(e),a=r?void 0:e;ep("response",c.status,o,d,a);let i=this.makeStatusError(c.status,r,a,d);throw i}return{response:c,options:n,controller:u}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new Y(this,r,e)}buildURL(e,t){let r=new URL(eo(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return eh(a)||(t={...a,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw Error(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){let{signal:i,...n}=t||{};i&&i.addEventListener("abort",()=>a.abort());let s=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch(e,{signal:a.signal,...n}).finally(()=>{clearTimeout(s)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){var a;t-=1;let i=parseInt((null==r?void 0:r["retry-after"])||""),n=null!==(a=e.maxRetries)&&void 0!==a?a:this.maxRetries,s=1e3*this.calculateRetryTimeoutSeconds(t,i,n);return await el(s),this.makeRequest(e,t)}calculateRetryTimeoutSeconds(e,t,r){return Number.isInteger(t)&&t<=60?t:Math.min(.5*Math.pow(r-e-1,2),2)+(Math.random()-.5)}getUserAgent(){return`${this.constructor.name}/JS ${o}`}}class W{constructor(e,t,r,a){i.set(this,void 0),F(this,i,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){let e=this.getPaginatedItems();return!!e.length&&null!=this.nextPageInfo()}async getNextPage(){let e=this.nextPageInfo();if(!e)throw Error("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[t,a]of r)e.url.searchParams.set(t,a);t.query=void 0,t.path=e.url.toString()}return await q(this,i,"f").requestAPIList(this.constructor,t)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(i=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class Y extends G{constructor(e,t,r){super(t,async t=>new r(e,t.response,await H(t),t.options))}async *[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}}let Q=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),X={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},ee=e=>"object"==typeof e&&null!==e&&!eh(e)&&Object.keys(e).every(e=>Object.prototype.hasOwnProperty.call(X,e)),et=()=>"undefined"!=typeof Deno&&null!=Deno.build?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o,"X-Stainless-OS":ea(Deno.build.os),"X-Stainless-Arch":er(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:edge-runtime","X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version},er=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ea=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",ei=()=>null!=a?a:a=et(),en=e=>{try{return JSON.parse(e)}catch(e){return}},es=RegExp("^(?:[a-z]+:)?//","i"),eo=e=>es.test(e),el=e=>new Promise(t=>setTimeout(t,e)),eu=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw Error(`${e} must be an integer`);if(t<0)throw Error(`${e} must be a positive integer`);return t},ec=e=>e instanceof Error?e:Error(e),ed=e=>{var t,r,a,i;return"undefined"!=typeof process?null!==(r=null===(t=process.env)||void 0===t?void 0:t[e])&&void 0!==r?r:void 0:"undefined"!=typeof Deno?null===(i=null===(a=Deno.env)||void 0===a?void 0:a.get)||void 0===i?void 0:i.call(a,e):void 0};function eh(e){if(!e)return!0;for(let t in e)return!1;return!0}function ep(e,...t){"undefined"!=typeof process&&"true"===process.env.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}let ef=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),em=()=>!1;class eg extends W{constructor(e,t,r,a){super(e,t,r,a),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}}class ey extends W{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(null===(e=this.data)||void 0===e?void 0:e.length))return null;let r=null===(t=this.data[this.data.length-1])||void 0===t?void 0:t.id;return r?{params:{after:r}}:null}}class ev{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}}class eb extends ev{create(e,t){return this.post("/audio/transcriptions",B({body:e,...t}))}}eb||(eb={});class e_ extends ev{create(e,t){return this.post("/audio/translations",B({body:e,...t}))}}e_||(e_={});class ew extends ev{constructor(){super(...arguments),this.transcriptions=new eb(this.client),this.translations=new e_(this.client)}}!function(e){e.Transcriptions=eb,e.Translations=e_}(ew||(ew={}));class ex extends ev{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:null!==(r=e.stream)&&void 0!==r&&r})}}ex||(ex={});class eP extends ev{constructor(){super(...arguments),this.completions=new ex(this.client)}}(eP||(eP={})).Completions=ex;class eO extends ev{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:null!==(r=e.stream)&&void 0!==r&&r})}}eO||(eO={});class eT extends ev{create(e,t){return this.post("/embeddings",{body:e,...t})}}eT||(eT={});class eS extends ev{create(e,t){return this.post("/edits",{body:e,...t})}}eS||(eS={});class eE extends ev{create(e,t){return this.post("/files",B({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",ek,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...null==t?void 0:t.headers}})}}class ek extends eg{}eE||(eE={});class eA extends ev{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",eI,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var a;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:null!==(a=null==t?void 0:t.stream)&&void 0!==a&&a})}}class eI extends eg{}eA||(eA={});class eC extends ev{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",ej,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ee(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,eN,{query:t,...r})}}class ej extends ey{}class eN extends ey{}eC||(eC={});class eR extends ev{constructor(){super(...arguments),this.jobs=new eC(this.client)}}!function(e){e.Jobs=eC,e.FineTuningJobsPage=ej,e.FineTuningJobEventsPage=eN}(eR||(eR={}));class eL extends ev{createVariation(e,t){return this.post("/images/variations",B({body:e,...t}))}edit(e,t){return this.post("/images/edits",B({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}}eL||(eL={});class eM extends ev{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",eD,e)}del(e,t){return this.delete(`/models/${e}`,t)}}class eD extends eg{}eM||(eM={});class e$ extends ev{create(e,t){return this.post("/moderations",{body:e,...t})}}e$||(e$={});class eZ extends J{constructor(e){var t,r,{apiKey:a=ed("OPENAI_API_KEY"),organization:i=null!==(t=ed("OPENAI_ORG_ID"))&&void 0!==t?t:null,...n}=void 0===e?{}:e;if(void 0===a)throw Error("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");let s={apiKey:a,organization:i,baseURL:"https://api.openai.com/v1",...n};if(!s.dangerouslyAllowBrowser&&em())throw Error("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:null!==(r=s.timeout)&&void 0!==r?r:6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new eO(this),this.chat=new eP(this),this.edits=new eS(this),this.embeddings=new eT(this),this.files=new eE(this),this.images=new eL(this),this.audio=new ew(this),this.moderations=new e$(this),this.models=new eM(this),this.fineTuning=new eR(this),this.fineTunes=new eA(this),this._options=s,this.apiKey=a,this.organization=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}n=eZ,eZ.OpenAI=n,eZ.APIError=h,eZ.APIConnectionError=f,eZ.APIConnectionTimeoutError=m,eZ.APIUserAbortError=p,eZ.NotFoundError=b,eZ.ConflictError=_,eZ.RateLimitError=x,eZ.BadRequestError=g,eZ.AuthenticationError=y,eZ.InternalServerError=P,eZ.PermissionDeniedError=v,eZ.UnprocessableEntityError=w;let{APIError:eU,APIConnectionError:eB,APIConnectionTimeoutError:eV,APIUserAbortError:eK,NotFoundError:ez,ConflictError:eF,RateLimitError:eq,BadRequestError:eH,AuthenticationError:eG,InternalServerError:eJ,PermissionDeniedError:eW,UnprocessableEntityError:eY}=s;!function(e){e.toFile=L,e.fileFromPath=A,e.Page=eg,e.CursorPage=ey,e.Completions=eO,e.Chat=eP,e.Edits=eS,e.Embeddings=eT,e.Files=eE,e.FileObjectsPage=ek,e.Images=eL,e.Audio=ew,e.Moderations=e$,e.Models=eM,e.ModelsPage=eD,e.FineTuning=eR,e.FineTunes=eA,e.FineTunesPage=eI}(eZ||(eZ={}))},361:(e,t,r)=>{"use strict";let a;r.d(t,{z:()=>e3}),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(eX||(eX={})),(e0||(e0={})).mergeShapes=(e,t)=>({...e,...t});let i=eX.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),n=e=>{let t=typeof e;switch(t){case"undefined":return i.undefined;case"string":return i.string;case"number":return isNaN(e)?i.nan:i.number;case"boolean":return i.boolean;case"function":return i.function;case"bigint":return i.bigint;case"symbol":return i.symbol;case"object":if(Array.isArray(e))return i.array;if(null===e)return i.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return i.promise;if("undefined"!=typeof Map&&e instanceof Map)return i.map;if("undefined"!=typeof Set&&e instanceof Set)return i.set;if("undefined"!=typeof Date&&e instanceof Date)return i.date;return i.object;default:return i.unknown}},s=eX.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class o extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a],n=a===i.path.length-1;n?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,eX.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}o.create=e=>{let t=new o(e);return t};let l=(e,t)=>{let r;switch(e.code){case s.invalid_type:r=e.received===i.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case s.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,eX.jsonStringifyReplacer)}`;break;case s.unrecognized_keys:r=`Unrecognized key(s) in object: ${eX.joinValues(e.keys,", ")}`;break;case s.invalid_union:r="Invalid input";break;case s.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${eX.joinValues(e.options)}`;break;case s.invalid_enum_value:r=`Invalid enum value. Expected ${eX.joinValues(e.options)}, received '${e.received}'`;break;case s.invalid_arguments:r="Invalid function arguments";break;case s.invalid_return_type:r="Invalid function return type";break;case s.invalid_date:r="Invalid date";break;case s.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:eX.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case s.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case s.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case s.custom:r="Invalid input";break;case s.invalid_intersection_types:r="Intersection results could not be merged";break;case s.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case s.not_finite:r="Number must be finite";break;default:r=t.defaultError,eX.assertNever(e)}return{message:r}},u=l,c=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,n=[...r,...i.path||[]],s={...i,path:n},o="",l=a.filter(e=>!!e).slice().reverse();for(let e of l)o=e(s,{data:t,defaultError:o}).message;return{...i,path:n,message:i.message||o}};function d(e,t){let r=c({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,u,l].filter(e=>!!e)});e.common.issues.push(r)}class h{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return p;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t)r.push({key:await e.key,value:await e.value});return h.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:i}=a;if("aborted"===t.status||"aborted"===i.status)return p;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||a.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let p=Object.freeze({status:"aborted"}),f=e=>({status:"dirty",value:e}),m=e=>({status:"valid",value:e}),g=e=>"aborted"===e.status,y=e=>"dirty"===e.status,v=e=>"valid"===e.status,b=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(e1||(e1={}));class _{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let w=(e,t)=>{if(v(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new o(e.common.issues);return this._error=t,this._error}}};function x(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=a?a:t.defaultError}:{message:null!=r?r:t.defaultError},description:i}}class P{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return n(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:n(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new h,ctx:{common:e.parent.common,data:e.data,parsedType:n(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(b(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:n(e)},i=this._parseSync({data:e,path:a.path,parent:a});return w(a,i)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:n(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await (b(a)?a:Promise.resolve(a));return w(r,i)}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),n=()=>a.addIssue({code:s.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(n(),!1)):!!i||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new eo({schema:this,typeName:e2.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return el.create(this,this._def)}nullable(){return eu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return z.create(this,this._def)}promise(){return es.create(this,this._def)}or(e){return q.create([this,e],this._def)}and(e){return J.create(this,e,this._def)}transform(e){return new eo({...x(this._def),schema:this,typeName:e2.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ec({...x(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:e2.ZodDefault})}brand(){return new ef({typeName:e2.ZodBranded,type:this,...x(this._def)})}catch(e){return new ed({...x(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:e2.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return em.create(this,e)}readonly(){return eg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let O=/^c[^\s-]{8,}$/i,T=/^[a-z][a-z0-9]*$/,S=/^[0-9A-HJKMNP-TV-Z]{26}$/,E=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,k=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,A=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,I=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,C=e=>e.precision?e.offset?RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class j extends P{_parse(e){let t;this._def.coerce&&(e.data=String(e.data));let r=this._getType(e);if(r!==i.string){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.string,received:t.parsedType}),p}let n=new h;for(let r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if("max"===r.kind)e.data.length>r.value&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if("length"===r.kind){let a=e.data.length>r.value,i=e.data.length<r.value;(a||i)&&(t=this._getOrReturnCtx(e,t),a?d(t,{code:s.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):i&&d(t,{code:s.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),n.dirty())}else if("email"===r.kind)k.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"email",code:s.invalid_string,message:r.message}),n.dirty());else if("emoji"===r.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:s.invalid_string,message:r.message}),n.dirty());else if("uuid"===r.kind)E.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:s.invalid_string,message:r.message}),n.dirty());else if("cuid"===r.kind)O.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:s.invalid_string,message:r.message}),n.dirty());else if("cuid2"===r.kind)T.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:s.invalid_string,message:r.message}),n.dirty());else if("ulid"===r.kind)S.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:s.invalid_string,message:r.message}),n.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(a){d(t=this._getOrReturnCtx(e,t),{validation:"url",code:s.invalid_string,message:r.message}),n.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;let a=r.regex.test(e.data);a||(d(t=this._getOrReturnCtx(e,t),{validation:"regex",code:s.invalid_string,message:r.message}),n.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(d(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),n.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(d(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{startsWith:r.value},message:r.message}),n.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(d(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{endsWith:r.value},message:r.message}),n.dirty());else if("datetime"===r.kind){let a=C(r);a.test(e.data)||(d(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:"datetime",message:r.message}),n.dirty())}else if("ip"===r.kind){var o,l;o=e.data,("v4"===(l=r.version)||!l)&&A.test(o)||("v6"===l||!l)&&I.test(o)||(d(t=this._getOrReturnCtx(e,t),{validation:"ip",code:s.invalid_string,message:r.message}),n.dirty())}else eX.assertNever(r);return{status:n.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:s.invalid_string,...e1.errToObj(r)})}_addCheck(e){return new j({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...e1.errToObj(e)})}url(e){return this._addCheck({kind:"url",...e1.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...e1.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...e1.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...e1.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...e1.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...e1.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...e1.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...e1.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...e1.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...e1.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...e1.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...e1.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...e1.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...e1.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...e1.errToObj(t)})}nonempty(e){return this.min(1,e1.errToObj(e))}trim(){return new j({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new j({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new j({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}j.create=e=>{var t;return new j({checks:[],typeName:e2.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...x(e)})};class N extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;this._def.coerce&&(e.data=Number(e.data));let r=this._getType(e);if(r!==i.number){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.number,received:t.parsedType}),p}let a=new h;for(let r of this._def.checks)if("int"===r.kind)eX.isInteger(e.data)||(d(t=this._getOrReturnCtx(e,t),{code:s.invalid_type,expected:"integer",received:"float",message:r.message}),a.dirty());else if("min"===r.kind){let i=r.inclusive?e.data<r.value:e.data<=r.value;i&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else if("max"===r.kind){let i=r.inclusive?e.data>r.value:e.data>=r.value;i&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else"multipleOf"===r.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a,n=parseInt(e.toFixed(i).replace(".","")),s=parseInt(t.toFixed(i).replace(".",""));return n%s/Math.pow(10,i)}(e.data,r.value)&&(d(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(d(t=this._getOrReturnCtx(e,t),{code:s.not_finite,message:r.message}),a.dirty()):eX.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,e1.toString(t))}gt(e,t){return this.setLimit("min",e,!1,e1.toString(t))}lte(e,t){return this.setLimit("max",e,!0,e1.toString(t))}lt(e,t){return this.setLimit("max",e,!1,e1.toString(t))}setLimit(e,t,r,a){return new N({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:e1.toString(a)}]})}_addCheck(e){return new N({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:e1.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:e1.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:e1.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:e1.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:e1.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:e1.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:e1.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:e1.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:e1.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&eX.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}N.create=e=>new N({checks:[],typeName:e2.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...x(e)});class R extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;this._def.coerce&&(e.data=BigInt(e.data));let r=this._getType(e);if(r!==i.bigint){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.bigint,received:t.parsedType}),p}let a=new h;for(let r of this._def.checks)if("min"===r.kind){let i=r.inclusive?e.data<r.value:e.data<=r.value;i&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else if("max"===r.kind){let i=r.inclusive?e.data>r.value:e.data>=r.value;i&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(d(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):eX.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,e1.toString(t))}gt(e,t){return this.setLimit("min",e,!1,e1.toString(t))}lte(e,t){return this.setLimit("max",e,!0,e1.toString(t))}lt(e,t){return this.setLimit("max",e,!1,e1.toString(t))}setLimit(e,t,r,a){return new R({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:e1.toString(a)}]})}_addCheck(e){return new R({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:e1.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:e1.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:e1.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:e1.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:e1.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}R.create=e=>{var t;return new R({checks:[],typeName:e2.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...x(e)})};class L extends P{_parse(e){this._def.coerce&&(e.data=!!e.data);let t=this._getType(e);if(t!==i.boolean){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.boolean,received:t.parsedType}),p}return m(e.data)}}L.create=e=>new L({typeName:e2.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...x(e)});class M extends P{_parse(e){let t;this._def.coerce&&(e.data=new Date(e.data));let r=this._getType(e);if(r!==i.date){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.date,received:t.parsedType}),p}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_date}),p}let a=new h;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),a.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(d(t=this._getOrReturnCtx(e,t),{code:s.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),a.dirty()):eX.assertNever(r);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new M({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:e1.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:e1.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}M.create=e=>new M({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:e2.ZodDate,...x(e)});class D extends P{_parse(e){let t=this._getType(e);if(t!==i.symbol){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.symbol,received:t.parsedType}),p}return m(e.data)}}D.create=e=>new D({typeName:e2.ZodSymbol,...x(e)});class $ extends P{_parse(e){let t=this._getType(e);if(t!==i.undefined){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.undefined,received:t.parsedType}),p}return m(e.data)}}$.create=e=>new $({typeName:e2.ZodUndefined,...x(e)});class Z extends P{_parse(e){let t=this._getType(e);if(t!==i.null){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.null,received:t.parsedType}),p}return m(e.data)}}Z.create=e=>new Z({typeName:e2.ZodNull,...x(e)});class U extends P{constructor(){super(...arguments),this._any=!0}_parse(e){return m(e.data)}}U.create=e=>new U({typeName:e2.ZodAny,...x(e)});class B extends P{constructor(){super(...arguments),this._unknown=!0}_parse(e){return m(e.data)}}B.create=e=>new B({typeName:e2.ZodUnknown,...x(e)});class V extends P{_parse(e){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.never,received:t.parsedType}),p}}V.create=e=>new V({typeName:e2.ZodNever,...x(e)});class K extends P{_parse(e){let t=this._getType(e);if(t!==i.undefined){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.void,received:t.parsedType}),p}return m(e.data)}}K.create=e=>new K({typeName:e2.ZodVoid,...x(e)});class z extends P{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==i.array)return d(t,{code:s.invalid_type,expected:i.array,received:t.parsedType}),p;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&(d(t,{code:e?s.too_big:s.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(d(t,{code:s.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(d(t,{code:s.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new _(t,e,t.path,r)))).then(e=>h.mergeArray(r,e));let n=[...t.data].map((e,r)=>a.type._parseSync(new _(t,e,t.path,r)));return h.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new z({...this._def,minLength:{value:e,message:e1.toString(t)}})}max(e,t){return new z({...this._def,maxLength:{value:e,message:e1.toString(t)}})}length(e,t){return new z({...this._def,exactLength:{value:e,message:e1.toString(t)}})}nonempty(e){return this.min(1,e)}}z.create=(e,t)=>new z({type:e,minLength:null,maxLength:null,exactLength:null,typeName:e2.ZodArray,...x(t)});class F extends P{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=eX.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){let t=this._getType(e);if(t!==i.object){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.object,received:t.parsedType}),p}let{status:r,ctx:a}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof V&&"strip"===this._def.unknownKeys))for(let e in a.data)o.includes(e)||l.push(e);let u=[];for(let e of o){let t=n[e],r=a.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new _(a,r,a.path,e)),alwaysSet:e in a.data})}if(this._def.catchall instanceof V){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of l)u.push({key:{status:"valid",value:e},value:{status:"valid",value:a.data[e]}});else if("strict"===e)l.length>0&&(d(a,{code:s.unrecognized_keys,keys:l}),r.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of l){let r=a.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new _(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of u){let r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>h.mergeObjectSync(r,e)):h.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return e1.errToObj,new F({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,i,n,s;let o=null!==(n=null===(i=(a=this._def).errorMap)||void 0===i?void 0:i.call(a,t,r).message)&&void 0!==n?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=e1.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new F({...this._def,unknownKeys:"strip"})}passthrough(){return new F({...this._def,unknownKeys:"passthrough"})}extend(e){return new F({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){let t=new F({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:e2.ZodObject});return t}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new F({...this._def,catchall:e})}pick(e){let t={};return eX.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new F({...this._def,shape:()=>t})}omit(e){let t={};return eX.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new F({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof F){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=el.create(e(i))}return new F({...t._def,shape:()=>r})}return t instanceof z?new z({...t._def,type:e(t.element)}):t instanceof el?el.create(e(t.unwrap())):t instanceof eu?eu.create(e(t.unwrap())):t instanceof W?W.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return eX.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new F({...this._def,shape:()=>t})}required(e){let t={};return eX.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r],a=e;for(;a instanceof el;)a=a._def.innerType;t[r]=a}}),new F({...this._def,shape:()=>t})}keyof(){return ea(eX.objectKeys(this.shape))}}F.create=(e,t)=>new F({shape:()=>e,unknownKeys:"strip",catchall:V.create(),typeName:e2.ZodObject,...x(t)}),F.strictCreate=(e,t)=>new F({shape:()=>e,unknownKeys:"strict",catchall:V.create(),typeName:e2.ZodObject,...x(t)}),F.lazycreate=(e,t)=>new F({shape:e,unknownKeys:"strip",catchall:V.create(),typeName:e2.ZodObject,...x(t)});class q extends P{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new o(e.ctx.common.issues));return d(t,{code:s.invalid_union,unionErrors:r}),p});{let e;let a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new o(e));return d(t,{code:s.invalid_union,unionErrors:i}),p}}get options(){return this._def.options}}q.create=(e,t)=>new q({options:e,typeName:e2.ZodUnion,...x(t)});let H=e=>{if(e instanceof et)return H(e.schema);if(e instanceof eo)return H(e.innerType());if(e instanceof er)return[e.value];if(e instanceof ei)return e.options;if(e instanceof en)return Object.keys(e.enum);if(e instanceof ec)return H(e._def.innerType);if(e instanceof $)return[void 0];else if(e instanceof Z)return[null];else return null};class G extends P{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.object)return d(t,{code:s.invalid_type,expected:i.object,received:t.parsedType}),p;let r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(d(t,{code:s.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),p)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=H(r.shape[e]);if(!t)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(a.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,r)}}return new G({typeName:e2.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...x(r)})}}class J extends P{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(g(e)||g(a))return p;let o=function e(t,r){let a=n(t),s=n(r);if(t===r)return{valid:!0,data:t};if(a===i.object&&s===i.object){let a=eX.objectKeys(r),i=eX.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of i){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};n[a]=i.data}return{valid:!0,data:n}}if(a===i.array&&s===i.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let n=t[i],s=r[i],o=e(n,s);if(!o.valid)return{valid:!1};a.push(o.data)}return{valid:!0,data:a}}return a===i.date&&s===i.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return o.valid?((y(e)||y(a))&&t.dirty(),{status:t.value,value:o.data}):(d(r,{code:s.invalid_intersection_types}),p)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}J.create=(e,t,r)=>new J({left:e,right:t,typeName:e2.ZodIntersection,...x(r)});class W extends P{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.array)return d(r,{code:s.invalid_type,expected:i.array,received:r.parsedType}),p;if(r.data.length<this._def.items.length)return d(r,{code:s.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),p;let a=this._def.rest;!a&&r.data.length>this._def.items.length&&(d(r,{code:s.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new _(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>h.mergeArray(t,e)):h.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new W({...this._def,rest:e})}}W.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new W({items:e,typeName:e2.ZodTuple,rest:null,...x(t)})};class Y extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.object)return d(r,{code:s.invalid_type,expected:i.object,received:r.parsedType}),p;let a=[],n=this._def.keyType,o=this._def.valueType;for(let e in r.data)a.push({key:n._parse(new _(r,e,r.path,e)),value:o._parse(new _(r,r.data[e],r.path,e))});return r.common.async?h.mergeObjectAsync(t,a):h.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new Y(t instanceof P?{keyType:e,valueType:t,typeName:e2.ZodRecord,...x(r)}:{keyType:j.create(),valueType:e,typeName:e2.ZodRecord,...x(t)})}}class Q extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.map)return d(r,{code:s.invalid_type,expected:i.map,received:r.parsedType}),p;let a=this._def.keyType,n=this._def.valueType,o=[...r.data.entries()].map(([e,t],i)=>({key:a._parse(new _(r,e,r.path,[i,"key"])),value:n._parse(new _(r,t,r.path,[i,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of o){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return p;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of o){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return p;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}Q.create=(e,t,r)=>new Q({valueType:t,keyType:e,typeName:e2.ZodMap,...x(r)});class X extends P{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.set)return d(r,{code:s.invalid_type,expected:i.set,received:r.parsedType}),p;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(d(r,{code:s.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(d(r,{code:s.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let n=this._def.valueType;function o(e){let r=new Set;for(let a of e){if("aborted"===a.status)return p;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let l=[...r.data.values()].map((e,t)=>n._parse(new _(r,e,r.path,t)));return r.common.async?Promise.all(l).then(e=>o(e)):o(l)}min(e,t){return new X({...this._def,minSize:{value:e,message:e1.toString(t)}})}max(e,t){return new X({...this._def,maxSize:{value:e,message:e1.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}X.create=(e,t)=>new X({valueType:e,minSize:null,maxSize:null,typeName:e2.ZodSet,...x(t)});class ee extends P{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.function)return d(t,{code:s.invalid_type,expected:i.function,received:t.parsedType}),p;function r(e,r){return c({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,u,l].filter(e=>!!e),issueData:{code:s.invalid_arguments,argumentsError:r}})}function a(e,r){return c({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,u,l].filter(e=>!!e),issueData:{code:s.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},h=t.data;if(this._def.returns instanceof es){let e=this;return m(async function(...t){let i=new o([]),s=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(h,this,s),u=await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(a(l,e)),i});return u})}{let e=this;return m(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new o([r(t,i.error)]);let s=Reflect.apply(h,this,i.data),l=e._def.returns.safeParse(s,n);if(!l.success)throw new o([a(s,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ee({...this._def,args:W.create(e).rest(B.create())})}returns(e){return new ee({...this._def,returns:e})}implement(e){let t=this.parse(e);return t}strictImplement(e){let t=this.parse(e);return t}static create(e,t,r){return new ee({args:e||W.create([]).rest(B.create()),returns:t||B.create(),typeName:e2.ZodFunction,...x(r)})}}class et extends P{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.getter();return r._parse({data:t.data,path:t.path,parent:t})}}et.create=(e,t)=>new et({getter:e,typeName:e2.ZodLazy,...x(t)});class er extends P{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return d(t,{received:t.data,code:s.invalid_literal,expected:this._def.value}),p}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ea(e,t){return new ei({values:e,typeName:e2.ZodEnum,...x(t)})}er.create=(e,t)=>new er({value:e,typeName:e2.ZodLiteral,...x(t)});class ei extends P{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return d(t,{expected:eX.joinValues(r),received:t.parsedType,code:s.invalid_type}),p}if(-1===this._def.values.indexOf(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return d(t,{received:t.data,code:s.invalid_enum_value,options:r}),p}return m(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return ei.create(e)}exclude(e){return ei.create(this.options.filter(t=>!e.includes(t)))}}ei.create=ea;class en extends P{_parse(e){let t=eX.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==i.string&&r.parsedType!==i.number){let e=eX.objectValues(t);return d(r,{expected:eX.joinValues(e),received:r.parsedType,code:s.invalid_type}),p}if(-1===t.indexOf(e.data)){let e=eX.objectValues(t);return d(r,{received:r.data,code:s.invalid_enum_value,options:e}),p}return m(e.data)}get enum(){return this._def.values}}en.create=(e,t)=>new en({values:e,typeName:e2.ZodNativeEnum,...x(t)});class es extends P{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.promise&&!1===t.common.async)return d(t,{code:s.invalid_type,expected:i.promise,received:t.parsedType}),p;let r=t.parsedType===i.promise?t.data:Promise.resolve(t.data);return m(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}es.create=(e,t)=>new es({type:e,typeName:e2.ZodPromise,...x(t)});class eo extends P{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===e2.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{d(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(r.data,i);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r})):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?p:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?p:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>v(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!v(e))return e;let n=a.transform(e.value,i);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}eX.assertNever(a)}}eo.create=(e,t,r)=>new eo({schema:e,typeName:e2.ZodEffects,effect:t,...x(r)}),eo.createWithPreprocess=(e,t,r)=>new eo({schema:t,effect:{type:"preprocess",transform:e},typeName:e2.ZodEffects,...x(r)});class el extends P{_parse(e){let t=this._getType(e);return t===i.undefined?m(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}el.create=(e,t)=>new el({innerType:e,typeName:e2.ZodOptional,...x(t)});class eu extends P{_parse(e){let t=this._getType(e);return t===i.null?m(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eu.create=(e,t)=>new eu({innerType:e,typeName:e2.ZodNullable,...x(t)});class ec extends P{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===i.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ec.create=(e,t)=>new ec({innerType:e,typeName:e2.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...x(t)});class ed extends P{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return b(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new o(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new o(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ed.create=(e,t)=>new ed({innerType:e,typeName:e2.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...x(t)});class eh extends P{_parse(e){let t=this._getType(e);if(t!==i.nan){let t=this._getOrReturnCtx(e);return d(t,{code:s.invalid_type,expected:i.nan,received:t.parsedType}),p}return{status:"valid",value:e.data}}}eh.create=e=>new eh({typeName:e2.ZodNaN,...x(e)});let ep=Symbol("zod_brand");class ef extends P{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class em extends P{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){let e=async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?p:"dirty"===e.status?(t.dirty(),f(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})};return e()}{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?p:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new em({in:e,out:t,typeName:e2.ZodPipeline})}}class eg extends P{_parse(e){let t=this._def.innerType._parse(e);return v(t)&&(t.value=Object.freeze(t.value)),t}}eg.create=(e,t)=>new eg({innerType:e,typeName:e2.ZodReadonly,...x(t)});let ey=(e,t={},r)=>e?U.create().superRefine((a,i)=>{var n,s;if(!e(a)){let e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(s=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;i.addIssue({code:"custom",...l,fatal:o})}}):U.create(),ev={object:F.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(e2||(e2={}));let eb=j.create,e_=N.create,ew=eh.create,ex=R.create,eP=L.create,eO=M.create,eT=D.create,eS=$.create,eE=Z.create,ek=U.create,eA=B.create,eI=V.create,eC=K.create,ej=z.create,eN=F.create,eR=F.strictCreate,eL=q.create,eM=G.create,eD=J.create,e$=W.create,eZ=Y.create,eU=Q.create,eB=X.create,eV=ee.create,eK=et.create,ez=er.create,eF=ei.create,eq=en.create,eH=es.create,eG=eo.create,eJ=el.create,eW=eu.create,eY=eo.createWithPreprocess,eQ=em.create;var eX,e0,e1,e2,e3=Object.freeze({__proto__:null,defaultErrorMap:l,setErrorMap:function(e){u=e},getErrorMap:function(){return u},makeIssue:c,EMPTY_PATH:[],addIssueToContext:d,ParseStatus:h,INVALID:p,DIRTY:f,OK:m,isAborted:g,isDirty:y,isValid:v,isAsync:b,get util(){return eX},get objectUtil(){return e0},ZodParsedType:i,getParsedType:n,ZodType:P,ZodString:j,ZodNumber:N,ZodBigInt:R,ZodBoolean:L,ZodDate:M,ZodSymbol:D,ZodUndefined:$,ZodNull:Z,ZodAny:U,ZodUnknown:B,ZodNever:V,ZodVoid:K,ZodArray:z,ZodObject:F,ZodUnion:q,ZodDiscriminatedUnion:G,ZodIntersection:J,ZodTuple:W,ZodRecord:Y,ZodMap:Q,ZodSet:X,ZodFunction:ee,ZodLazy:et,ZodLiteral:er,ZodEnum:ei,ZodNativeEnum:en,ZodPromise:es,ZodEffects:eo,ZodTransformer:eo,ZodOptional:el,ZodNullable:eu,ZodDefault:ec,ZodCatch:ed,ZodNaN:eh,BRAND:ep,ZodBranded:ef,ZodPipeline:em,ZodReadonly:eg,custom:ey,Schema:P,ZodSchema:P,late:ev,get ZodFirstPartyTypeKind(){return e2},coerce:{string:e=>j.create({...e,coerce:!0}),number:e=>N.create({...e,coerce:!0}),boolean:e=>L.create({...e,coerce:!0}),bigint:e=>R.create({...e,coerce:!0}),date:e=>M.create({...e,coerce:!0})},any:ek,array:ej,bigint:ex,boolean:eP,date:eO,discriminatedUnion:eM,effect:eG,enum:eF,function:eV,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ey(t=>t instanceof e,t),intersection:eD,lazy:eK,literal:ez,map:eU,nan:ew,nativeEnum:eq,never:eI,null:eE,nullable:eW,number:e_,object:eN,oboolean:()=>eP().optional(),onumber:()=>e_().optional(),optional:eJ,ostring:()=>eb().optional(),pipeline:eQ,preprocess:eY,promise:eH,record:eZ,set:eB,strictObject:eR,string:eb,symbol:eT,transformer:eG,tuple:e$,undefined:eS,union:eL,unknown:eA,void:eC,NEVER:p,ZodIssueCode:s,quotelessJson:e=>{let t=JSON.stringify(e,null,2);return t.replace(/"([^"]+)":/g,"$1:")},ZodError:o})},9046:e=>{"use strict";e.exports={version:"1.0.34"}}},e=>{var t=e(e.s=5777);(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/chat/retrieval_agents/route"]=t}]);
//# sourceMappingURL=route.js.map